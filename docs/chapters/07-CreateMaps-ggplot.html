<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>7&nbsp; Creating Maps using ggplot2 – R as GIS for Economists</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/08-DownloadSpatialData.html" rel="next">
<link href="../chapters/06-stars.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="style.css" rel="stylesheet" type="text/css">
<!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-59758608-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-59758608-3');
</script><link rel="stylesheet" href="../style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/06-stars.html">Extensions</a></li><li class="breadcrumb-item"><a href="../chapters/07-CreateMaps-ggplot.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Creating Maps using <code>ggplot2</code></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">R as GIS for Economists</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/tmieno2/R-as-GIS-for-Economists" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/00-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Demonstrations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Demonstration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R as GIS: Demonstrations</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-VectorDataBasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Vector Data Handling with <code>sf</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-SpatialInteractionVectorVector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial Interactions of Vector Data: Subsetting and Joining</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-RasterDataBasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Raster Data Handling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-SpatialInteractionVectorRaster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Interactions of Vector and Raster Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-stars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatiotemporal Raster Data Handling with <code>stars</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-CreateMaps-ggplot.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Creating Maps using <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-DownloadSpatialData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Download and process spatial datasets from within R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">(slightly) Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-SpeedThingsUp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Extraction Speed Considerations</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-ParallelComputing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Loop and Parallel Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-ggplot2-appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">ggplot2 minimals</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#before-you-start" id="toc-before-you-start" class="nav-link active" data-scroll-target="#before-you-start">Before you start</a>
  <ul class="collapse">
<li><a href="#direction-for-replication" id="toc-direction-for-replication" class="nav-link" data-scroll-target="#direction-for-replication">Direction for replication</a></li>
  </ul>
</li>
  <li>
<a href="#sec-geom-sf" id="toc-sec-geom-sf" class="nav-link" data-scroll-target="#sec-geom-sf"><span class="header-section-number">7.1</span> Creating maps from <code>sf</code> objects</a>
  <ul class="collapse">
<li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><span class="header-section-number">7.1.1</span> Datasets</a></li>
  <li><a href="#basic-usage-of-geom_sf" id="toc-basic-usage-of-geom_sf" class="nav-link" data-scroll-target="#basic-usage-of-geom_sf"><span class="header-section-number">7.1.2</span> Basic usage of <code>geom_sf()</code></a></li>
  <li><a href="#specifying-the-aesthetics" id="toc-specifying-the-aesthetics" class="nav-link" data-scroll-target="#specifying-the-aesthetics"><span class="header-section-number">7.1.3</span> Specifying the aesthetics</a></li>
  <li><a href="#plotting-multiple-spatial-objects-in-one-figure" id="toc-plotting-multiple-spatial-objects-in-one-figure" class="nav-link" data-scroll-target="#plotting-multiple-spatial-objects-in-one-figure"><span class="header-section-number">7.1.4</span> Plotting multiple spatial objects in one figure</a></li>
  <li><a href="#crs" id="toc-crs" class="nav-link" data-scroll-target="#crs"><span class="header-section-number">7.1.5</span> CRS</a></li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"><span class="header-section-number">7.1.6</span> Faceting</a></li>
  <li><a href="#adding-texts-labels-on-a-map" id="toc-adding-texts-labels-on-a-map" class="nav-link" data-scroll-target="#adding-texts-labels-on-a-map"><span class="header-section-number">7.1.7</span> Adding texts (labels) on a map</a></li>
  </ul>
</li>
  <li>
<a href="#sec-geom-raster" id="toc-sec-geom-raster" class="nav-link" data-scroll-target="#sec-geom-raster"><span class="header-section-number">7.2</span> Raster data visualization: <code>geom_spatraster()</code> and <code>geom_stars()</code></a>
  <ul class="collapse">
<li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">7.2.1</span> Data Preparation</a></li>
  <li><a href="#visualize-with-tidyterrageom_spatraster" id="toc-visualize-with-tidyterrageom_spatraster" class="nav-link" data-scroll-target="#visualize-with-tidyterrageom_spatraster"><span class="header-section-number">7.2.2</span> Visualize with <code>tidyterra::geom_spatraster()</code></a></li>
  <li><a href="#visualize-stars-with-geom_stars" id="toc-visualize-stars-with-geom_stars" class="nav-link" data-scroll-target="#visualize-stars-with-geom_stars"><span class="header-section-number">7.2.3</span> Visualize <code>stars</code> with <code>geom_stars()</code></a></li>
  <li><a href="#adding-geom_sf-layers" id="toc-adding-geom_sf-layers" class="nav-link" data-scroll-target="#adding-geom_sf-layers"><span class="header-section-number">7.2.4</span> adding <code>geom_sf()</code> layers</a></li>
  </ul>
</li>
  <li>
<a href="#sec-color-scale" id="toc-sec-color-scale" class="nav-link" data-scroll-target="#sec-color-scale"><span class="header-section-number">7.3</span> Color scale</a>
  <ul class="collapse">
<li><a href="#viridis-color-maps" id="toc-viridis-color-maps" class="nav-link" data-scroll-target="#viridis-color-maps"><span class="header-section-number">7.3.1</span> Viridis color maps</a></li>
  <li><a href="#rcolorbrewer-scale__distiller-and-scale__brewer" id="toc-rcolorbrewer-scale__distiller-and-scale__brewer" class="nav-link" data-scroll-target="#rcolorbrewer-scale__distiller-and-scale__brewer"><span class="header-section-number">7.3.2</span> <code>RColorBrewer</code>: <code>scale_*_distiller()</code> and <code>scale_*_brewer()</code></a></li>
  <li><a href="#colorspace-package" id="toc-colorspace-package" class="nav-link" data-scroll-target="#colorspace-package"><span class="header-section-number">7.3.3</span> <code>colorspace</code> package</a></li>
  </ul>
</li>
  <li><a href="#arranging-maps" id="toc-arranging-maps" class="nav-link" data-scroll-target="#arranging-maps"><span class="header-section-number">7.4</span> Arranging maps</a></li>
  <li>
<a href="#inset-maps-displaying-a-map-within-a-map" id="toc-inset-maps-displaying-a-map-within-a-map" class="nav-link" data-scroll-target="#inset-maps-displaying-a-map-within-a-map"><span class="header-section-number">7.5</span> Inset Maps: Displaying a Map Within a Map</a>
  <ul class="collapse">
<li><a href="#using-the-ggmapinset-package" id="toc-using-the-ggmapinset-package" class="nav-link" data-scroll-target="#using-the-ggmapinset-package"><span class="header-section-number">7.5.1</span> Using the <code>ggmapinset</code> package</a></li>
  <li><a href="#using-ggplotgrob-and-annotation_custom" id="toc-using-ggplotgrob-and-annotation_custom" class="nav-link" data-scroll-target="#using-ggplotgrob-and-annotation_custom"><span class="header-section-number">7.5.2</span> Using <code>ggplotGrob()</code> and <code>annotation_custom()</code></a></li>
  </ul>
</li>
  <li>
<a href="#sec-fine-tune" id="toc-sec-fine-tune" class="nav-link" data-scroll-target="#sec-fine-tune"><span class="header-section-number">7.6</span> Fine-tuning maps for publication</a>
  <ul class="collapse">
<li><a href="#sec-theme" id="toc-sec-theme" class="nav-link" data-scroll-target="#sec-theme"><span class="header-section-number">7.6.1</span> Setting the theme</a></li>
  <li><a href="#legend" id="toc-legend" class="nav-link" data-scroll-target="#legend"><span class="header-section-number">7.6.2</span> Legend</a></li>
  <li><a href="#facet-strips" id="toc-facet-strips" class="nav-link" data-scroll-target="#facet-strips"><span class="header-section-number">7.6.3</span> Facet strips</a></li>
  <li><a href="#north-arrow-and-scale-bar" id="toc-north-arrow-and-scale-bar" class="nav-link" data-scroll-target="#north-arrow-and-scale-bar"><span class="header-section-number">7.6.4</span> North arrow and scale bar</a></li>
  </ul>
</li>
  <li><a href="#sec-ggsave" id="toc-sec-ggsave" class="nav-link" data-scroll-target="#sec-ggsave"><span class="header-section-number">7.7</span> Saving a <code>ggplot</code> object as an image</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/tmieno2/R-as-GIS-for-Economists/edit/master/chapters/07-CreateMaps-ggplot.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/06-stars.html">Extensions</a></li><li class="breadcrumb-item"><a href="../chapters/07-CreateMaps-ggplot.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Creating Maps using <code>ggplot2</code></span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-create-maps" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Creating Maps using <code>ggplot2</code></span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="before-you-start" class="level2 unnumbered page-columns page-full"><h2 class="unnumbered anchored" data-anchor-id="before-you-start">Before you start</h2>
<p>In previous chapters, we explored how to quickly create simple maps using vector and raster data. This section will focus on using <code>ggplot2</code> to produce high-quality maps suitable for publication in journal articles, conference presentations, and professional reports. Achieving this level of quality requires refining the map’s aesthetics beyond default settings. This includes choosing appropriate color schemes, removing extraneous elements, and formatting legends. The focus here is on creating static maps, not the interactive ones commonly found on the web.</p>
<p>Creating maps differs from creating non-spatial figures in some aspects, but the underlying principles and syntax in <code>ggplot2</code> for both are quite similar. If you already have experience with <code>ggplot2</code>, you will find map-making intuitive and straightforward, even if you have never used it for spatial data before. The primary difference lies in the choice of <code>geom_*()</code> functions. For spatial data visualization, several specialized <code>geom_*()</code> types are available.</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">ggplot2::geom_sf()</a></code> for <code>sf</code> (vector) objects</li>
<li>
<code><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html">tidyterra::geom_spatraster()</a></code> for <code>SpatRaster</code> (raster) objects</li>
<li>
<code><a href="https://r-spatial.github.io/stars/reference/geom_stars.html">stars::geom_stars()</a></code> for <code>stars</code> (raster) objects<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;see <a href="06-stars.html" class="quarto-xref"><span>Chapter 6</span></a> for how <code>stars</code> package works</p></div></div><p>These <code>geom_*()</code> functions enable the visualization of both vector and raster data using the consistent and straightforward syntax of <code>ggplot2</code>. In the following sections, <a href="#sec-geom-sf" class="quarto-xref"><span>Section 7.1</span></a> and <a href="#sec-geom-raster" class="quarto-xref"><span>Section 7.2</span></a>, we will explore each of the <code>geom_*()</code>s individually to understand their basic usage. You will also notice that the principles discussed in the subsequent sections are not specific to spatial data—they are general and applicable to any type of figure.</p>
<p>Finally, another great package for mapping is the <code>tmap</code> package (<a href="https://r-tmap.github.io/tmap/">package website</a>). It also follows the grammar of graphics like <code>ggplot2</code>, and those who are already familiar with <code>ggplot2</code> will find it very intuitive to use. Given that the package website and <a href="https://r-tmap.github.io/tmap/">Chapter 9</a> of <a href="https://r.geocompx.org/">Geocomputation with R</a> already have great treatments of how to create maps with the package. This book does not cover this topic.</p>
<p>Another excellent package for mapping is the <code>tmap</code> package (<a href="https://r-tmap.github.io/tmap/">package website</a>). Like <code>ggplot2</code>, it follows the grammar of graphics, making it intuitive for users familiar with <code>ggplot2</code>. Since the package website and <a href="https://r-tmap.github.io/tmap/">Chapter 9 of Geocomputation with R</a> already provide excellent guides on creating maps with <code>tmap</code>, this book does not cover the topic.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although this chapter does not require extensive knowledge of <code>ggplot2</code>, having a basic understanding of it will be extremely helpful. If you are unfamiliar with <code>ggplot2</code> or feel that your knowledge is insufficient, Appendix <a href="A2-ggplot2-appendix.html" class="quarto-xref"><span>Appendix B</span></a> offers a minimal introduction to data visualization using the <code>ggplot2</code> package. This should provide enough background to help you follow along with the content in this chapter. <a href="https://ggplot2-book.org/">ggplot2: Elegant Graphics for Data Analysis</a> provides a fuller treatment of how <code>ggplot2</code> works</p>
</div>
</div>
<section id="direction-for-replication" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="direction-for-replication">Direction for replication</h3>
<p><strong>Datasets</strong></p>
<p>All the datasets that you need to import are available <a href="https://www.dropbox.com/sh/6utlzzzj2zzr079/AACu5QxM_-bgwWzVzd5xcX4fa?dl=0">here</a>. In this chapter, file paths are set relative to my working directory (which is not shown). To run the code without having to adjust the file paths, follow these steps:</p>
<ul>
<li>set a folder (any folder) as the working directory using <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>
</li>
<li>create a folder called “Data” inside the folder designated as the working directory (if you have created a “Data” folder previously, skip this step)</li>
<li>download the pertinent datasets from <a href="https://www.dropbox.com/sh/6utlzzzj2zzr079/AACu5QxM_-bgwWzVzd5xcX4fa?dl=0">here</a>
</li>
<li>place all the files in the downloaded folder in the “Data” folder</li>
</ul>
<p><strong>Packages</strong></p>
<ul>
<li>Run the following code to install or load (if already installed) the <code>pacman</code> package, and then install or load (if already installed) the listed package inside the <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">pacman::p_load()</a></code> function.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">stars</span>, <span class="co"># spatiotemporal data handling</span></span>
<span>  <span class="va">raster</span>, <span class="co"># raster data handling</span></span>
<span>  <span class="va">terra</span>, <span class="co"># raster data handling</span></span>
<span>  <span class="va">tidyterra</span>, <span class="co"># for tidyverse like operations on terra objects</span></span>
<span>  <span class="va">sf</span>, <span class="co"># vector data handling</span></span>
<span>  <span class="va">dplyr</span>, <span class="co"># data wrangling</span></span>
<span>  <span class="va">stringr</span>, <span class="co"># string manipulation</span></span>
<span>  <span class="va">lubridate</span>, <span class="co"># dates handling</span></span>
<span>  <span class="va">data.table</span>, <span class="co"># data wrangling</span></span>
<span>  <span class="va">patchwork</span>, <span class="co"># arranging figures</span></span>
<span>  <span class="va">tigris</span>, <span class="co"># county border</span></span>
<span>  <span class="va">colorspace</span>, <span class="co"># color scale</span></span>
<span>  <span class="va">viridis</span>, <span class="co"># arranging figures</span></span>
<span>  <span class="va">tidyr</span>, <span class="co"># reshape</span></span>
<span>  <span class="va">ggspatial</span>, <span class="co"># north arrow and scale bar</span></span>
<span>  <span class="va">ggplot2</span>, <span class="co"># make maps</span></span>
<span>  <span class="va">ggmapinset</span> <span class="co"># make inset maps</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
#/*=================================================*/
#' # Creating maps from `sf` objects
#/*=================================================*/
-->
</section></section><section id="sec-geom-sf" class="level2 page-columns page-full" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-geom-sf">
<span class="header-section-number">7.1</span> Creating maps from <code>sf</code> objects</h2>
<p>This section explains how to create maps from vector data stored as an <code>sf</code> object via <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>.</p>
<section id="datasets" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="datasets">
<span class="header-section-number">7.1.1</span> Datasets</h3>
<p>The following datasets will be used for illustrations.</p>
<p><strong>Points</strong></p>
<ul>
<li>
<code>well_id</code>: well ID</li>
<li>
<code>af_used</code>: total annual groundwater pumping at individual irrigation wells</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- read in the KS wells data ---#</span></span>
<span><span class="op">(</span></span>
<span>  <span class="va">gw_KS_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"Data/gw_KS_sf.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 56225 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -102.0495 ymin: 36.99561 xmax: -94.70746 ymax: 40.00191
Geodetic CRS:  NAD83
First 10 features:
   well_id year   af_used                   geometry
1        1 2010  67.00000 POINT (-100.4423 37.52046)
2        1 2011 171.00000 POINT (-100.4423 37.52046)
3        3 2010  30.93438 POINT (-100.7118 39.91526)
4        3 2011  12.00000 POINT (-100.7118 39.91526)
5        7 2010   0.00000 POINT (-101.8995 38.78077)
6        7 2011   0.00000 POINT (-101.8995 38.78077)
7       11 2010 154.00000 POINT (-101.7114 39.55035)
8       11 2011 160.00000 POINT (-101.7114 39.55035)
9       12 2010  28.17239 POINT (-95.97031 39.16121)
10      12 2011  89.53479 POINT (-95.97031 39.16121)</code></pre>
</div>
</div>
<p><strong>Polygons</strong></p>
<ul>
<li>
<code>COUNTYFP</code>: county FIPs code</li>
<li>
<code>NAME</code>: county name</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">KS_county</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">tigris</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/counties.html">counties</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Kansas"</span>, cb <span class="op">=</span> <span class="cn">TRUE</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">gw_KS_sf</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="va">NAME</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 105 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -102.0517 ymin: 36.99302 xmax: -94.58841 ymax: 40.00316
Geodetic CRS:  NAD83
First 10 features:
    COUNTYFP         NAME                       geometry
40       175       Seward MULTIPOLYGON (((-101.0681 3...
181      027         Clay MULTIPOLYGON (((-97.3707 39...
182      171        Scott MULTIPOLYGON (((-101.1284 3...
183      047      Edwards MULTIPOLYGON (((-99.56988 3...
373      147     Phillips MULTIPOLYGON (((-99.62821 3...
485      149 Pottawatomie MULTIPOLYGON (((-96.72774 3...
486      055       Finney MULTIPOLYGON (((-101.103 37...
487      167      Russell MULTIPOLYGON (((-99.04234 3...
488      135         Ness MULTIPOLYGON (((-100.2477 3...
489      093       Kearny MULTIPOLYGON (((-101.5419 3...</code></pre>
</div>
</div>
<p><strong>Lines</strong></p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">KS_railroads</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"Data/"</span>, layer <span class="op">=</span> <span class="st">"tl_2015_us_rails"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">KS_county</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KS_railroads</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5796 features and 3 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -102.0517 ymin: 36.99769 xmax: -94.58841 ymax: 40.06304
Geodetic CRS:  NAD83
First 10 features:
        LINEARID                         FULLNAME MTFCC
2124 11051038759                          Bnsf RR R1011
2136 11051038771                          Bnsf RR R1011
2141 11051038776                          Bnsf RR R1011
2186 11051047374                   Rock Island RR R1011
2240 11051048071  Burlington Northern Santa Fe RR R1011
2252 11051048083  Burlington Northern Santa Fe RR R1011
2256 11051048088  Burlington Northern Santa Fe RR R1011
2271 11051048170 Chicago Burlington and Quincy RR R1011
2272 11051048171 Chicago Burlington and Quincy RR R1011
2293 11051048193 Chicago Burlington and Quincy RR R1011
                           geometry
2124 LINESTRING (-94.58841 39.15...
2136 LINESTRING (-94.59017 39.11...
2141 LINESTRING (-94.58841 39.15...
2186 LINESTRING (-94.58893 39.11...
2240 LINESTRING (-94.58841 39.15...
2252 LINESTRING (-94.59017 39.11...
2256 LINESTRING (-94.58841 39.15...
2271 LINESTRING (-94.58862 39.15...
2272 LINESTRING (-94.58883 39.11...
2293 LINESTRING (-94.58871 39.11...</code></pre>
</div>
</div>
</section><section id="basic-usage-of-geom_sf" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="basic-usage-of-geom_sf">
<span class="header-section-number">7.1.2</span> Basic usage of <code>geom_sf()</code>
</h3>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> enables the visualization of sf objects. It automatically detects the geometry type of spatial data stored in <code>sf</code> and renders maps accordingly. For example, the following code generates maps for Kansas wells (points), Kansas counties (polygons), and Kansas railroads (lines):</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_wells</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_county</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/county-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_rail</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lines-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As demonstrated, different geometry types—such as points, polygons, and lines—are handled seamlessly by a single <code>geom</code> function, <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>. Additionally, note that in the example code, neither the x-axis (longitude) nor the y-axis (latitude) needs to be explicitly specified. When creating a map, longitude and latitude are automatically assigned to the x- and y-axes, respectively. <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> intelligently detects the geometry type and renders spatial objects accordingly.</p>
</section><section id="specifying-the-aesthetics" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="specifying-the-aesthetics">
<span class="header-section-number">7.1.3</span> Specifying the aesthetics</h3>
<p>There are various aesthetics options you can use. Available aesthetics vary by the type of geometry. This section shows the basics of how to specify the aesthetics of maps. Finer control of aesthetics will be discussed later.</p>
<section id="points" class="level4" data-number="7.1.3.1"><h4 data-number="7.1.3.1" class="anchored" data-anchor-id="points">
<span class="header-section-number">7.1.3.1</span> Points</h4>
<ul>
<li>
<strong>color</strong>: color of the points</li>
<li>
<strong>fill</strong>: available for some shapes (but likely useless)</li>
<li>
<strong>shape</strong>: shape of the points</li>
<li>
<strong>size</strong>: size of the points (rarely useful)</li>
</ul>
<p>For illustration here, let’s focus on the wells in one county so it is easy to detect the differences across various aesthetics configurations.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- wells in Stevens County ---#</span></span>
<span><span class="va">gw_Stevens</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">KS_county</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Stevens"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">gw_KS_sf</span>, <span class="va">.</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>example 1</strong></p>
<ul>
<li>
<strong>color</strong>: dependent on <code>af_used</code> (the amount of groundwater extraction)</li>
<li>
<strong>size</strong>: constant across the points (bigger than default)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-e1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>example 2</strong></p>
<ul>
<li>
<strong>color</strong>: constant across the points (blue)</li>
<li>
<strong>size</strong>: dependent on <code>af_used</code>
</li>
<li>
<strong>shape</strong>: constant across the points (square)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, shape <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-e2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>example 3</strong></p>
<ul>
<li>
<strong>color</strong>: dependent on whether located east of west of -101.3 in longitude</li>
<li>
<strong>shape</strong>: dependent on whether located east of west of -101.3 in longitude</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">gw_Stevens</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>east_west <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">X</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">101.3</span>, <span class="st">"west"</span>, <span class="st">"east"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="va">east_west</span>, color <span class="op">=</span> <span class="va">east_west</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-e3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="polygons" class="level4" data-number="7.1.3.2"><h4 data-number="7.1.3.2" class="anchored" data-anchor-id="polygons">
<span class="header-section-number">7.1.3.2</span> Polygons</h4>
<ul>
<li>
<strong>color</strong>: color of the <strong>borders</strong> of the polygons</li>
<li>
<strong>fill</strong>: color of the <strong>inside</strong> of the polygons</li>
<li>
<strong>shape</strong>: not available</li>
<li>
<strong>size</strong>: not available</li>
</ul>
<p><strong>example 1</strong></p>
<ul>
<li>
<strong>color</strong>: constant (red)</li>
<li>
<strong>fill</strong>: constant (dark green)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/county-map-e1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>example 2</strong></p>
<ul>
<li>
<strong>color</strong>: default (black)</li>
<li>
<strong>fill</strong>: dependent on the total amount of pumping in 2010</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KS_county_with_pumping</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">gw_KS_sf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#--- only year == 2010 ---#</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#--- get total pumping by county ---#</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">KS_county</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county_with_pumping</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/county-map-e2-echo-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="plotting-multiple-spatial-objects-in-one-figure" class="level3 page-columns page-full" data-number="7.1.4"><h3 data-number="7.1.4" class="anchored" data-anchor-id="plotting-multiple-spatial-objects-in-one-figure">
<span class="header-section-number">7.1.4</span> Plotting multiple spatial objects in one figure</h3>
<p>You can combine all the layers created by <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> additively so they appear in a single map:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_county ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_railroads ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/g-multiple-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Oops, you cannot see wells (points) in the figure. The order of <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> matters. The layer added later will come on top of the preceding layers. That’s why wells are hidden beneath Kansas counties. So, let’s do this:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_county ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_county ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_railroads ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/g-multiple-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Better.</p>
<p>Note that since you are using different datasets for each layer, you need to specify the dataset to use in each layer except for the first <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> which inherits <code>data = KS_wells</code> from <code>ggplot(data = KS_wells)</code>. Of course, this will create exactly the same map:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_all</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- this one uses KS_county ---#</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- this one uses KS_wells ---#</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- this one uses KS_railroads ---#</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/g-multiple-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is no rule that you need to supply data to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Supplying data in <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> can be convenient if you are creating multiple <code>geom</code> from the data because you do not need to tell what data to use in each of the subsequent <code>geom</code>s.</p></div></div><p>Alternatively, you could add <code>fill = NA</code> to <code>geom_sf(data = KS_county)</code> instead of switching the order.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_county ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this one uses KS_railroads ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/g-multiple-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is fine as long as you do not intend to color-code counties.</p>
</section><section id="crs" class="level3" data-number="7.1.5"><h3 data-number="7.1.5" class="anchored" data-anchor-id="crs">
<span class="header-section-number">7.1.5</span> CRS</h3>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> uses the CRS of the <code>sf</code> to draw a map. For example, right now the CRS of <code>KS_county</code> is this:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">KS_county</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4269 
  wkt:
GEOGCS["NAD83",
    DATUM["North_American_Datum_1983",
        SPHEROID["GRS 1980",6378137,298.257222101,
            AUTHORITY["EPSG","7019"]],
        TOWGS84[0,0,0,0,0,0,0],
        AUTHORITY["EPSG","6269"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.0174532925199433,
        AUTHORITY["EPSG","9122"]],
    AUTHORITY["EPSG","4269"]]</code></pre>
</div>
</div>
<p>Let’s convert the CRS to WGS 84/ UTM zone 14N (EPSG code: 32614), make a map, and compare the ones with different CRS side by side.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_32614</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_county</span> <span class="op">/</span> <span class="va">g_32614</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/patchwork-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, you could use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> to alter the CRS on the map, but not the CRS of the sf object itself.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 4269 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">32614</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-crs-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When multiple layers are used for map creation, the CRS of the first layer is applied for all the layers.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 32614 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 4269 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-crs-order-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> applies to all the layers.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 32614 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 4269 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- using 4269 ---#</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-coodsf-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, you could limit the geographic scope of the map to be created by adding <code>xlim()</code> and <code>ylim()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 32614 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- epsg: 4269 ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_railroads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- using 4269 ---#</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- limit the geographic scope of the map ---#</span></span>
<span>  <span class="fu">xlim</span><span class="op">(</span><span class="op">-</span><span class="fl">99</span>, <span class="op">-</span><span class="fl">97</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">37</span>, <span class="fl">39</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/wells-map-coodsf-lim-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="faceting" class="level3" data-number="7.1.6"><h3 data-number="7.1.6" class="anchored" data-anchor-id="faceting">
<span class="header-section-number">7.1.6</span> Faceting</h3>
<p>Faceting splits the data into groups and generates a figure for each group, where the aesthetics of the figures are consistent across the groups. Faceting can be done using <code>facet_wrap()</code> or <code>facet_grid()</code>. Let’s try to create a map of groundwater use at wells by year where the points are color differentiated by the amount of groundwater use (<code>af_used</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that the above code creates a single legend that applies to both panels, which allows you to compare values across panels (years here). Further, also note that the values of the faceting variable (<code>year</code>) are displayed in the gray strips above the maps. You can have panels stacked vertically by using the <code>ncol</code> option (or <code>nrow</code> also works) in <code>facet_wrap(. ~ year)</code> as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Two-way faceting is possible by supplying a variable name (or expression) in place of <code>.</code> in <code>facet_wrap(. ~ year)</code>. The code below uses an expression <code>(af_used &gt; 200)</code> in place of <code>.</code>. This divides the dataset by whether water use is greater than 200 or not and by year.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">(</span><span class="va">af_used</span> <span class="op">&gt;</span> <span class="fl">200</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The values of the expression (<code>TRUE</code> or <code>FALSE</code>) appear in the gray strips, which is not informative. We will discuss in detail how to control texts in the strips <a href="#sec-fine-tune" class="quarto-xref"><span>Section 7.6</span></a>.</p>
<p>If you feel like the panels are too close to each other, you could provide more space between them using <code>panel.spacing</code> (both vertically and horizontally), <code>panel.spacing.x</code> (horizontally), and <code>panel.spacing.y</code> (vertically) options in <code>theme()</code>. Suppose you would like to place more space between the upper and lower panels, then you use <code>panel.spacing.y</code> like this:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">(</span><span class="va">af_used</span> <span class="op">&gt;</span> <span class="fl">200</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- add more space between panels ---#</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.spacing.y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/panel-spacing-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="adding-texts-labels-on-a-map" class="level3" data-number="7.1.7"><h3 data-number="7.1.7" class="anchored" data-anchor-id="adding-texts-labels-on-a-map">
<span class="header-section-number">7.1.7</span> Adding texts (labels) on a map</h3>
<p>You can add labels to a map using <code>geom_sf_text()</code> or <code>geom_sf_label()</code> from the <code>ggplot2</code> pacakge, specifying <code>aes(label = x)</code> where <code>x</code> is the variable containing the labels to be displayed on the map.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">KS_county</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-labels-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you would like to have overlapping labels not printed, you can add <code>check_overlap = TRUE</code>.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">KS_county</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    check_overlap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-labels-overlap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>nudge_x</code> and <code>nudge_y</code> options let you shift the labels.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">KS_county</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    check_overlap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/nudge-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you would like a fine control on a few objects, you can always work on them separately.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cheyenne</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="va">NAME</span> <span class="op">==</span> <span class="st">"Cheyenne"</span><span class="op">)</span></span>
<span><span class="va">KS_less_Cheyenne</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="va">NAME</span> <span class="op">!=</span> <span class="st">"Cheyenne"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-warnings="false">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">KS_less_Cheyenne</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    check_overlap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">Cheyenne</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/nudge-sep-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You could also use <code>annotate()</code> to place texts on a map, which can be useful if you would like to place arbitrary texts that are not part of <code>sf</code> object.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">KS_less_Cheyenne</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>,</span>
<span>    check_overlap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- use annotate to add texts on the map ---#</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="op">-</span><span class="fl">102</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">39.8</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Cheyennes"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/nudge-sep-annotate-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, you need to tell where the texts should be placed with <code>x</code> and <code>y</code>, provide the texts you want on the map to <code>label</code>.</p>
<!--
#/*=================================================*/
#' # Raster data visualization
#/*=================================================*/
-->
</section></section><section id="sec-geom-raster" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-geom-raster">
<span class="header-section-number">7.2</span> Raster data visualization: <code>geom_spatraster()</code> and <code>geom_stars()</code>
</h2>
<p>This section shows how to use <code><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html">tidyterra::geom_spatraster()</a></code> and <code><a href="https://r-spatial.github.io/stars/reference/geom_stars.html">stars::geom_stars()</a></code> to create maps from raster datasets of two object classes: <code>SpatRaster</code> from the <code>terra</code> package and <code>stars</code> objects from the <code>stars</code> package, respectively.</p>
<p>While <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">ggplot2::geom_raster()</a></code> can be used to create a map from raster, it requires a <code>data.frame</code> containing coordinates to generate maps, making it a two-step process.</p>
<ol type="1">
<li>convert raster dataset into a <code>data.frame</code> with coordinates</li>
<li>use <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">ggplot2::geom_raster()</a></code> to make a map</li>
</ol>
<p>On the other hand, <code>geom_spatraster()</code> and <code>geom_stars()</code> accepts a <code>SpatRaster</code> (from the <code>terra</code> package) and <code>stars</code> object (from the <code>stars</code> package), respectively, and no data transformation is necessary for either of them. For this reason, <span style="color: red;"> the use of <code>geom_spatraster()</code> or <code>geom_stars</code> is recommended over <code>geom_raster()</code>. </span></p>
<section id="data-preparation" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="data-preparation">
<span class="header-section-number">7.2.1</span> Data Preparation</h3>
<p>We use the following objects that have the same information but come in different object classes for illustration in this section.</p>
<p><strong>Raster as <code>stars</code></strong></p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmax_Jan_09</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"Data/tmax_Jan_09_stars.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Raster as <code>SpatRaster</code></strong></p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- convert RasterStack to SpatRaster ---#</span></span>
<span><span class="va">tmax_Jan_09_sr</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="st">"Data/tmax_Jan_09.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- change the name of the layers ---#</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/inplace.html">set.names</a></span><span class="op">(</span></span>
<span>  <span class="va">tmax_Jan_09_sr</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span></span>
<span>      <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2009-01-01"</span><span class="op">)</span>, </span>
<span>      <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2009-01-05"</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"days"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualize-with-tidyterrageom_spatraster" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="visualize-with-tidyterrageom_spatraster">
<span class="header-section-number">7.2.2</span> Visualize with <code>tidyterra::geom_spatraster()</code>
</h3>
<p>Creating a map from a <code>SpatRaster</code> is as straightforward as creating one from an <code>sf</code> object. You can use <code><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html">tidyterra::geom_spatraster()</a></code>, setting the data argument to your <code>SpatRaster</code> object.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09_sr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/viz-spatraster-basic-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice here that the fill color was automatically set to cell values (here, <code>tmax</code>). <code>tmax_Jan_09_sr</code> is a five-layer raster object, and you might be wondering which of the five layers were used for the map above. The answer is: all of them. To select a specific layer, you can specify aes<code>(fill = layer_name)</code> within <code>geom_spatraster()</code>, as shown below:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09_sr</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">`2009-01-01`</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/viz-spatraster-single-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To facet by layer, apply <code>facet_wrap(~ lyr)</code> as shown below.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09_sr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lyr</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/viz-spatraster-facet-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since this is built within the <code>ggplot2</code> framework, you can easily customize the figure if you are familiar with <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09_sr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lyr</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_whitebox_c</span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"muted"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op">(</span>suffix <span class="op">=</span> <span class="st">"º"</span><span class="op">)</span>,</span>
<span>    n.breaks <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/viz-spatraster-facet-style-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that you always have <code>lyr</code> as the faceting variable with <code>geom_spatraster()</code> as there is no other variable to be faceted with in a multi-layer <code>SpatRaster</code> object.</p>
</div>
</div>
</section><section id="visualize-stars-with-geom_stars" class="level3" data-number="7.2.3"><h3 data-number="7.2.3" class="anchored" data-anchor-id="visualize-stars-with-geom_stars">
<span class="header-section-number">7.2.3</span> Visualize <code>stars</code> with <code>geom_stars()</code>
</h3>
<p><code><a href="https://r-spatial.github.io/stars/reference/geom_stars.html">stars::geom_stars()</a></code> allows you to directly use a <code>stars</code> object to easily create a map within the <code>ggplot2</code> framework. It works similarly to <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> and <code>geom_spatraster()</code>—simply provide the stars object as the data argument in <code>geom_stars()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/stars-stars-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The fill color of the raster cells are automatically set to the attribute (here <code>tmax</code>) as if <code>aes(fill = tmax)</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/stars-stars-ce-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By default, <code>geom_stars()</code> plots only the first band. In order to present all the layers at the same time, you can add <code>facet_wrap( ~ x)</code> where <strong>x</strong> is the name of the third dimension of the stars object (<code>date</code> here).</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">date</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/stars-stars-facet-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="adding-geom_sf-layers" class="level3" data-number="7.2.4"><h3 data-number="7.2.4" class="anchored" data-anchor-id="adding-geom_sf-layers">
<span class="header-section-number">7.2.4</span> adding <code>geom_sf()</code> layers</h3>
<p>You can easily add <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> layers to a map created with <code>geom_spatraster()</code> and <code>geom_stars()</code>. Let’s crop the tmax data to Kansas and create a map of tmax values displayed on top of the Kansas county borders.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- crop to KS ---#</span></span>
<span><span class="va">KS_tmax_Jan_09_stars</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">tmax_Jan_09</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">KS_county</span><span class="op">)</span></span>
<span></span>
<span><span class="va">KS_tmax_Jan_09_sr</span> <span class="op">&lt;-</span> </span>
<span><span class="fu">as</span><span class="op">(</span><span class="va">KS_tmax_Jan_09_stars</span>, <span class="st">"SpatRaster"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mixing either <code>geom_spatraster()</code> or <code>geom_stars()</code> layers with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> layers is not any different from mixing different non-spatial <code>geom_*()</code>s under the <code>ggplot2</code> framework. You can easily see in the example below that mixes <code>geom_stars()</code> and <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> layers:</p>
<p><strong>with <code>geom_stars()</code></strong></p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_tmax_Jan_09_stars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/stars-sf-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>with <code>geom_spatraster()</code></strong></p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_tmax_Jan_09_sr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lyr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/spatraster-sf-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One caveat with <code>geom_stars()</code> is that vector and raster datasets need to have the same GRS/CRS. The code below transform the CRS of <code>KS_county</code> from NAD83 GRS to WGS 84 / UTM zone 14N before plotting and see what happens.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_tmax_Jan_09_stars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/stars-sf-cs-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is not the case for <code>geom_spatraster()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_tmax_Jan_09_sr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lyr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/spatraster-sf-cs-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!--
#/*=================================================*/
#' # Color scales
#/*=================================================*/
-->
</section></section><section id="sec-color-scale" class="level2 page-columns page-full" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-color-scale">
<span class="header-section-number">7.3</span> Color scale</h2>
<!-- https://www.datanovia.com/en/blog/top-r-color-palettes-to-know-for-great-data-visualization/ -->
<p>A color scale defines how variable values are mapped to colors in a figure. For example, in the illustration below, the color scale for fill maps the values of the cells to a gradient, with dark blue representing low values and light blue indicating high values of <code>tmax</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_Jan_09_sr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lyr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Often, it’s aesthetically desirable to customize the default color scale in <code>ggplot2</code>. For instance, when visualizing temperature values, you might prefer a gradient that ranges from blue for lower temperatures to red for higher ones.</p>
<p>You can control the color scale using <code>scale_*()</code> functions. The specific <code>scale_*()</code> function you need depends on the type of aesthetic (fill or color) and whether the variable is continuous or discrete. Using an incorrect <code>scale_*()</code> function will result in an error.</p>
<section id="viridis-color-maps" class="level3 page-columns page-full" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="viridis-color-maps">
<span class="header-section-number">7.3.1</span> Viridis color maps</h3>
<p>The <code>ggplot2</code> package provides <code>scale_A_viridis_B()</code> functions for applying the Viridis color map, where <code>A</code> refers to the type of aesthetic attribute (fill, color), and <code>B</code> refers to the type of variable. For example, <code>scale_fill_viridis_c()</code> is used for fill aesthetics applied to a continuous variable.</p>
<p>The Viridis color map offers five different palettes, which can be selected using the <code>option</code> argument (<a href="#fig-viridis-ex" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> is a visualization of all five palettes).</p>

<!--end of column-margin-->
<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"geyser"</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">geyser</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">duration</span>, y <span class="op">=</span> <span class="va">waiting</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlim</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">40</span>, <span class="fl">110</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density2d</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">..level..</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">gg</span></span>
<span></span>
<span><span class="op">(</span><span class="va">gg</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"magma"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">gg</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"inferno"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">gg</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"plasma"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">gg</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"viridis"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">gg</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"cividis"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-viridis-ex" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-viridis-ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-CreateMaps-ggplot_files/figure-html/fig-viridis-ex-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-viridis-ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Five Viridis options
</figcaption></figure>
</div>
</div>
</div>
</div></div><p>Let’s see what the PRISM tmax maps look like using Option <code>A</code> and <code>D</code> (default). Since the aesthetics type is <code>fill</code> and <code>tmax</code> is continuous, <code>scale_fill_viridis_c()</code> is the appropriate one here.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/tmax-viridis-A-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/tmax-viridis-D-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can reverse the order of the color by adding <code>direction = -1</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/tmax-viridis-D-direc-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s now work on aesthetics mapping based on a discrete variable. The code below groups <code>af_used</code> into five groups of ranges.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- convert af_used to a discrete variable ---#</span></span>
<span><span class="va">gw_Stevens</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">gw_Stevens</span>, af_used_cat <span class="op">=</span> <span class="fu">cut_number</span><span class="op">(</span><span class="va">af_used</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- take a look ---#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gw_Stevens</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 4 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -101.4232 ymin: 37.04683 xmax: -101.1111 ymax: 37.29295
Geodetic CRS:  NAD83
    well_id year  af_used                   geometry    af_used_cat
197     234 2010 461.9565  POINT (-101.4232 37.1165)      (377,508]
198     234 2011 486.0534  POINT (-101.4232 37.1165)      (377,508]
247     290 2010 457.4391 POINT (-101.2301 37.29295)      (377,508]
248     290 2011 580.4156 POINT (-101.2301 37.29295) (508,1.19e+03]
275     317 2010 258.0000 POINT (-101.1111 37.04683)      (157,264]
276     317 2011 255.0000 POINT (-101.1111 37.04683)      (157,264]</code></pre>
</div>
</div>
<p>Since we would like to control <code>color</code> aesthetics based on a discrete variable, we should be using <code>scale_color_viridis_d()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used_cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/viridis-color-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="rcolorbrewer-scale__distiller-and-scale__brewer" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="rcolorbrewer-scale__distiller-and-scale__brewer">
<span class="header-section-number">7.3.2</span> <code>RColorBrewer</code>: <code>scale_*_distiller()</code> and <code>scale_*_brewer()</code>
</h3>
<p>The <code>RColorBrewer</code> package provides a set of color scales that are useful. Here is the list of color scales you can use.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- load RColorBrewer ---#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- disply all the color schemes from the package ---#</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/brewer-disp-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first set of color palettes are <strong>sequential</strong> palettes and are suitable for a variable that has ordinal meaning: temperature, precipitation, etc. The second set of palettes are <strong>qualitative</strong> palettes and suitable for qualitative or categorical data. Finally, the third set of palettes are <strong>diverging</strong> palettes and can be suitable for variables that take both negative and positive values like changes in groundwater level.</p>
<p>Two types of <code>scale</code> functions can be used to use these palettes:</p>
<ul>
<li>
<code>scale_*_distiller()</code> for a continuous variable</li>
<li>
<code>scale_*_brewer()</code> for a discrete variable</li>
</ul>
<p>To use a specific color palette, you can simply add <code>palette = "palette name"</code> inside <code>scale_fill_distiller()</code>. The codes below applies “Spectral” as an example.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/brewer-spectral-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can reverse the color order by adding <code>trans = "reverse"</code> option.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>, trans <span class="op">=</span> <span class="st">"reverse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/brewer-spectral-reverse-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you are specifying the <code>color</code> aesthetics based on a continuous variable, then you use <code>scale_color_distiller()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_distiller</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/brewer-spectral-reverse-color-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, suppose the variable of interest comes with categories of ranges of values. The code below groups <code>af_used</code> into five ranges using <code>ggplo2::cut_number()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gw_Stevens</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">gw_Stevens</span>, af_used_cat <span class="op">=</span> <span class="fu">cut_number</span><span class="op">(</span><span class="va">af_used</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since <code>af_used_cat</code> is a discrete variable, you can use <code>scale_color_brewer()</code> instead.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used_cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/brewer-spectral-brewer-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="colorspace-package" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="colorspace-package">
<span class="header-section-number">7.3.3</span> <code>colorspace</code> package</h3>
<p>If you are not satisfied with the <code>viridis</code> color map or the <code>ColorBrewer</code> palette options, you might want to try the <code>colorspace</code> package.</p>
<p>Here is the palettes the <code>colorspace</code> package offers.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- plot the palettes ---#</span></span>
<span><span class="fu">colorspace</span><span class="fu">::</span><span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/hcl_palettes.html">hcl_palettes</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/palettes-colorspace-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The packages offers its own <code>scale_*()</code> functions that follows the following naming convention:</p>
<p><code>scale_aesthetic_datatype_colorscale</code> where</p>
<ul>
<li>aesthetic: <code>fill</code> or <code>color</code>
</li>
<li>datatype: <code>continuous</code> or <code>discrete</code>
</li>
<li>colorscale: <code>qualitative</code>, <code>sequential</code>, <code>diverging</code>, <code>divergingx</code>
</li>
</ul>
<p>For example, to add a sequential color scale to the following map, we would use <code>scale_fill_continuous_sequential()</code> and then pick a palette from the set of sequential palettes shown above. The code below uses the Viridis palette with the reverse option:</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_by_county</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_continuous_sequential</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Viridis"</span>, trans <span class="op">=</span> <span class="st">"reverse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>If you still cannot find a palette that satisfies your need (or obsession at this point), then you can easily make your own. The package offers <code>hclwizard()</code>, which starts shiny-based web application to let you design your own color palette.</p>
<p>After running this,</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">hclwizard</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>you should see a web application pop up that looks like this.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"assets/hclwizard.png"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="assets/hclwizard.png" class="img-fluid figure-img" width="1908"></p>
</figure>
</div>
</div>
</div>
<p>After you find a color scale you would like to use, you can go to the <strong>Export</strong>tab, select the <strong>R</strong> tab, and then copy the code that appear in the highlighted area.</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"assets/hclwizard_pick_theme.png"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="assets/hclwizard_pick_theme.png" class="img-fluid figure-img" width="1043"></p>
</figure>
</div>
</div>
</div>
<p>You could register the color palette by completing the <code>register =</code> option in the copied code if you think you will use it other times. Otherwise, you can delete the option.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">col_palette</span> <span class="op">&lt;-</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/hcl_palettes.html">sequential_hcl</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">36</span>, <span class="fl">200</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="cn">NA</span>, <span class="fl">0</span><span class="op">)</span>, l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">95</span><span class="op">)</span>, power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then use the code as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_col_scale</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="va">col_palette</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/use-col-scale-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that you are now using <code>scale_*_gradientn()</code> with this approach.</p>
<p>For a discrete variable, you can use <code>scale_*_manual()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">col_discrete</span> <span class="op">&lt;-</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/hcl_palettes.html">sequential_hcl</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">240</span>, <span class="fl">130</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="cn">NA</span>, <span class="fl">33</span><span class="op">)</span>, l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">95</span><span class="op">)</span>, power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used_cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">col_discrete</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!--
#/*=================================================*/
#' # Arranging maps
#/*=================================================*/
-->
</section></section><section id="arranging-maps" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="arranging-maps">
<span class="header-section-number">7.4</span> Arranging maps</h2>
<p><code>patchwork</code> combines <code>ggplot</code> objects (maps) using simple operators: <code>+</code>, <code>/</code>, and <code>|</code>. Let’s first create maps of tmax and precipitation separately.</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- tmax ---#</span></span>
<span><span class="va">tmax_20000101</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="st">"Data/PRISM/PRISM_tmax_stable_4kmD2_20000101_bil/PRISM_tmax_stable_4kmD2_20000101_bil.bil"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span></span>
<span>  <span class="va">g_tmax</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmax_20000101</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- ppt ---#</span></span>
<span><span class="va">ppt_20000101</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="st">"Data/PRISM/PRISM_ppt_stable_4kmD2_20000101_bil/PRISM_ppt_stable_4kmD2_20000101_bil.bil"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span></span>
<span>  <span class="va">g_ppt</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ppt_20000101</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is best to just look at examples to get the sense of how <code>patchwork</code> works. A fuller treatment of <code>patchwork</code> is found <a href="https://patchwork.data-imaginist.com/index.html">here</a>.</p>
<p><strong>Example 1</strong></p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_tmax</span> <span class="op">+</span> <span class="va">g_ppt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example 2</strong></p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_tmax</span> <span class="op">/</span> <span class="va">g_ppt</span> <span class="op">/</span> <span class="va">g_tmax</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example 3</strong></p>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_tmax</span> <span class="op">+</span> <span class="va">g_ppt</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example 4</strong></p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_tmax</span> <span class="op">+</span> <span class="va">g_ppt</span> <span class="op">+</span> <span class="va">g_tmax</span> <span class="op">+</span> <span class="va">g_ppt</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example 5</strong></p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_tmax</span> <span class="op">|</span> <span class="op">(</span><span class="va">g_ppt</span> <span class="op">/</span> <span class="va">g_tmax</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pw-ex-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Sometimes figures are placed too close to each other. In such a case, you can pad a figure at the time of generating individual figures by adding the <code>plot.margin</code> option to <code>theme()</code>. For example, the following code creates space at the bottom of <code>g_tmax</code> (5 cm), and vertically stack <code>g_tmax</code> and <code>g_ppt</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- space at the bottom ---#</span></span>
<span><span class="va">g_tmax</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">g_tmax</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- vertically stack ---#</span></span>
<span><span class="va">g_tmax</span> <span class="op">/</span> <span class="va">g_ppt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/pad-one-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In <code>plot.margin = unit(c(a, b, c, d), "cm")</code>, here is which margin <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> refers to.</p>
<ul>
<li>
<code>a</code>: top</li>
<li>
<code>b</code>: right</li>
<li>
<code>c</code>: bottom</li>
<li>
<code>d</code>: left</li>
</ul></section><section id="inset-maps-displaying-a-map-within-a-map" class="level2 page-columns page-full" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="inset-maps-displaying-a-map-within-a-map">
<span class="header-section-number">7.5</span> Inset Maps: Displaying a Map Within a Map</h2>
<p>Sometimes, it is useful to present a map that covers a larger geographical range than the area of interest in the same map. This provides a better sense of the geographic extent and location of the area of interest relative to the larger geographic extent that the readers are more familiar with. For example, suppose your work is restricted to three counties in Kansas: Cheyenne, Sherman, and Wallace (<a href="#fig-three-counties-map" class="quarto-xref">Figure&nbsp;<span>7.2</span></a> presents their locations in Kansas)</p>

<!--end of column-margin-->
<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_three_counties</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-three-counties-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-three-counties-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-CreateMaps-ggplot_files/figure-html/fig-three-counties-map-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-three-counties-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Cheyenne, Sherman, and Wallace Counties of Kansas
</figcaption></figure>
</div>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span><span class="va">three_counties</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cheyenne"</span>, <span class="st">"Sherman"</span>, <span class="st">"Wallace"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -102.0517 ymin: 38.69757 xmax: -101.3891 ymax: 40.00316
Geodetic CRS:  NAD83
  COUNTYFP     NAME                       geometry
1      199  Wallace MULTIPOLYGON (((-102.0472 3...
2      181  Sherman MULTIPOLYGON (((-102.0498 3...
3      023 Cheyenne MULTIPOLYGON (((-102.0517 4...</code></pre>
</div>
</div>
<p>For those unfamiliar with Kansas, it can be helpful to show its location on the same map (or even where Kansas is within the U.S.).</p>
<section id="using-the-ggmapinset-package" class="level3 page-columns page-full" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="using-the-ggmapinset-package">
<span class="header-section-number">7.5.1</span> Using the <code>ggmapinset</code> package</h3>
<p>The goal here is to create a map like <a href="#fig-inset-ggmapinset" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>.</p>

<!--end of column-margin-->
<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_three_counties</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">(</span></span>
<span><span class="va">g_three_counties</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, map_base <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_inset_frame</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf_inset</span><span class="op">(</span>inset <span class="op">=</span> </span>
<span>    <span class="fu">configure_inset</span><span class="op">(</span></span>
<span>      <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span>      centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">three_counties</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span>      translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">600</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>      <span class="co">#--- radius of 80 km ---#</span></span>
<span>      radius <span class="op">=</span> <span class="fl">80</span>,</span>
<span>      <span class="co">#--- scale up by 2 ---#</span></span>
<span>      scale <span class="op">=</span> <span class="fl">6</span>,</span>
<span>      units <span class="op">=</span> <span class="st">"km"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-inset-ggmapinset" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-inset-ggmapinset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-CreateMaps-ggplot_files/figure-html/fig-inset-ggmapinset-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inset-ggmapinset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Inset map created with ggmapinset
</figcaption></figure>
</div>
</div>
</div>
</div></div><p>The first step of making an inset map using <code>ggmapinset</code> is to create the base map layer (Kansas county borders), a part of which is going to be expanded as an inset later.</p>
<p>As the base map, we will create a map of all the counties in Kansas with only the three counties (Perkins, Chase, and Dundy) colored red.</p>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_three_counties</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now configure the inset using <code>configure_inset()</code>. Below is the list of parameters to specify:</p>
<ul>
<li>
<code>centre</code>: The geographic coordinates of the small circle from which the enlargement begins.</li>
<li>
<code>translation</code>: The amount of shift in the x and y directions from the center to position the enlarged circle.</li>
<li>
<code>radius</code>: The radius of the original small circle.</li>
<li>
<code>scale</code>: The factor by which the circle is enlarged.</li>
<li>
<code>units</code>: The unit of measurement for the radius.</li>
</ul>
<p>It is hard to get <code>translation</code>, <code>radius</code>, and <code>scale</code> right the first time. After some try and errors, you can get them right. In the code below, the center of the circle is set at the centroid of the three counties combined (<code>sf::st_centroid(sf::st_union(three_counties)</code>). <code>translation = c(300, -250)</code> along with <code>units = "km"</code> means that the inset map (map inside the circle in <a href="#fig-inset-ggmapinset" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>) is 300km east and 250km south (-250 north) to the base map. The radius of the circle is specified to be 80km with <code>radius = 80</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">inset_config</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">configure_inset</span><span class="op">(</span></span>
<span>    <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span>    centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">three_counties</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span>    translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="op">-</span><span class="fl">250</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- radius of 80 km ---#</span></span>
<span>    radius <span class="op">=</span> <span class="fl">80</span>,</span>
<span>    <span class="co">#--- scale up by 2 ---#</span></span>
<span>    scale <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"km"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the inset configuration ready, we can now add the inset. For this, use the following functions:</p>
<ul>
<li>
<code>geom_sf_inset()</code> and/or <code>geom_sf_text_inset()</code> to create the layers that will appear in the inset (the circle).</li>
<li>
<code>geom_inset_frame()</code> to add the frame, which includes the small circle, the large circle, and connecting lines.</li>
<li>
<code>coord_sf_inset(inset = inset_config)</code> to apply the configuration you set up earlier.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span><span class="va">g_three_counties</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, map_base <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_inset_frame</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf_inset</span><span class="op">(</span>inset <span class="op">=</span> <span class="va">inset_config</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Well, this is not quite right. Let’s re-configure the inset parameters like below:</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">inset_config</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">configure_inset</span><span class="op">(</span></span>
<span>    <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span>    centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">three_counties</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span>    translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">600</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- radius of 80 km ---#</span></span>
<span>    radius <span class="op">=</span> <span class="fl">80</span>,</span>
<span>    <span class="co">#--- scale up by 2 ---#</span></span>
<span>    scale <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"km"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span><span class="va">g_three_counties</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, map_base <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_inset_frame</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf_inset</span><span class="op">(</span>inset <span class="op">=</span> <span class="va">inset_config</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, <code>scale</code> is set to a higher number at 6 so that the inset map is much bigger relative to the base map. <code>translation</code> was also altered significantly so that the inset map does not overlap with the base map after scaling up the inset map.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Note on `map_base`">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on <code>map_base</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>By default, <code>geom_sf_inset()</code> creates two copies of the map layer specified by <code>geom_sf_inset()</code> and/or <code>geom_sf_text_inset()</code>: one for the base map and the other for the inset map. <code>map_base</code> option determines whether you create the copy for the base map or not.</p>
<p>In the code below, <code>map_base = "none"</code> is not specified unlike the map created just above, meaning that <code>geom_sf_inset(data = three_counties, fill = "black")</code> will be applied for both the base and inset maps. Consequently, you see that the default fill color of “gray” is used for both the inset and base maps, overwriting the aesthetics for the three counties in the base map.</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span><span class="va">g_three_counties</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text_inset</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_inset_frame</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf_inset</span><span class="op">(</span>inset <span class="op">=</span> <span class="va">inset_config</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Visit the <a href="https://cidm-ph.github.io/ggmapinset/index.html"><code>ggmapinset</code> website</a> for more examples and other functionalities beyond what is presented here, including multiple insets.</p>
</div>
</div>
</section><section id="using-ggplotgrob-and-annotation_custom" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="using-ggplotgrob-and-annotation_custom">
<span class="header-section-number">7.5.2</span> Using <code>ggplotGrob()</code> and <code>annotation_custom()</code>
</h3>
<p>You can also use <code>ggplotGrob()</code> and <code>annotation_custom()</code> to create an inset map. The steps to achieve this are as follows:</p>
<ul>
<li>create a map of the area of interest and turn it into a <code>grob</code> object using <code>ggplotGrob()</code>
</li>
<li>create a map of the region that includes the area of interest and turn it into a <code>grob</code> object using <code>ggplotGrob()</code>
</li>
<li>combine the two using <code>annotation_custom()</code>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- convert the ggplot into a grob ---#</span></span>
<span><span class="va">grob_aoi</span> <span class="op">&lt;-</span> <span class="fu">ggplotGrob</span><span class="op">(</span><span class="va">g_three_counties</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- check the class ---#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">grob_aoi</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gtable" "gTree"  "grob"   "gDesc" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- create a map of Kansas ---#</span></span>
<span><span class="va">g_region</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">KS_county</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">three_counties</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- convert to a grob ---#</span></span>
<span><span class="va">grob_region</span> <span class="op">&lt;-</span> <span class="fu">ggplotGrob</span><span class="op">(</span><span class="va">g_region</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have two maps, we can now put them on the same map using <code>annotation_custom()</code>. The first task is to initiate a <code>ggplot</code> with <code>coord_equal()</code> as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_inset</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/inset-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You now have a blank canvas to put the images on. Let’s add a layer to the canvas using <code>annotation_custom()</code> in which you provide the <code>grob</code> object (a map) and specify the range of the canvas the map occupies. Since the extent of x and y are set to [0, 1] above with <code>coord_equal(xlim = c(0, 1), ylim = c(0, 1), expand = FALSE)</code>, the following code put the <code>grob_aoi</code> to cover the entire y range and up to 0.8 of x from 0.</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_inset</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_custom</span><span class="op">(</span><span class="va">grob_aoi</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">0.8</span>, ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/inset-annotation-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similarly, we can add <code>grob_region</code> using <code>annotation_custom()</code>. Let’s put it at the right lower corner of the map.</p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_inset</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_custom</span><span class="op">(</span><span class="va">grob_aoi</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">0.8</span>, ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_custom</span><span class="op">(</span><span class="va">grob_region</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">0.6</span>, xmax <span class="op">=</span> <span class="fl">1</span>, ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/inset-annotation-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that the resulting map still has the default theme because it does not inherit the theme of maps added by <code>annotation_custom()</code>. So, you can add <code>theme_void()</code> to the map to make the border disappear.</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_inset</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_custom</span><span class="op">(</span><span class="va">grob_aoi</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">0.8</span>, ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_custom</span><span class="op">(</span><span class="va">grob_region</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">0.6</span>, xmax <span class="op">=</span> <span class="fl">1</span>, ymin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-void-custom-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!--
#/*=================================================*/
#' # Fine-tune maps for publication
#/*=================================================*/
-->
</section></section><section id="sec-fine-tune" class="level2 page-columns page-full" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="sec-fine-tune">
<span class="header-section-number">7.6</span> Fine-tuning maps for publication</h2>
<p>This section offers several tips to enhance the appearance of your maps, making them suitable for publication in professional reports. Academic journals often have their own guidelines for figures, and reviewers or supervisors may have specific preferences for how maps should look. Regardless of the requirements, you will need to adapt your maps accordingly. It is worth noting that these techniques are not exclusive to maps—they apply to any type of figure. However, we will focus on specific components of a figure that are commonly modified when creating maps. In particular, we will cover how to use pre-made <code>ggplot2</code> themes and how to adjust legends and facet strips.</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">gw_by_county</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="va">gw_KS_sf</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">data.table</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="va">.</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>af_used <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">af_used</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">COUNTYFP</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">left_join</span><span class="op">(</span><span class="va">KS_county</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COUNTYFP"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 184 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -102.0517 ymin: 36.99302 xmax: -94.58841 ymax: 40.00316
Geodetic CRS:  NAD83
First 10 features:
   COUNTYFP     NAME year    af_used                       geometry
1       175   Seward 2010 163703.719 MULTIPOLYGON (((-101.0681 3...
2       175   Seward 2011 218863.983 MULTIPOLYGON (((-101.0681 3...
3       027     Clay 2010   5929.143 MULTIPOLYGON (((-97.3707 39...
4       027     Clay 2011   8358.903 MULTIPOLYGON (((-97.3707 39...
5       171    Scott 2010  42542.602 MULTIPOLYGON (((-101.1284 3...
6       171    Scott 2011  51620.454 MULTIPOLYGON (((-101.1284 3...
7       047  Edwards 2010 109726.389 MULTIPOLYGON (((-99.56988 3...
8       047  Edwards 2011 141487.791 MULTIPOLYGON (((-99.56988 3...
9       147 Phillips 2010   4657.746 MULTIPOLYGON (((-99.62821 3...
10      147 Phillips 2011   5076.198 MULTIPOLYGON (((-99.62821 3...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_base</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_by_county</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/base-map-fine-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="sec-theme" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="sec-theme">
<span class="header-section-number">7.6.1</span> Setting the theme</h3>
<p>Right now, the map shows geographic coordinates, gray background, and grid lines. They are not very aesthetically appealing. Adding the pre-defined theme by <code>theme_*()</code> can alter the theme of a map very quickly. One of the themes suitable for maps is <code>theme_void()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_base</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-void-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, all the axes information (<code>axis.title</code>, <code>axis.ticks</code>, <code>axis.text</code>,) and panel information (<code>panel.background</code>, <code>panel.border</code>, <code>panel.grid</code>) are gone among other parts of the figure. You can confirm this by evaluating <code>theme_void()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 136
 $ line                            : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ rect                            : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ text                            :List of 11
  ..$ family       : chr ""
  ..$ face         : chr "plain"
  ..$ colour       : chr "black"
  ..$ size         : num 11
  ..$ hjust        : num 0.5
  ..$ vjust        : num 0.5
  ..$ angle        : num 0
  ..$ lineheight   : num 0.9
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ title                           : NULL
 $ aspect.ratio                    : NULL
 $ axis.title                      : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ axis.title.x                    : NULL
 $ axis.title.x.top                : NULL
 $ axis.title.x.bottom             : NULL
 $ axis.title.y                    : NULL
 $ axis.title.y.left               : NULL
 $ axis.title.y.right              : NULL
 $ axis.text                       : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ axis.text.x                     : NULL
 $ axis.text.x.top                 : NULL
 $ axis.text.x.bottom              : NULL
 $ axis.text.y                     : NULL
 $ axis.text.y.left                : NULL
 $ axis.text.y.right               : NULL
 $ axis.text.theta                 : NULL
 $ axis.text.r                     : NULL
 $ axis.ticks                      : NULL
 $ axis.ticks.x                    : NULL
 $ axis.ticks.x.top                : NULL
 $ axis.ticks.x.bottom             : NULL
 $ axis.ticks.y                    : NULL
 $ axis.ticks.y.left               : NULL
 $ axis.ticks.y.right              : NULL
 $ axis.ticks.theta                : NULL
 $ axis.ticks.r                    : NULL
 $ axis.minor.ticks.x.top          : NULL
 $ axis.minor.ticks.x.bottom       : NULL
 $ axis.minor.ticks.y.left         : NULL
 $ axis.minor.ticks.y.right        : NULL
 $ axis.minor.ticks.theta          : NULL
 $ axis.minor.ticks.r              : NULL
 $ axis.ticks.length               : 'simpleUnit' num 0points
  ..- attr(*, "unit")= int 8
 $ axis.ticks.length.x             : NULL
 $ axis.ticks.length.x.top         : NULL
 $ axis.ticks.length.x.bottom      : NULL
 $ axis.ticks.length.y             : NULL
 $ axis.ticks.length.y.left        : NULL
 $ axis.ticks.length.y.right       : NULL
 $ axis.ticks.length.theta         : NULL
 $ axis.ticks.length.r             : NULL
 $ axis.minor.ticks.length         : 'simpleUnit' num 0points
  ..- attr(*, "unit")= int 8
 $ axis.minor.ticks.length.x       : NULL
 $ axis.minor.ticks.length.x.top   : NULL
 $ axis.minor.ticks.length.x.bottom: NULL
 $ axis.minor.ticks.length.y       : NULL
 $ axis.minor.ticks.length.y.left  : NULL
 $ axis.minor.ticks.length.y.right : NULL
 $ axis.minor.ticks.length.theta   : NULL
 $ axis.minor.ticks.length.r       : NULL
 $ axis.line                       : NULL
 $ axis.line.x                     : NULL
 $ axis.line.x.top                 : NULL
 $ axis.line.x.bottom              : NULL
 $ axis.line.y                     : NULL
 $ axis.line.y.left                : NULL
 $ axis.line.y.right               : NULL
 $ axis.line.theta                 : NULL
 $ axis.line.r                     : NULL
 $ legend.background               : NULL
 $ legend.margin                   : NULL
 $ legend.spacing                  : NULL
 $ legend.spacing.x                : NULL
 $ legend.spacing.y                : NULL
 $ legend.key                      : NULL
 $ legend.key.size                 : 'simpleUnit' num 1.2lines
  ..- attr(*, "unit")= int 3
 $ legend.key.height               : NULL
 $ legend.key.width                : NULL
 $ legend.key.spacing              : 'simpleUnit' num 5.5points
  ..- attr(*, "unit")= int 8
 $ legend.key.spacing.x            : NULL
 $ legend.key.spacing.y            : NULL
 $ legend.frame                    : NULL
 $ legend.ticks                    : NULL
 $ legend.ticks.length             : 'rel' num 0.2
 $ legend.axis.line                : NULL
 $ legend.text                     :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.text.position            : NULL
 $ legend.title                    :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.title.position           : NULL
 $ legend.position                 : chr "right"
 $ legend.position.inside          : NULL
 $ legend.direction                : NULL
 $ legend.byrow                    : NULL
 $ legend.justification            : NULL
 $ legend.justification.top        : NULL
 $ legend.justification.bottom     : NULL
 $ legend.justification.left       : NULL
 $ legend.justification.right      : NULL
 $ legend.justification.inside     : NULL
 $ legend.location                 : NULL
 $ legend.box                      : NULL
 $ legend.box.just                 : NULL
 $ legend.box.margin               : NULL
 $ legend.box.background           : NULL
 $ legend.box.spacing              : NULL
  [list output truncated]
 - attr(*, "class")= chr [1:2] "theme" "gg"
 - attr(*, "complete")= logi TRUE
 - attr(*, "validate")= logi TRUE</code></pre>
</div>
</div>
<p>Applying the theme to a map obviates the need to suppress parts of a figure individually. You can suppress parts of the figure individually using <code>theme()</code>. For example, the following code gets rid of <code>axis.text</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_base</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/theme-remove-at-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So, if <code>theme_void()</code> is overdoing things, you can build your own theme specifically for maps. For example, this is the theme I used for maps in <a href="01-Demonstration.html" class="quarto-xref"><span>Chapter 1</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theme_for_map</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying the theme to the map:</p>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_base</span> <span class="op">+</span> <span class="va">theme_for_map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/apply-theme-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is very similar to <code>theme_void()</code> except that <code>strip.background</code> is not lost.</p>
<p>You can use <code>theme_void()</code> as a starting point and override components of it like this.</p>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- bring back a color to strip.background  ---#</span></span>
<span><span class="va">theme_for_map_2</span> <span class="op">&lt;-</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- apply the new theme ---#</span></span>
<span><span class="va">g_base</span> <span class="op">+</span> <span class="va">theme_for_map_2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/void-correct-theme-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p><code>theme_bw()</code> is also a good theme for maps.</p>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_by_county</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/theme-bw-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you do not like the gray grid lines, you can remove them like this.</p>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_by_county</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.grid <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/remove-grid-lines-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Not all themes are suitable for maps. For example, <code>theme_classic()</code> is not a very good option as you can see below:</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_base</span> <span class="op">+</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/theme-classic-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you are not satisfied with <code>theme_void()</code> and not willing to make up your own theme, then you may want to take a look at other pre-made themes that are available from <code>ggplot2</code> (see <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">here</a>) and <code>ggthemes</code> (see <a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">here</a>). Note that some themes are more invasive than <code>theme_void()</code>, altering the default color scale.</p>
</section><section id="legend" class="level3 page-columns page-full" data-number="7.6.2"><h3 data-number="7.6.2" class="anchored" data-anchor-id="legend">
<span class="header-section-number">7.6.2</span> Legend</h3>
<p>Legends can be modified using <code>legend.*()</code> options for <code>theme()</code> and <code>guide_*()</code>. It is impossible to discuss every single one of all the options for these functions. So, this section focuses on the most common and useful (that I consider) modifications you can make to legends.</p>
<p>A legend consists of three elements: legend title, legend key (e.g., color bar), and legend label (or legend text). For example, in the figure below, <code>af_used</code> is the legend title, the color bar is the legend key, and the numbers below the color bar are legend labels. Knowing the name of these elements helps because the name of the options contains the name of the specific part of the legend.</p>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_legend</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_by_county</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-start-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s first change the color scale to Viridis using <code>scale_fill_viridis_c()</code> (see <a href="#sec-color-scale" class="quarto-xref"><span>Section 7.3</span></a> for picking a color scale).</p>
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-viridis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Right now, the legend title is <code>af_used</code>, which does not tell the readers what it means. In general, you can change the title of a legend by using the <code>name</code> option inside the <code>scale</code> function for the legend (here, <code>scale_fill_viridis_c()</code>). So, this one works:</p>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-title-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, you can use <code>labs()</code> function.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Since the legend is for the <code>fill</code> aesthetic attribute, you should add <code>fill = "legend title"</code> as follows:</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;<code>labs()</code> can also be used to specify the x- and y-axis titles.</p></div></div><div class="cell">
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-fill-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since the legend title is long, the legend is taking up about the half of the space of the entire figure. So, let’s put the legend below the maps (bottom of the figure) by adding <code>theme(legend.position = "bottom")</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-bottom-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It would be aesthetically better to have the legend title on top of the color bar. This can be done by using the <code>guides()</code> function. Since we would like to alter the aesthetics of the legend for <code>fill</code> involving a color bar, we use <code>fill = guide_colorbar()</code>. To place the legend title on top, you add <code>title.position="top"</code> inside the <code>guide_colorbar()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-bar-top-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This looks better. But, the legend labels are too close to each other so it is hard to read them because the color bar is too short. Let’s elongate the color bar so that we have enough space between legend labels using <code>legend.key.width =</code> option for <code>theme()</code>. Let’s also make the legend thinner using <code>legend.key.height =</code> option.</p>
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    <span class="co">#--- NEW LINES HERE!! ---#</span></span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-key-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If the journal you are submitting an article to is requesting a specific font family for the texts in the figure, you can use <code>legend.text = element_text()</code> and <code>legend.title = element_text()</code> inside <code>theme()</code> for the legend labels and legend title, respectively. The following code uses the font family of “Times” and font size of 12 for both the labels and the title.</p>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>    <span class="co">#--- NEW LINES HERE!! ---#</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-text-font-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the other options to control the legend with a color bar, see <a href="https://ggplot2.tidyverse.org/reference/guide_colorbar.html">here</a>.</p>
<hr>
<p>When the legend is made for discrete values, you can use <code>guide_legend()</code>. Let’s use the following map as a starting point.</p>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- convert af_used to a discrete variable ---#</span></span>
<span><span class="va">gw_Stevens</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">gw_Stevens</span>, af_used_cat <span class="op">=</span> <span class="fu">cut_number</span><span class="op">(</span><span class="va">af_used</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_legend_2</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_Stevens</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used_cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_viridis</span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">TRUE</span>, option <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/tmax-viridis-D-discrete-guide-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The legend is too long, so first put the legend title on top of the legend labels using the code below:</p>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend_2</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-title-top-again-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since the legend is for the <code>color</code> aesthetic attribute, <code>color = guide_legend()</code> was used. The legend labels are still a bit too long, so let’s arrange them in two rows using the <code>nrow =</code> option.</p>
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_legend_2</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/lg-title-row-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the other options for <code>guide_legend()</code>, see <a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">here</a>.</p>
<!--
#/*=================================================*/
#' # Saving a `ggplot` object as an image
#/*=================================================*/
-->
</section><section id="facet-strips" class="level3" data-number="7.6.3"><h3 data-number="7.6.3" class="anchored" data-anchor-id="facet-strips">
<span class="header-section-number">7.6.3</span> Facet strips</h3>
<p>Facet strips refer to the area of boxed where the values of faceting variables are printed. In the figure below, it’s gray strips on top of the maps. You can change how they look using <code>strip.*</code> options in <code>theme()</code> and also partially inside <code>facet_wrap()</code> and <code>facet_grid()</code>. Here is the list of available options:</p>
<ul>
<li>
<code>strip.background</code>, <code>strip.background.x</code>, <code>strip.background.y</code>
</li>
<li><code>strip.placement</code></li>
<li>
<code>strip.text</code>, <code>strip.text.x</code>, <code>strip.text.y</code>
</li>
<li><code>strip.switch.pad.grid</code></li>
<li><code>strip.switch.pad.wrap</code></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">(</span><span class="va">af_used</span> <span class="op">&gt;</span> <span class="fl">500</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-wrap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To make texts in the strips more descriptive of what they actually mean you can make variable that have texts you want to show on the map as their values.</p>
<div class="cell">
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gw_KS_sf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">gw_KS_sf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    high_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">af_used</span> <span class="op">&gt;</span> <span class="fl">500</span>, <span class="st">"High water use"</span>, <span class="st">"Low water use"</span><span class="op">)</span>,</span>
<span>    year_txt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Year: "</span>, <span class="va">year</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="va">g_facet</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- KS county boundary ---#</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- wells ---#</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">high_low</span> <span class="op">~</span> <span class="va">year_txt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-text-change-show-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You probably noticed that the high water use cases are now appear on top. This is because the panels of figures are arranged in a way that the strip texts are alphabetically ordered. <code>High water use</code> precedes <code>Low water use</code>. Sometimes, this is not desirable. To force a specific order, you can turn the faceting variable (here <code>high_low</code>) into a <code>factor</code> with the order of its values defined using <code>levels =</code>. The following code converts <code>high_low</code> into a factor where “Low water use” is the first level and “High water use” is the second level.</p>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gw_KS_sf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="va">gw_KS_sf</span>,</span>
<span>    high_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">high_low</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low water use"</span>, <span class="st">"High water use"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, “Low water use” cases appear first (on top).</p>
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- KS county boundary ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">KS_county</span>, <span class="fl">32614</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- wells ---#</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gw_KS_sf</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">af_used</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- facet by year (side by side) ---#</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">high_low</span> <span class="op">~</span> <span class="va">year_txt</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g_facet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/show-order-change-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can control how strip texts and strip boxes appear using <code>strip.text</code> and <code>strip.background</code> options. Here is an example:</p>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-strip-background-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Instead of having descriptions of cases on top of the figures, you could have one of the descriptions on the right side of the figures using <code>facet_grid()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_wrap(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">high_low</span> <span class="op">~</span> <span class="va">year_txt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-right-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now case descriptions for <code>high_low</code> are too long and it is squeezing the space for maps. Let’s flip <code>high_low</code> and <code>year</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/facet-right-left-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is slightly better than before, but not much. Let’s rotate strip texts for <code>year</code> using the <code>angle =</code> option.</p>
<div class="cell">
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/angle-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since we only want to change the angle of strip texts for the second faceting variable, we need to work on <code>strip.text.y</code> (if you want to work on the first one, you use <code>strip.text.x</code>.).</p>
<p>Let’s change the size of the strip texts to 12 and use <code>Times</code> font family.</p>
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- moves up the strip texts ---#</span></span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/font-times-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The strip texts for <code>high_low</code> are too close to maps that letter “g” in “High” is truncated. Let’s move them up.</p>
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    <span class="co">#--- moves up the strip texts ---#</span></span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/move-g-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now the upper part of the letters is truncated. We could just put more margin below the texts using the <code>margin = margin(top, right, bottom, left, unit in text)</code> option.</p>
<div class="cell">
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/more-margin-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For completeness, let’s make the legend look better as well (this is discussed in <a href="#sec-theme" class="quarto-xref"><span>Section 7.6.1</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_facet</span> <span class="op">+</span></span>
<span>  <span class="co">#--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">year_txt</span> <span class="op">~</span> <span class="va">high_low</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Groundwater pumping (acre-feet)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"Times"</span><span class="op">)</span></span>
<span>    <span class="co">#--- NEW LINES HERE!! ---#</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/make-legend-look-better-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alright, setting aside the problem of whether the information provided in the maps is meaningful or not, the maps look great at least.</p>
</section><section id="north-arrow-and-scale-bar" class="level3" data-number="7.6.4"><h3 data-number="7.6.4" class="anchored" data-anchor-id="north-arrow-and-scale-bar">
<span class="header-section-number">7.6.4</span> North arrow and scale bar</h3>
<p>The <code>ggspatial</code> package lets you put a north arrow and scale bar on a map using <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale()</a></code> and <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- get North Carolina county borders ---#</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `nc' from data source 
  `/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/sf/shape/nc.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 100 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
Geodetic CRS:  NAD27</code></pre>
</div>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="co">#--- create a simple map ---#</span></span>
<span>  <span class="va">g_nc</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/nc-read-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is an example code that adds a scale bar:</p>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- load ggspatial ---#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- add scale bar ---#</span></span>
<span><span class="va">g_nc</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"bl"</span>,</span>
<span>    width_hint <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>location</code> determines where the scale bar is. The first letter is either <code>t</code> (top) or <code>b</code> (bottom), and the second letter is either <code>l (left)</code> or <code>r</code> (right). <code>width_hint</code> is the length of the scale bar relative to the plot. The distance number (200 km) was generated automatically according to the length of the bar.</p>
<p>You can add pads from the plot border to fine tune the location of the scale bar:</p>
<div class="cell">
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_nc</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"bl"</span>,</span>
<span>    width_hint <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    pad_x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">3</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    pad_y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-pads-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A positive number means that the scale bar will be placed further away from closest border of the plot.</p>
<p>You can add a north arrow using <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow()</a></code>. Accepted arguments are similar to those for <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g_nc</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"bl"</span>,</span>
<span>    width_hint <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    pad_x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">3</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#--- add north arrow ---#</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"tl"</span>,</span>
<span>    pad_x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"in"</span><span class="op">)</span>,</span>
<span>    pad_y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.1</span>, <span class="st">"in"</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="va">north_arrow_fancy_orienteering</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="07-CreateMaps-ggplot_files/figure-html/add-north-arrow-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are several <code>style</code>s you can pick from. Run <code><a href="https://paleolimbot.github.io/ggspatial/reference/north_arrow_orienteering.html">?north_arrow_orienteering</a></code> to see other options.</p>
</section></section><section id="sec-ggsave" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="sec-ggsave">
<span class="header-section-number">7.7</span> Saving a <code>ggplot</code> object as an image</h2>
<p>Maps created with <code>ggplot2</code> can be saved using <code>ggsave()</code> with the following syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> file name, <span class="at">plot =</span> ggplot object)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co">#--- or just this ---#</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(file name, ggplot object)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Many different file formats are supported including pdf, svg, eps, png, jpg, tif, etc. One thing you want to keep in mind is the type of graphics:</p>
<ul>
<li>vector graphics (pdf, svg, eps)</li>
<li>raster graphics (jpg, png, tif)</li>
</ul>
<p>While vector graphics are scalable, raster graphics are not. If you enlarge raster graphics, the cells making up the figure become visible, making the figure unappealing. So, unless it is required to save figures as raster graphics, it is encouraged to save figures as vector graphics.</p>
<p>Let’s try to save the following <code>ggplot</code> object.</p>
<div class="cell" data-output-location="column">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- get North Carolina county borders ---#</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Reading layer `nc' from data source 
  `/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/sf/shape/nc.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 100 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
Geodetic CRS:  NAD27</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="co">#--- create a map ---#</span></span>
<span>  <span class="va">g_nc</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-make-g-nc-to-save" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-make-g-nc-to-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-CreateMaps-ggplot_files/figure-html/fig-make-g-nc-to-save-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-make-g-nc-to-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Map to save
</figcaption></figure>
</div>
</div>
</div>
<p><code>ggsave()</code> automatically detects the file format from the file name. For example, the following code saves <code>g_nc</code> as nc.pdf. <code>ggsave()</code> knows the <code>ggplot</code> object was intended to be saved as a pdf file from the extension of the specified file name.</p>
<div class="cell">
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc.pdf"</span>, <span class="va">g_nc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly,</p>
<div class="cell">
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- save as an eps file ---#</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc.eps"</span>, <span class="va">g_nc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- save as an eps file ---#</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc.svg"</span>, <span class="va">g_nc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can change the output size with <code>height</code> and <code>width</code> options. For example, the following code creates a pdf file of <code>height = 5</code> inches and <code>width = 7</code> inches.</p>
<div class="cell">
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc.pdf"</span>, <span class="va">g_nc</span>, height <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You change the unit with the <code>units</code> option. By default, <code>in</code> (inches) is used.</p>
<p>You can control the resolution of the output image by specifying DPI (dots per inch) using the <code>dpi</code> option. The default DPI value is 300, but you can specify any value suitable for the output image, including “retina” (320) or “screen” (72). 600 or higher is recommended when a high resolution output is required.</p>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#--- dpi = 320 ---#</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc_dpi_320.png"</span>, <span class="va">g_nc</span>, height <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="fl">7</span>, dpi <span class="op">=</span> <span class="fl">320</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- dpi = 72 ---#</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"nc_dpi_screen.png"</span>, <span class="va">g_nc</span>, height <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="fl">7</span>, dpi <span class="op">=</span> <span class="st">"screen"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tmieno2\.github\.io\/R-as-GIS-for-Economists\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/06-stars.html" class="pagination-link" aria-label="Spatiotemporal Raster Data Handling with `stars`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatiotemporal Raster Data Handling with <code>stars</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/08-DownloadSpatialData.html" class="pagination-link" aria-label="Download and process spatial datasets from within R">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Download and process spatial datasets from within R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb153" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Creating Maps using `ggplot2` {#sec-create-maps}</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">## Before you start {-}</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>In previous chapters, we explored how to quickly create simple maps using vector and raster data. This section will focus on using <span class="in">`ggplot2`</span> to produce high-quality maps suitable for publication in journal articles, conference presentations, and professional reports. Achieving this level of quality requires refining the map's aesthetics beyond default settings. This includes choosing appropriate color schemes, removing extraneous elements, and formatting legends. The focus here is on creating static maps, not the interactive ones commonly found on the web.</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>Creating maps differs from creating non-spatial figures in some aspects, but the underlying principles and syntax in <span class="in">`ggplot2`</span> for both are quite similar. If you already have experience with <span class="in">`ggplot2`</span>, you will find map-making intuitive and straightforward, even if you have never used it for spatial data before. The primary difference lies in the choice of <span class="in">`geom_*()`</span> functions. For spatial data visualization, several specialized <span class="in">`geom_*()`</span> types are available.</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`ggplot2::geom_sf()`</span> for <span class="in">`sf`</span> (vector) objects</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`tidyterra::geom_spatraster()`</span> for <span class="in">`SpatRaster`</span> (raster) objects</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`stars::geom_stars()`</span> for <span class="in">`stars`</span> (raster) objects^<span class="co">[</span><span class="ot">see @sec-stars-basics for how `stars` package works</span><span class="co">]</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>These <span class="in">`geom_*()`</span> functions enable the visualization of both vector and raster data using the consistent and straightforward syntax of <span class="in">`ggplot2`</span>. In the following sections, @sec-geom-sf and @sec-geom-raster, we will explore each of the <span class="in">`geom_*()`</span>s individually to understand their basic usage. You will also notice that the principles discussed in the subsequent sections are not specific to spatial data—they are general and applicable to any type of figure.</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>Finally, another great package for mapping is the <span class="in">`tmap`</span> package (<span class="co">[</span><span class="ot">package website</span><span class="co">](https://r-tmap.github.io/tmap/)</span>). It also follows the grammar of graphics like <span class="in">`ggplot2`</span>, and those who are already familiar with <span class="in">`ggplot2`</span> will find it very intuitive to use. Given that the package website and <span class="co">[</span><span class="ot">Chapter 9</span><span class="co">](https://r-tmap.github.io/tmap/)</span> of <span class="co">[</span><span class="ot">Geocomputation with R</span><span class="co">](https://r.geocompx.org/)</span> already have great treatments of how to create maps with the package. This book does not cover this topic.</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>Another excellent package for mapping is the <span class="in">`tmap`</span> package (<span class="co">[</span><span class="ot">package website</span><span class="co">](https://r-tmap.github.io/tmap/)</span>). Like <span class="in">`ggplot2`</span>, it follows the grammar of graphics, making it intuitive for users familiar with <span class="in">`ggplot2`</span>. Since the package website and <span class="co">[</span><span class="ot">Chapter 9 of Geocomputation with R</span><span class="co">](https://r-tmap.github.io/tmap/)</span> already provide excellent guides on creating maps with <span class="in">`tmap`</span>, this book does not cover the topic.</span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>Although this chapter does not require extensive knowledge of <span class="in">`ggplot2`</span>, having a basic understanding of it will be extremely helpful. If you are unfamiliar with <span class="in">`ggplot2`</span> or feel that your knowledge is insufficient, Appendix @sec-ggplot2-minimals offers a minimal introduction to data visualization using the <span class="in">`ggplot2`</span> package. This should provide enough background to help you follow along with the content in this chapter.</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">ggplot2: Elegant Graphics for Data Analysis</span><span class="co">](https://ggplot2-book.org/)</span> provides a fuller treatment of how <span class="in">`ggplot2`</span> works </span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a><span class="fu">### Direction for replication {-}</span></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a>**Datasets**</span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a>All the datasets that you need to import are available <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.dropbox.com/sh/6utlzzzj2zzr079/AACu5QxM_-bgwWzVzd5xcX4fa?dl=0)</span>. In this chapter, file paths are set relative to my working directory (which is not shown). To run the code without having to adjust the file paths, follow these steps:</span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>set a folder (any folder) as the working directory using <span class="in">`setwd()`</span></span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>create a folder called "Data" inside the folder designated as the working directory (if you have created a "Data" folder previously, skip this step)</span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>download the pertinent datasets from <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.dropbox.com/sh/6utlzzzj2zzr079/AACu5QxM_-bgwWzVzd5xcX4fa?dl=0)</span></span>
<span id="cb153-34"><a href="#cb153-34" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>place all the files in the downloaded folder in the "Data" folder</span>
<span id="cb153-35"><a href="#cb153-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-36"><a href="#cb153-36" aria-hidden="true" tabindex="-1"></a>**Packages**</span>
<span id="cb153-37"><a href="#cb153-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-38"><a href="#cb153-38" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Run the following code to install or load (if already installed) the <span class="in">`pacman`</span> package, and then install or load (if already installed) the listed package inside the <span class="in">`pacman::p_load()`</span> function.</span>
<span id="cb153-39"><a href="#cb153-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-40"><a href="#cb153-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Chap_packages, results = "hide", cache = F}</span></span>
<span id="cb153-41"><a href="#cb153-41" aria-hidden="true" tabindex="-1"></a><span class="in">if (!require("pacman")) install.packages("pacman")</span></span>
<span id="cb153-42"><a href="#cb153-42" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(</span></span>
<span id="cb153-43"><a href="#cb153-43" aria-hidden="true" tabindex="-1"></a><span class="in">  stars, # spatiotemporal data handling</span></span>
<span id="cb153-44"><a href="#cb153-44" aria-hidden="true" tabindex="-1"></a><span class="in">  raster, # raster data handling</span></span>
<span id="cb153-45"><a href="#cb153-45" aria-hidden="true" tabindex="-1"></a><span class="in">  terra, # raster data handling</span></span>
<span id="cb153-46"><a href="#cb153-46" aria-hidden="true" tabindex="-1"></a><span class="in">  tidyterra, # for tidyverse like operations on terra objects</span></span>
<span id="cb153-47"><a href="#cb153-47" aria-hidden="true" tabindex="-1"></a><span class="in">  sf, # vector data handling</span></span>
<span id="cb153-48"><a href="#cb153-48" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr, # data wrangling</span></span>
<span id="cb153-49"><a href="#cb153-49" aria-hidden="true" tabindex="-1"></a><span class="in">  stringr, # string manipulation</span></span>
<span id="cb153-50"><a href="#cb153-50" aria-hidden="true" tabindex="-1"></a><span class="in">  lubridate, # dates handling</span></span>
<span id="cb153-51"><a href="#cb153-51" aria-hidden="true" tabindex="-1"></a><span class="in">  data.table, # data wrangling</span></span>
<span id="cb153-52"><a href="#cb153-52" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork, # arranging figures</span></span>
<span id="cb153-53"><a href="#cb153-53" aria-hidden="true" tabindex="-1"></a><span class="in">  tigris, # county border</span></span>
<span id="cb153-54"><a href="#cb153-54" aria-hidden="true" tabindex="-1"></a><span class="in">  colorspace, # color scale</span></span>
<span id="cb153-55"><a href="#cb153-55" aria-hidden="true" tabindex="-1"></a><span class="in">  viridis, # arranging figures</span></span>
<span id="cb153-56"><a href="#cb153-56" aria-hidden="true" tabindex="-1"></a><span class="in">  tidyr, # reshape</span></span>
<span id="cb153-57"><a href="#cb153-57" aria-hidden="true" tabindex="-1"></a><span class="in">  ggspatial, # north arrow and scale bar</span></span>
<span id="cb153-58"><a href="#cb153-58" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2, # make maps</span></span>
<span id="cb153-59"><a href="#cb153-59" aria-hidden="true" tabindex="-1"></a><span class="in">  ggmapinset # make inset maps</span></span>
<span id="cb153-60"><a href="#cb153-60" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-61"><a href="#cb153-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-62"><a href="#cb153-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-63"><a href="#cb153-63" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-64"><a href="#cb153-64" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-65"><a href="#cb153-65" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Creating maps from `sf` objects</span></span>
<span id="cb153-66"><a href="#cb153-66" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-67"><a href="#cb153-67" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-68"><a href="#cb153-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-69"><a href="#cb153-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating maps from `sf` objects {#sec-geom-sf}</span></span>
<span id="cb153-70"><a href="#cb153-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-71"><a href="#cb153-71" aria-hidden="true" tabindex="-1"></a>This section explains how to create maps from vector data stored as an <span class="in">`sf`</span> object via <span class="in">`geom_sf()`</span>.</span>
<span id="cb153-72"><a href="#cb153-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-73"><a href="#cb153-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Datasets</span></span>
<span id="cb153-74"><a href="#cb153-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-75"><a href="#cb153-75" aria-hidden="true" tabindex="-1"></a>The following datasets will be used for illustrations.</span>
<span id="cb153-76"><a href="#cb153-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-77"><a href="#cb153-77" aria-hidden="true" tabindex="-1"></a>**Points**</span>
<span id="cb153-78"><a href="#cb153-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-79"><a href="#cb153-79" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`well_id`</span>: well ID</span>
<span id="cb153-80"><a href="#cb153-80" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`af_used`</span>: total annual groundwater pumping at individual irrigation wells</span>
<span id="cb153-81"><a href="#cb153-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-82"><a href="#cb153-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import_KS_wells_ch_9}</span></span>
<span id="cb153-83"><a href="#cb153-83" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: true</span></span>
<span id="cb153-84"><a href="#cb153-84" aria-hidden="true" tabindex="-1"></a><span class="in">#--- read in the KS wells data ---#</span></span>
<span id="cb153-85"><a href="#cb153-85" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-86"><a href="#cb153-86" aria-hidden="true" tabindex="-1"></a><span class="in">  gw_KS_sf &lt;- readRDS("Data/gw_KS_sf.rds")</span></span>
<span id="cb153-87"><a href="#cb153-87" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-88"><a href="#cb153-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-89"><a href="#cb153-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-90"><a href="#cb153-90" aria-hidden="true" tabindex="-1"></a>**Polygons**</span>
<span id="cb153-91"><a href="#cb153-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-92"><a href="#cb153-92" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`COUNTYFP`</span>: county FIPs code</span>
<span id="cb153-93"><a href="#cb153-93" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`NAME`</span>: county name</span>
<span id="cb153-94"><a href="#cb153-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-95"><a href="#cb153-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r county-KS}</span></span>
<span id="cb153-96"><a href="#cb153-96" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: true</span></span>
<span id="cb153-97"><a href="#cb153-97" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-98"><a href="#cb153-98" aria-hidden="true" tabindex="-1"></a><span class="in">  KS_county &lt;- </span></span>
<span id="cb153-99"><a href="#cb153-99" aria-hidden="true" tabindex="-1"></a><span class="in">    tigris::counties(state = "Kansas", cb = TRUE, progress_bar = FALSE) %&gt;%</span></span>
<span id="cb153-100"><a href="#cb153-100" aria-hidden="true" tabindex="-1"></a><span class="in">    sf::st_as_sf() %&gt;%</span></span>
<span id="cb153-101"><a href="#cb153-101" aria-hidden="true" tabindex="-1"></a><span class="in">    sf::st_transform(st_crs(gw_KS_sf)) %&gt;%</span></span>
<span id="cb153-102"><a href="#cb153-102" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::select(COUNTYFP, NAME)</span></span>
<span id="cb153-103"><a href="#cb153-103" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-104"><a href="#cb153-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-105"><a href="#cb153-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-106"><a href="#cb153-106" aria-hidden="true" tabindex="-1"></a>**Lines**</span>
<span id="cb153-107"><a href="#cb153-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-108"><a href="#cb153-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import-railroads}</span></span>
<span id="cb153-109"><a href="#cb153-109" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: true</span></span>
<span id="cb153-110"><a href="#cb153-110" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: "hide"</span></span>
<span id="cb153-111"><a href="#cb153-111" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-112"><a href="#cb153-112" aria-hidden="true" tabindex="-1"></a><span class="in">  KS_railroads &lt;- </span></span>
<span id="cb153-113"><a href="#cb153-113" aria-hidden="true" tabindex="-1"></a><span class="in">    sf::st_read(dsn = "Data/", layer = "tl_2015_us_rails") %&gt;%</span></span>
<span id="cb153-114"><a href="#cb153-114" aria-hidden="true" tabindex="-1"></a><span class="in">    sf::st_crop(KS_county)</span></span>
<span id="cb153-115"><a href="#cb153-115" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-116"><a href="#cb153-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-117"><a href="#cb153-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-118"><a href="#cb153-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-railroads}</span></span>
<span id="cb153-119"><a href="#cb153-119" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: true</span></span>
<span id="cb153-120"><a href="#cb153-120" aria-hidden="true" tabindex="-1"></a><span class="in">KS_railroads</span></span>
<span id="cb153-121"><a href="#cb153-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-122"><a href="#cb153-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-123"><a href="#cb153-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic usage of `geom_sf()`</span></span>
<span id="cb153-124"><a href="#cb153-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-125"><a href="#cb153-125" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_sf()`</span> enables the visualization of sf objects. It automatically detects the geometry type of spatial data stored in <span class="in">`sf`</span> and renders maps accordingly. For example, the following code generates maps for Kansas wells (points), Kansas counties (polygons), and Kansas railroads (lines):</span>
<span id="cb153-126"><a href="#cb153-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-127"><a href="#cb153-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map}</span></span>
<span id="cb153-128"><a href="#cb153-128" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-129"><a href="#cb153-129" aria-hidden="true" tabindex="-1"></a><span class="in">  g_wells &lt;-</span></span>
<span id="cb153-130"><a href="#cb153-130" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = gw_KS_sf) +</span></span>
<span id="cb153-131"><a href="#cb153-131" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf()</span></span>
<span id="cb153-132"><a href="#cb153-132" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-133"><a href="#cb153-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-134"><a href="#cb153-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-135"><a href="#cb153-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r county-map}</span></span>
<span id="cb153-136"><a href="#cb153-136" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-137"><a href="#cb153-137" aria-hidden="true" tabindex="-1"></a><span class="in">  g_county &lt;-</span></span>
<span id="cb153-138"><a href="#cb153-138" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = KS_county) +</span></span>
<span id="cb153-139"><a href="#cb153-139" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf()</span></span>
<span id="cb153-140"><a href="#cb153-140" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-141"><a href="#cb153-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-142"><a href="#cb153-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-143"><a href="#cb153-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lines-map}</span></span>
<span id="cb153-144"><a href="#cb153-144" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-145"><a href="#cb153-145" aria-hidden="true" tabindex="-1"></a><span class="in">  g_rail &lt;-</span></span>
<span id="cb153-146"><a href="#cb153-146" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = KS_railroads) +</span></span>
<span id="cb153-147"><a href="#cb153-147" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf()</span></span>
<span id="cb153-148"><a href="#cb153-148" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-149"><a href="#cb153-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-150"><a href="#cb153-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-151"><a href="#cb153-151" aria-hidden="true" tabindex="-1"></a>As demonstrated, different geometry types—such as points, polygons, and lines—are handled seamlessly by a single <span class="in">`geom`</span> function, <span class="in">`geom_sf()`</span>. Additionally, note that in the example code, neither the x-axis (longitude) nor the y-axis (latitude) needs to be explicitly specified. When creating a map, longitude and latitude are automatically assigned to the x- and y-axes, respectively. <span class="in">`geom_sf()`</span> intelligently detects the geometry type and renders spatial objects accordingly.</span>
<span id="cb153-152"><a href="#cb153-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-153"><a href="#cb153-153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specifying the aesthetics</span></span>
<span id="cb153-154"><a href="#cb153-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-155"><a href="#cb153-155" aria-hidden="true" tabindex="-1"></a>There are various aesthetics options you can use. Available aesthetics vary by the type of geometry. This section shows the basics of how to specify the aesthetics of maps. Finer control of aesthetics will be discussed later.</span>
<span id="cb153-156"><a href="#cb153-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-157"><a href="#cb153-157" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Points</span></span>
<span id="cb153-158"><a href="#cb153-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-159"><a href="#cb153-159" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: color of the points</span>
<span id="cb153-160"><a href="#cb153-160" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**fill**: available for some shapes (but likely useless)</span>
<span id="cb153-161"><a href="#cb153-161" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**shape**: shape of the points</span>
<span id="cb153-162"><a href="#cb153-162" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**size**: size of the points (rarely useful)</span>
<span id="cb153-163"><a href="#cb153-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-164"><a href="#cb153-164" aria-hidden="true" tabindex="-1"></a>For illustration here, let's focus on the wells in one county so it is easy to detect the differences across various aesthetics configurations.</span>
<span id="cb153-165"><a href="#cb153-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-166"><a href="#cb153-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gw-stevens, results = "hide"}</span></span>
<span id="cb153-167"><a href="#cb153-167" aria-hidden="true" tabindex="-1"></a><span class="in">#--- wells in Stevens County ---#</span></span>
<span id="cb153-168"><a href="#cb153-168" aria-hidden="true" tabindex="-1"></a><span class="in">gw_Stevens &lt;- </span></span>
<span id="cb153-169"><a href="#cb153-169" aria-hidden="true" tabindex="-1"></a><span class="in">  KS_county %&gt;%</span></span>
<span id="cb153-170"><a href="#cb153-170" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::filter(NAME == "Stevens") %&gt;%</span></span>
<span id="cb153-171"><a href="#cb153-171" aria-hidden="true" tabindex="-1"></a><span class="in">  sf::st_crop(gw_KS_sf, .)</span></span>
<span id="cb153-172"><a href="#cb153-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-173"><a href="#cb153-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-174"><a href="#cb153-174" aria-hidden="true" tabindex="-1"></a>**example 1**</span>
<span id="cb153-175"><a href="#cb153-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-176"><a href="#cb153-176" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: dependent on <span class="in">`af_used`</span> (the amount of groundwater extraction)</span>
<span id="cb153-177"><a href="#cb153-177" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**size**: constant across the points (bigger than default)</span>
<span id="cb153-178"><a href="#cb153-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-179"><a href="#cb153-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-e1}</span></span>
<span id="cb153-180"><a href="#cb153-180" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-181"><a href="#cb153-181" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-182"><a href="#cb153-182" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(aes(color = af_used), size = 2)</span></span>
<span id="cb153-183"><a href="#cb153-183" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-184"><a href="#cb153-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-185"><a href="#cb153-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-186"><a href="#cb153-186" aria-hidden="true" tabindex="-1"></a>**example 2**</span>
<span id="cb153-187"><a href="#cb153-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-188"><a href="#cb153-188" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: constant across the points (blue)</span>
<span id="cb153-189"><a href="#cb153-189" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**size**: dependent on <span class="in">`af_used`</span></span>
<span id="cb153-190"><a href="#cb153-190" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**shape**: constant across the points (square)</span>
<span id="cb153-191"><a href="#cb153-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-192"><a href="#cb153-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-e2}</span></span>
<span id="cb153-193"><a href="#cb153-193" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-194"><a href="#cb153-194" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-195"><a href="#cb153-195" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(aes(size = af_used), color = "blue", shape = 15)</span></span>
<span id="cb153-196"><a href="#cb153-196" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-197"><a href="#cb153-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-198"><a href="#cb153-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-199"><a href="#cb153-199" aria-hidden="true" tabindex="-1"></a>**example 3**</span>
<span id="cb153-200"><a href="#cb153-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-201"><a href="#cb153-201" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: dependent on whether located east of west of -101.3 in longitude</span>
<span id="cb153-202"><a href="#cb153-202" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**shape**: dependent on whether located east of west of -101.3 in longitude</span>
<span id="cb153-203"><a href="#cb153-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-204"><a href="#cb153-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-e3}</span></span>
<span id="cb153-205"><a href="#cb153-205" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-206"><a href="#cb153-206" aria-hidden="true" tabindex="-1"></a><span class="in">  gw_Stevens %&gt;%</span></span>
<span id="cb153-207"><a href="#cb153-207" aria-hidden="true" tabindex="-1"></a><span class="in">    cbind(., st_coordinates(.)) %&gt;%</span></span>
<span id="cb153-208"><a href="#cb153-208" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::mutate(east_west = ifelse(X &lt; -101.3, "west", "east")) %&gt;%</span></span>
<span id="cb153-209"><a href="#cb153-209" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = .) +</span></span>
<span id="cb153-210"><a href="#cb153-210" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(aes(shape = east_west, color = east_west))</span></span>
<span id="cb153-211"><a href="#cb153-211" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-212"><a href="#cb153-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-213"><a href="#cb153-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-214"><a href="#cb153-214" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Polygons</span></span>
<span id="cb153-215"><a href="#cb153-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-216"><a href="#cb153-216" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: color of the **borders** of the polygons</span>
<span id="cb153-217"><a href="#cb153-217" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**fill**: color of the **inside** of the polygons</span>
<span id="cb153-218"><a href="#cb153-218" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**shape**: not available</span>
<span id="cb153-219"><a href="#cb153-219" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**size**: not available</span>
<span id="cb153-220"><a href="#cb153-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-221"><a href="#cb153-221" aria-hidden="true" tabindex="-1"></a>**example 1**</span>
<span id="cb153-222"><a href="#cb153-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-223"><a href="#cb153-223" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: constant (red)</span>
<span id="cb153-224"><a href="#cb153-224" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**fill**: constant (dark green)</span>
<span id="cb153-225"><a href="#cb153-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-226"><a href="#cb153-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r county-map-e1}</span></span>
<span id="cb153-227"><a href="#cb153-227" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = KS_county) +</span></span>
<span id="cb153-228"><a href="#cb153-228" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(color = "red", fill = "darkgreen")</span></span>
<span id="cb153-229"><a href="#cb153-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-230"><a href="#cb153-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-231"><a href="#cb153-231" aria-hidden="true" tabindex="-1"></a>**example 2**</span>
<span id="cb153-232"><a href="#cb153-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-233"><a href="#cb153-233" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**color**: default (black)</span>
<span id="cb153-234"><a href="#cb153-234" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>**fill**: dependent on the total amount of pumping in 2010</span>
<span id="cb153-235"><a href="#cb153-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-236"><a href="#cb153-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r county-map-e2-echo}</span></span>
<span id="cb153-237"><a href="#cb153-237" aria-hidden="true" tabindex="-1"></a><span class="in">KS_county_with_pumping &lt;-</span></span>
<span id="cb153-238"><a href="#cb153-238" aria-hidden="true" tabindex="-1"></a><span class="in">  gw_KS_sf %&gt;%</span></span>
<span id="cb153-239"><a href="#cb153-239" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- only year == 2010 ---#</span></span>
<span id="cb153-240"><a href="#cb153-240" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::filter(year == 2010) %&gt;%</span></span>
<span id="cb153-241"><a href="#cb153-241" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- get total pumping by county ---#</span></span>
<span id="cb153-242"><a href="#cb153-242" aria-hidden="true" tabindex="-1"></a><span class="in">  aggregate(., KS_county, sum, na.rm = TRUE)</span></span>
<span id="cb153-243"><a href="#cb153-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-244"><a href="#cb153-244" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = KS_county_with_pumping) +</span></span>
<span id="cb153-245"><a href="#cb153-245" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(aes(fill = af_used))</span></span>
<span id="cb153-246"><a href="#cb153-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-247"><a href="#cb153-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-248"><a href="#cb153-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-249"><a href="#cb153-249" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plotting multiple spatial objects in one figure</span></span>
<span id="cb153-250"><a href="#cb153-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-251"><a href="#cb153-251" aria-hidden="true" tabindex="-1"></a>You can combine all the layers created by <span class="in">`geom_sf()`</span> additively so they appear in a single map:</span>
<span id="cb153-252"><a href="#cb153-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-253"><a href="#cb153-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g-multiple-1}</span></span>
<span id="cb153-254"><a href="#cb153-254" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-255"><a href="#cb153-255" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_wells ---#</span></span>
<span id="cb153-256"><a href="#cb153-256" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, size = 0.4) +</span></span>
<span id="cb153-257"><a href="#cb153-257" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_county ---#</span></span>
<span id="cb153-258"><a href="#cb153-258" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-259"><a href="#cb153-259" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_railroads ---#</span></span>
<span id="cb153-260"><a href="#cb153-260" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads, color = "red")</span></span>
<span id="cb153-261"><a href="#cb153-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-262"><a href="#cb153-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-263"><a href="#cb153-263" aria-hidden="true" tabindex="-1"></a>Oops, you cannot see wells (points) in the figure. The order of <span class="in">`geom_sf()`</span> matters. The layer added later will come on top of the preceding layers. That's why wells are hidden beneath Kansas counties. So, let's do this:</span>
<span id="cb153-264"><a href="#cb153-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-265"><a href="#cb153-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g-multiple-2}</span></span>
<span id="cb153-266"><a href="#cb153-266" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = KS_county) +</span></span>
<span id="cb153-267"><a href="#cb153-267" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_county ---#</span></span>
<span id="cb153-268"><a href="#cb153-268" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf() +</span></span>
<span id="cb153-269"><a href="#cb153-269" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_county ---#</span></span>
<span id="cb153-270"><a href="#cb153-270" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, size = 0.4) +</span></span>
<span id="cb153-271"><a href="#cb153-271" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_railroads ---#</span></span>
<span id="cb153-272"><a href="#cb153-272" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads, color = "red")</span></span>
<span id="cb153-273"><a href="#cb153-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-274"><a href="#cb153-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-275"><a href="#cb153-275" aria-hidden="true" tabindex="-1"></a>Better.</span>
<span id="cb153-276"><a href="#cb153-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-277"><a href="#cb153-277" aria-hidden="true" tabindex="-1"></a>Note that since you are using different datasets for each layer, you need to specify the dataset to use in each layer except for the first <span class="in">`geom_sf()`</span> which inherits <span class="in">`data = KS_wells`</span> from <span class="in">`ggplot(data = KS_wells)`</span>. Of course, this will create exactly the same map:</span>
<span id="cb153-278"><a href="#cb153-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-279"><a href="#cb153-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g-multiple-3}</span></span>
<span id="cb153-280"><a href="#cb153-280" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-281"><a href="#cb153-281" aria-hidden="true" tabindex="-1"></a><span class="in">  g_all &lt;- </span></span>
<span id="cb153-282"><a href="#cb153-282" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-283"><a href="#cb153-283" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- this one uses KS_county ---#</span></span>
<span id="cb153-284"><a href="#cb153-284" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = KS_county) +</span></span>
<span id="cb153-285"><a href="#cb153-285" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- this one uses KS_wells ---#</span></span>
<span id="cb153-286"><a href="#cb153-286" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = gw_KS_sf, size = 0.4) +</span></span>
<span id="cb153-287"><a href="#cb153-287" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- this one uses KS_railroads ---#</span></span>
<span id="cb153-288"><a href="#cb153-288" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = KS_railroads, color = "red")</span></span>
<span id="cb153-289"><a href="#cb153-289" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-290"><a href="#cb153-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-291"><a href="#cb153-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-292"><a href="#cb153-292" aria-hidden="true" tabindex="-1"></a>There is no rule that you need to supply data to <span class="in">`ggplot()`</span>.^<span class="co">[</span><span class="ot">Supplying data in `ggplot()` can be convenient if you are creating multiple `geom` from the data because you do not need to tell what data to use in each of the subsequent `geom`s.</span><span class="co">]</span></span>
<span id="cb153-293"><a href="#cb153-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-294"><a href="#cb153-294" aria-hidden="true" tabindex="-1"></a>Alternatively, you could add <span class="in">`fill = NA`</span> to <span class="in">`geom_sf(data = KS_county)`</span> instead of switching the order.</span>
<span id="cb153-295"><a href="#cb153-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-296"><a href="#cb153-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g-multiple-4}</span></span>
<span id="cb153-297"><a href="#cb153-297" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-298"><a href="#cb153-298" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_wells ---#</span></span>
<span id="cb153-299"><a href="#cb153-299" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, size = 0.4) +</span></span>
<span id="cb153-300"><a href="#cb153-300" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_county ---#</span></span>
<span id="cb153-301"><a href="#cb153-301" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county, fill = NA) +</span></span>
<span id="cb153-302"><a href="#cb153-302" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this one uses KS_railroads ---#</span></span>
<span id="cb153-303"><a href="#cb153-303" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads, color = "red")</span></span>
<span id="cb153-304"><a href="#cb153-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-305"><a href="#cb153-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-306"><a href="#cb153-306" aria-hidden="true" tabindex="-1"></a>This is fine as long as you do not intend to color-code counties.</span>
<span id="cb153-307"><a href="#cb153-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-308"><a href="#cb153-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-309"><a href="#cb153-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### CRS</span></span>
<span id="cb153-310"><a href="#cb153-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-311"><a href="#cb153-311" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot()`</span> uses the CRS of the <span class="in">`sf`</span> to draw a map. For example, right now the CRS of <span class="in">`KS_county`</span> is this:</span>
<span id="cb153-312"><a href="#cb153-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-313"><a href="#cb153-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-crs}</span></span>
<span id="cb153-314"><a href="#cb153-314" aria-hidden="true" tabindex="-1"></a><span class="in">sf::st_crs(KS_county)</span></span>
<span id="cb153-315"><a href="#cb153-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-316"><a href="#cb153-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-317"><a href="#cb153-317" aria-hidden="true" tabindex="-1"></a>Let's convert the CRS to WGS 84/ UTM zone 14N (EPSG code: 32614), make a map, and compare the ones with different CRS side by side.</span>
<span id="cb153-318"><a href="#cb153-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-319"><a href="#cb153-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-14N}</span></span>
<span id="cb153-320"><a href="#cb153-320" aria-hidden="true" tabindex="-1"></a><span class="in">g_32614 &lt;-</span></span>
<span id="cb153-321"><a href="#cb153-321" aria-hidden="true" tabindex="-1"></a><span class="in">  sf::st_transform(KS_county, 32614) %&gt;%</span></span>
<span id="cb153-322"><a href="#cb153-322" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = .) +</span></span>
<span id="cb153-323"><a href="#cb153-323" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf()</span></span>
<span id="cb153-324"><a href="#cb153-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-325"><a href="#cb153-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-326"><a href="#cb153-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r patchwork}</span></span>
<span id="cb153-327"><a href="#cb153-327" aria-hidden="true" tabindex="-1"></a><span class="in">g_county / g_32614</span></span>
<span id="cb153-328"><a href="#cb153-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-329"><a href="#cb153-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-330"><a href="#cb153-330" aria-hidden="true" tabindex="-1"></a>Alternatively, you could use <span class="in">`coord_sf()`</span> to alter the CRS on the map, but not the CRS of the sf object itself.</span>
<span id="cb153-331"><a href="#cb153-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-332"><a href="#cb153-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-crs}</span></span>
<span id="cb153-333"><a href="#cb153-333" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-334"><a href="#cb153-334" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 4269 ---#</span></span>
<span id="cb153-335"><a href="#cb153-335" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-336"><a href="#cb153-336" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = 32614)</span></span>
<span id="cb153-337"><a href="#cb153-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-338"><a href="#cb153-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-339"><a href="#cb153-339" aria-hidden="true" tabindex="-1"></a>When multiple layers are used for map creation, the CRS of the first layer is applied for all the layers.</span>
<span id="cb153-340"><a href="#cb153-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-341"><a href="#cb153-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-crs-order}</span></span>
<span id="cb153-342"><a href="#cb153-342" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-343"><a href="#cb153-343" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 32614 ---#</span></span>
<span id="cb153-344"><a href="#cb153-344" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-345"><a href="#cb153-345" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 4269 ---#</span></span>
<span id="cb153-346"><a href="#cb153-346" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads)</span></span>
<span id="cb153-347"><a href="#cb153-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-348"><a href="#cb153-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-349"><a href="#cb153-349" aria-hidden="true" tabindex="-1"></a><span class="in">`coord_sf()`</span> applies to all the layers.</span>
<span id="cb153-350"><a href="#cb153-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-351"><a href="#cb153-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-coodsf}</span></span>
<span id="cb153-352"><a href="#cb153-352" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-353"><a href="#cb153-353" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 32614 ---#</span></span>
<span id="cb153-354"><a href="#cb153-354" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-355"><a href="#cb153-355" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 4269 ---#</span></span>
<span id="cb153-356"><a href="#cb153-356" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads) +</span></span>
<span id="cb153-357"><a href="#cb153-357" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- using 4269 ---#</span></span>
<span id="cb153-358"><a href="#cb153-358" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = 4269)</span></span>
<span id="cb153-359"><a href="#cb153-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-360"><a href="#cb153-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-361"><a href="#cb153-361" aria-hidden="true" tabindex="-1"></a>Finally, you could limit the geographic scope of the map to be created by adding <span class="in">`xlim()`</span> and <span class="in">`ylim()`</span>.</span>
<span id="cb153-362"><a href="#cb153-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-363"><a href="#cb153-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wells-map-coodsf-lim}</span></span>
<span id="cb153-364"><a href="#cb153-364" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-365"><a href="#cb153-365" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 32614 ---#</span></span>
<span id="cb153-366"><a href="#cb153-366" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-367"><a href="#cb153-367" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- epsg: 4269 ---#</span></span>
<span id="cb153-368"><a href="#cb153-368" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_railroads) +</span></span>
<span id="cb153-369"><a href="#cb153-369" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- using 4269 ---#</span></span>
<span id="cb153-370"><a href="#cb153-370" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = 4269) +</span></span>
<span id="cb153-371"><a href="#cb153-371" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- limit the geographic scope of the map ---#</span></span>
<span id="cb153-372"><a href="#cb153-372" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(-99, -97) +</span></span>
<span id="cb153-373"><a href="#cb153-373" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(37, 39)</span></span>
<span id="cb153-374"><a href="#cb153-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-375"><a href="#cb153-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-376"><a href="#cb153-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Faceting</span></span>
<span id="cb153-377"><a href="#cb153-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-378"><a href="#cb153-378" aria-hidden="true" tabindex="-1"></a>Faceting splits the data into groups and generates a figure for each group, where the aesthetics of the figures are consistent across the groups. Faceting can be done using <span class="in">`facet_wrap()`</span> or <span class="in">`facet_grid()`</span>. Let's try to create a map of groundwater use at wells by year where the points are color differentiated by the amount of groundwater use (<span class="in">`af_used`</span>).</span>
<span id="cb153-379"><a href="#cb153-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-380"><a href="#cb153-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-1}</span></span>
<span id="cb153-381"><a href="#cb153-381" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-382"><a href="#cb153-382" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-383"><a href="#cb153-383" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-384"><a href="#cb153-384" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-385"><a href="#cb153-385" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-386"><a href="#cb153-386" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-387"><a href="#cb153-387" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(. ~ year)</span></span>
<span id="cb153-388"><a href="#cb153-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-389"><a href="#cb153-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-390"><a href="#cb153-390" aria-hidden="true" tabindex="-1"></a>Note that the above code creates a single legend that applies to both panels, which allows you to compare values across panels (years here). Further, also note that the values of the faceting variable (<span class="in">`year`</span>) are displayed in the gray strips above the maps. You can have panels stacked vertically by using the <span class="in">`ncol`</span> option (or <span class="in">`nrow`</span> also works) in <span class="in">`facet_wrap(. ~ year)`</span> as follows:</span>
<span id="cb153-391"><a href="#cb153-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-392"><a href="#cb153-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-2}</span></span>
<span id="cb153-393"><a href="#cb153-393" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-394"><a href="#cb153-394" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-395"><a href="#cb153-395" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-396"><a href="#cb153-396" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-397"><a href="#cb153-397" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-398"><a href="#cb153-398" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-399"><a href="#cb153-399" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(. ~ year, ncol = 1)</span></span>
<span id="cb153-400"><a href="#cb153-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-401"><a href="#cb153-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-402"><a href="#cb153-402" aria-hidden="true" tabindex="-1"></a>Two-way faceting is possible by supplying a variable name (or expression) in place of <span class="in">`.`</span> in <span class="in">`facet_wrap(. ~ year)`</span>. The code below uses an expression <span class="in">`(af_used &gt; 200)`</span> in place of <span class="in">`.`</span>. This divides the dataset by whether water use is greater than 200 or not and by year.</span>
<span id="cb153-403"><a href="#cb153-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-404"><a href="#cb153-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-3}</span></span>
<span id="cb153-405"><a href="#cb153-405" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-406"><a href="#cb153-406" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-407"><a href="#cb153-407" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-408"><a href="#cb153-408" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-409"><a href="#cb153-409" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-410"><a href="#cb153-410" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-411"><a href="#cb153-411" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap((af_used &gt; 200) ~ year)</span></span>
<span id="cb153-412"><a href="#cb153-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-413"><a href="#cb153-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-414"><a href="#cb153-414" aria-hidden="true" tabindex="-1"></a>The values of the expression (<span class="in">`TRUE`</span> or <span class="in">`FALSE`</span>) appear in the gray strips, which is not informative. We will discuss in detail how to control texts in the strips @sec-fine-tune.</span>
<span id="cb153-415"><a href="#cb153-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-416"><a href="#cb153-416" aria-hidden="true" tabindex="-1"></a>If you feel like the panels are too close to each other, you could provide more space between them using <span class="in">`panel.spacing`</span> (both vertically and horizontally), <span class="in">`panel.spacing.x`</span> (horizontally), and <span class="in">`panel.spacing.y`</span> (vertically) options in <span class="in">`theme()`</span>. Suppose you would like to place more space between the upper and lower panels, then you use <span class="in">`panel.spacing.y`</span> like this:</span>
<span id="cb153-417"><a href="#cb153-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-418"><a href="#cb153-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r panel-spacing}</span></span>
<span id="cb153-419"><a href="#cb153-419" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-420"><a href="#cb153-420" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-421"><a href="#cb153-421" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-422"><a href="#cb153-422" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-423"><a href="#cb153-423" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-424"><a href="#cb153-424" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-425"><a href="#cb153-425" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap((af_used &gt; 200) ~ year) +</span></span>
<span id="cb153-426"><a href="#cb153-426" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- add more space between panels ---#</span></span>
<span id="cb153-427"><a href="#cb153-427" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.spacing.y = unit(2, "lines"))</span></span>
<span id="cb153-428"><a href="#cb153-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-429"><a href="#cb153-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-430"><a href="#cb153-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-431"><a href="#cb153-431" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding texts (labels) on a map</span></span>
<span id="cb153-432"><a href="#cb153-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-433"><a href="#cb153-433" aria-hidden="true" tabindex="-1"></a>You can add labels to a map using <span class="in">`geom_sf_text()`</span> or <span class="in">`geom_sf_label()`</span> from the <span class="in">`ggplot2`</span> pacakge, specifying <span class="in">`aes(label = x)`</span> where <span class="in">`x`</span> is the variable containing the labels to be displayed on the map.</span>
<span id="cb153-434"><a href="#cb153-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-435"><a href="#cb153-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-labels, warnings = F}</span></span>
<span id="cb153-436"><a href="#cb153-436" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-437"><a href="#cb153-437" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-438"><a href="#cb153-438" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-439"><a href="#cb153-439" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-440"><a href="#cb153-440" aria-hidden="true" tabindex="-1"></a><span class="in">    data = KS_county,</span></span>
<span id="cb153-441"><a href="#cb153-441" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-442"><a href="#cb153-442" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-443"><a href="#cb153-443" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue"</span></span>
<span id="cb153-444"><a href="#cb153-444" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-445"><a href="#cb153-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-446"><a href="#cb153-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-447"><a href="#cb153-447" aria-hidden="true" tabindex="-1"></a>If you would like to have overlapping labels not printed, you can add <span class="in">`check_overlap = TRUE`</span>.</span>
<span id="cb153-448"><a href="#cb153-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-449"><a href="#cb153-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-labels-overlap, warnings = F}</span></span>
<span id="cb153-450"><a href="#cb153-450" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-451"><a href="#cb153-451" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-452"><a href="#cb153-452" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-453"><a href="#cb153-453" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-454"><a href="#cb153-454" aria-hidden="true" tabindex="-1"></a><span class="in">    data = KS_county,</span></span>
<span id="cb153-455"><a href="#cb153-455" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-456"><a href="#cb153-456" aria-hidden="true" tabindex="-1"></a><span class="in">    check_overlap = TRUE,</span></span>
<span id="cb153-457"><a href="#cb153-457" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-458"><a href="#cb153-458" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue"</span></span>
<span id="cb153-459"><a href="#cb153-459" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-460"><a href="#cb153-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-461"><a href="#cb153-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-462"><a href="#cb153-462" aria-hidden="true" tabindex="-1"></a>The <span class="in">`nudge_x`</span> and <span class="in">`nudge_y`</span> options let you shift the labels.</span>
<span id="cb153-463"><a href="#cb153-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-464"><a href="#cb153-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nudge, warnings = F}</span></span>
<span id="cb153-465"><a href="#cb153-465" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-466"><a href="#cb153-466" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-467"><a href="#cb153-467" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-468"><a href="#cb153-468" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-469"><a href="#cb153-469" aria-hidden="true" tabindex="-1"></a><span class="in">    data = KS_county,</span></span>
<span id="cb153-470"><a href="#cb153-470" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-471"><a href="#cb153-471" aria-hidden="true" tabindex="-1"></a><span class="in">    check_overlap = TRUE,</span></span>
<span id="cb153-472"><a href="#cb153-472" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-473"><a href="#cb153-473" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue",</span></span>
<span id="cb153-474"><a href="#cb153-474" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_x = -0.1,</span></span>
<span id="cb153-475"><a href="#cb153-475" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_y = 0.1</span></span>
<span id="cb153-476"><a href="#cb153-476" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-477"><a href="#cb153-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-478"><a href="#cb153-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-479"><a href="#cb153-479" aria-hidden="true" tabindex="-1"></a>If you would like a fine control on a few objects, you can always work on them separately.</span>
<span id="cb153-480"><a href="#cb153-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-481"><a href="#cb153-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sep}</span></span>
<span id="cb153-482"><a href="#cb153-482" aria-hidden="true" tabindex="-1"></a><span class="in">Cheyenne &lt;- dplyr::filter(KS_county, NAME == "Cheyenne")</span></span>
<span id="cb153-483"><a href="#cb153-483" aria-hidden="true" tabindex="-1"></a><span class="in">KS_less_Cheyenne &lt;- dplyr::filter(KS_county, NAME != "Cheyenne")</span></span>
<span id="cb153-484"><a href="#cb153-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-485"><a href="#cb153-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-486"><a href="#cb153-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nudge-sep, warnings = F}</span></span>
<span id="cb153-487"><a href="#cb153-487" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-488"><a href="#cb153-488" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-489"><a href="#cb153-489" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-490"><a href="#cb153-490" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-491"><a href="#cb153-491" aria-hidden="true" tabindex="-1"></a><span class="in">    data = KS_less_Cheyenne,</span></span>
<span id="cb153-492"><a href="#cb153-492" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-493"><a href="#cb153-493" aria-hidden="true" tabindex="-1"></a><span class="in">    check_overlap = TRUE,</span></span>
<span id="cb153-494"><a href="#cb153-494" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-495"><a href="#cb153-495" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue",</span></span>
<span id="cb153-496"><a href="#cb153-496" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_x = -0.1,</span></span>
<span id="cb153-497"><a href="#cb153-497" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_y = 0.1</span></span>
<span id="cb153-498"><a href="#cb153-498" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-499"><a href="#cb153-499" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-500"><a href="#cb153-500" aria-hidden="true" tabindex="-1"></a><span class="in">    data = Cheyenne,</span></span>
<span id="cb153-501"><a href="#cb153-501" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-502"><a href="#cb153-502" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 2.5,</span></span>
<span id="cb153-503"><a href="#cb153-503" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "red",</span></span>
<span id="cb153-504"><a href="#cb153-504" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_y = 0.2</span></span>
<span id="cb153-505"><a href="#cb153-505" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-506"><a href="#cb153-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-507"><a href="#cb153-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-508"><a href="#cb153-508" aria-hidden="true" tabindex="-1"></a>You could also use <span class="in">`annotate()`</span> to place texts on a map, which can be useful if you would like to place arbitrary texts that are not part of <span class="in">`sf`</span> object.</span>
<span id="cb153-509"><a href="#cb153-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-510"><a href="#cb153-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nudge-sep-annotate, warnings = F}</span></span>
<span id="cb153-511"><a href="#cb153-511" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-512"><a href="#cb153-512" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-513"><a href="#cb153-513" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-514"><a href="#cb153-514" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(</span></span>
<span id="cb153-515"><a href="#cb153-515" aria-hidden="true" tabindex="-1"></a><span class="in">    data = KS_less_Cheyenne,</span></span>
<span id="cb153-516"><a href="#cb153-516" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = NAME),</span></span>
<span id="cb153-517"><a href="#cb153-517" aria-hidden="true" tabindex="-1"></a><span class="in">    check_overlap = TRUE,</span></span>
<span id="cb153-518"><a href="#cb153-518" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-519"><a href="#cb153-519" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue",</span></span>
<span id="cb153-520"><a href="#cb153-520" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_x = -0.1,</span></span>
<span id="cb153-521"><a href="#cb153-521" aria-hidden="true" tabindex="-1"></a><span class="in">    nudge_y = 0.1</span></span>
<span id="cb153-522"><a href="#cb153-522" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-523"><a href="#cb153-523" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- use annotate to add texts on the map ---#</span></span>
<span id="cb153-524"><a href="#cb153-524" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate(</span></span>
<span id="cb153-525"><a href="#cb153-525" aria-hidden="true" tabindex="-1"></a><span class="in">    geom = "text",</span></span>
<span id="cb153-526"><a href="#cb153-526" aria-hidden="true" tabindex="-1"></a><span class="in">    x = -102,</span></span>
<span id="cb153-527"><a href="#cb153-527" aria-hidden="true" tabindex="-1"></a><span class="in">    y = 39.8,</span></span>
<span id="cb153-528"><a href="#cb153-528" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb153-529"><a href="#cb153-529" aria-hidden="true" tabindex="-1"></a><span class="in">    label = "Cheyennes",</span></span>
<span id="cb153-530"><a href="#cb153-530" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "red"</span></span>
<span id="cb153-531"><a href="#cb153-531" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-532"><a href="#cb153-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-533"><a href="#cb153-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-534"><a href="#cb153-534" aria-hidden="true" tabindex="-1"></a>As you can see, you need to tell where the texts should be placed with <span class="in">`x`</span> and <span class="in">`y`</span>, provide the texts you want on the map to <span class="in">`label`</span>.</span>
<span id="cb153-535"><a href="#cb153-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-536"><a href="#cb153-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-537"><a href="#cb153-537" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-538"><a href="#cb153-538" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-539"><a href="#cb153-539" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Raster data visualization</span></span>
<span id="cb153-540"><a href="#cb153-540" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-541"><a href="#cb153-541" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-542"><a href="#cb153-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-543"><a href="#cb153-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-544"><a href="#cb153-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## Raster data visualization: `geom_spatraster()` and `geom_stars()` {#sec-geom-raster}</span></span>
<span id="cb153-545"><a href="#cb153-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-546"><a href="#cb153-546" aria-hidden="true" tabindex="-1"></a>This section shows how to use <span class="in">`tidyterra::geom_spatraster()`</span> and <span class="in">`stars::geom_stars()`</span> to create maps from raster datasets of two object classes: <span class="in">`SpatRaster`</span> from the <span class="in">`terra`</span> package and <span class="in">`stars`</span> objects from the <span class="in">`stars`</span> package, respectively.</span>
<span id="cb153-547"><a href="#cb153-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-548"><a href="#cb153-548" aria-hidden="true" tabindex="-1"></a>While <span class="in">`ggplot2::geom_raster()`</span> can be used to create a map from raster, it requires a <span class="in">`data.frame`</span> containing coordinates to generate maps, making it a two-step process.</span>
<span id="cb153-549"><a href="#cb153-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-550"><a href="#cb153-550" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>convert raster dataset into a <span class="in">`data.frame`</span> with coordinates</span>
<span id="cb153-551"><a href="#cb153-551" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>use <span class="in">`ggplot2::geom_raster()`</span> to make a map</span>
<span id="cb153-552"><a href="#cb153-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-553"><a href="#cb153-553" aria-hidden="true" tabindex="-1"></a>On the other hand, <span class="in">`geom_spatraster()`</span> and <span class="in">`geom_stars()`</span> accepts a <span class="in">`SpatRaster`</span> (from the <span class="in">`terra`</span> package) and <span class="in">`stars`</span> object (from the <span class="in">`stars`</span> package), respectively, and no data transformation is necessary for either of them. For this reason, &lt;span style = "color: red;"&gt; the use of <span class="in">`geom_spatraster()`</span> or <span class="in">`geom_stars`</span> is recommended over <span class="in">`geom_raster()`</span>. &lt;/span&gt; </span>
<span id="cb153-554"><a href="#cb153-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-555"><a href="#cb153-555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Preparation</span></span>
<span id="cb153-556"><a href="#cb153-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-557"><a href="#cb153-557" aria-hidden="true" tabindex="-1"></a>We use the following objects that have the same information but come in different object classes for illustration in this section.</span>
<span id="cb153-558"><a href="#cb153-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-559"><a href="#cb153-559" aria-hidden="true" tabindex="-1"></a>**Raster as `stars`**</span>
<span id="cb153-560"><a href="#cb153-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-561"><a href="#cb153-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raster-as-stars, echo = F, eval = F}</span></span>
<span id="cb153-562"><a href="#cb153-562" aria-hidden="true" tabindex="-1"></a><span class="in">tmax_Jan_09 &lt;-</span></span>
<span id="cb153-563"><a href="#cb153-563" aria-hidden="true" tabindex="-1"></a><span class="in">  stars::read_stars("Data/PRISM_tmax_y2009_m1.tif") %&gt;%</span></span>
<span id="cb153-564"><a href="#cb153-564" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- change the variable name ---#</span></span>
<span id="cb153-565"><a href="#cb153-565" aria-hidden="true" tabindex="-1"></a><span class="in">  setNames("tmax") %&gt;%</span></span>
<span id="cb153-566"><a href="#cb153-566" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- set the date values ---#</span></span>
<span id="cb153-567"><a href="#cb153-567" aria-hidden="true" tabindex="-1"></a><span class="in">  stars::st_set_dimensions("band",</span></span>
<span id="cb153-568"><a href="#cb153-568" aria-hidden="true" tabindex="-1"></a><span class="in">    values = seq(ymd("2009-01-01"), ymd("2009-01-31"), by = "days"),</span></span>
<span id="cb153-569"><a href="#cb153-569" aria-hidden="true" tabindex="-1"></a><span class="in">    names = "date"</span></span>
<span id="cb153-570"><a href="#cb153-570" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb153-571"><a href="#cb153-571" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- first five days of January ---#</span></span>
<span id="cb153-572"><a href="#cb153-572" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::filter(date &lt;= ymd("2009-01-05"))</span></span>
<span id="cb153-573"><a href="#cb153-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-574"><a href="#cb153-574" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(tmax_Jan_09, "Data/tmax_Jan_09_stars.rds")</span></span>
<span id="cb153-575"><a href="#cb153-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-576"><a href="#cb153-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-577"><a href="#cb153-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-data-get}</span></span>
<span id="cb153-578"><a href="#cb153-578" aria-hidden="true" tabindex="-1"></a><span class="in">tmax_Jan_09 &lt;- readRDS("Data/tmax_Jan_09_stars.rds")</span></span>
<span id="cb153-579"><a href="#cb153-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-580"><a href="#cb153-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-581"><a href="#cb153-581" aria-hidden="true" tabindex="-1"></a>**Raster as `SpatRaster`**</span>
<span id="cb153-582"><a href="#cb153-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-583"><a href="#cb153-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-data-get-sr, cache = F}</span></span>
<span id="cb153-584"><a href="#cb153-584" aria-hidden="true" tabindex="-1"></a><span class="in">#--- convert RasterStack to SpatRaster ---#</span></span>
<span id="cb153-585"><a href="#cb153-585" aria-hidden="true" tabindex="-1"></a><span class="in">tmax_Jan_09_sr &lt;- terra::rast("Data/tmax_Jan_09.tif")</span></span>
<span id="cb153-586"><a href="#cb153-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-587"><a href="#cb153-587" aria-hidden="true" tabindex="-1"></a><span class="in">#--- change the name of the layers ---#</span></span>
<span id="cb153-588"><a href="#cb153-588" aria-hidden="true" tabindex="-1"></a><span class="in">terra::set.names(</span></span>
<span id="cb153-589"><a href="#cb153-589" aria-hidden="true" tabindex="-1"></a><span class="in">  tmax_Jan_09_sr, </span></span>
<span id="cb153-590"><a href="#cb153-590" aria-hidden="true" tabindex="-1"></a><span class="in">  seq(</span></span>
<span id="cb153-591"><a href="#cb153-591" aria-hidden="true" tabindex="-1"></a><span class="in">      lubridate::ymd("2009-01-01"), </span></span>
<span id="cb153-592"><a href="#cb153-592" aria-hidden="true" tabindex="-1"></a><span class="in">      lubridate::ymd("2009-01-05"),</span></span>
<span id="cb153-593"><a href="#cb153-593" aria-hidden="true" tabindex="-1"></a><span class="in">      by = "days"</span></span>
<span id="cb153-594"><a href="#cb153-594" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb153-595"><a href="#cb153-595" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-596"><a href="#cb153-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-597"><a href="#cb153-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-598"><a href="#cb153-598" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize with `tidyterra::geom_spatraster()`</span></span>
<span id="cb153-599"><a href="#cb153-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-600"><a href="#cb153-600" aria-hidden="true" tabindex="-1"></a>Creating a map from a <span class="in">`SpatRaster`</span> is as straightforward as creating one from an <span class="in">`sf`</span> object. You can use <span class="in">`tidyterra::geom_spatraster()`</span>, setting the data argument to your <span class="in">`SpatRaster`</span> object.</span>
<span id="cb153-601"><a href="#cb153-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-604"><a href="#cb153-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-605"><a href="#cb153-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-spatraster-basic</span></span>
<span id="cb153-606"><a href="#cb153-606" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_spatraster</span>(<span class="at">data =</span> tmax_Jan_09_sr)</span>
<span id="cb153-607"><a href="#cb153-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-608"><a href="#cb153-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-609"><a href="#cb153-609" aria-hidden="true" tabindex="-1"></a>Notice here that the fill color was automatically set to cell values (here, <span class="in">`tmax`</span>). <span class="in">`tmax_Jan_09_sr`</span> is a five-layer raster object, and you might be wondering which of the five layers were used for the map above. The answer is: all of them. To select a specific layer, you can specify aes<span class="in">`(fill = layer_name)`</span> within <span class="in">`geom_spatraster()`</span>, as shown below:</span>
<span id="cb153-610"><a href="#cb153-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-613"><a href="#cb153-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-614"><a href="#cb153-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-spatraster-single</span></span>
<span id="cb153-615"><a href="#cb153-615" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb153-616"><a href="#cb153-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> tmax_Jan_09_sr, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2009-01-01</span><span class="st">`</span>))</span>
<span id="cb153-617"><a href="#cb153-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-618"><a href="#cb153-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-619"><a href="#cb153-619" aria-hidden="true" tabindex="-1"></a>To facet by layer, apply <span class="in">`facet_wrap(~ lyr)`</span> as shown below.</span>
<span id="cb153-620"><a href="#cb153-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-623"><a href="#cb153-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-624"><a href="#cb153-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-spatraster-facet</span></span>
<span id="cb153-625"><a href="#cb153-625" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb153-626"><a href="#cb153-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> tmax_Jan_09_sr) <span class="sc">+</span></span>
<span id="cb153-627"><a href="#cb153-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> lyr, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb153-628"><a href="#cb153-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-629"><a href="#cb153-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-630"><a href="#cb153-630" aria-hidden="true" tabindex="-1"></a>Since this is built within the <span class="in">`ggplot2`</span> framework, you can easily customize the figure if you are familiar with <span class="in">`ggplot2`</span>.</span>
<span id="cb153-631"><a href="#cb153-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-634"><a href="#cb153-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-635"><a href="#cb153-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-spatraster-facet-style</span></span>
<span id="cb153-636"><a href="#cb153-636" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb153-637"><a href="#cb153-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> tmax_Jan_09_sr) <span class="sc">+</span></span>
<span id="cb153-638"><a href="#cb153-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> lyr, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb153-639"><a href="#cb153-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_whitebox_c</span>(</span>
<span id="cb153-640"><a href="#cb153-640" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"muted"</span>,</span>
<span id="cb153-641"><a href="#cb153-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">"º"</span>),</span>
<span id="cb153-642"><a href="#cb153-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.breaks =</span> <span class="dv">20</span>,</span>
<span id="cb153-643"><a href="#cb153-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-644"><a href="#cb153-644" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb153-645"><a href="#cb153-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">""</span>)</span>
<span id="cb153-646"><a href="#cb153-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-647"><a href="#cb153-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-648"><a href="#cb153-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-649"><a href="#cb153-649" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb153-650"><a href="#cb153-650" aria-hidden="true" tabindex="-1"></a>Note that you always have <span class="in">`lyr`</span> as the faceting variable with <span class="in">`geom_spatraster()`</span> as there is no other variable to be faceted with in a multi-layer <span class="in">`SpatRaster`</span> object.</span>
<span id="cb153-651"><a href="#cb153-651" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-652"><a href="#cb153-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-653"><a href="#cb153-653" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize `stars` with `geom_stars()`</span></span>
<span id="cb153-654"><a href="#cb153-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-655"><a href="#cb153-655" aria-hidden="true" tabindex="-1"></a><span class="in">`stars::geom_stars()`</span> allows you to directly use a <span class="in">`stars`</span> object to easily create a map within the <span class="in">`ggplot2`</span> framework. It works similarly to <span class="in">`geom_sf()`</span> and <span class="in">`geom_spatraster()`</span>—simply provide the stars object as the data argument in <span class="in">`geom_stars()`</span>.</span>
<span id="cb153-656"><a href="#cb153-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-657"><a href="#cb153-657" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stars-stars}</span></span>
<span id="cb153-658"><a href="#cb153-658" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-659"><a href="#cb153-659" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stars(data = tmax_Jan_09) +</span></span>
<span id="cb153-660"><a href="#cb153-660" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-661"><a href="#cb153-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-662"><a href="#cb153-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-663"><a href="#cb153-663" aria-hidden="true" tabindex="-1"></a>The fill color of the raster cells are automatically set to the attribute (here <span class="in">`tmax`</span>) as if <span class="in">`aes(fill = tmax)`</span>.</span>
<span id="cb153-664"><a href="#cb153-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-665"><a href="#cb153-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stars-stars-ce}</span></span>
<span id="cb153-666"><a href="#cb153-666" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-667"><a href="#cb153-667" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stars(data = tmax_Jan_09) +</span></span>
<span id="cb153-668"><a href="#cb153-668" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-669"><a href="#cb153-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-670"><a href="#cb153-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-671"><a href="#cb153-671" aria-hidden="true" tabindex="-1"></a>By default, <span class="in">`geom_stars()`</span> plots only the first band. In order to present all the layers at the same time, you can add <span class="in">`facet_wrap( ~ x)`</span> where **x** is the name of the third dimension of the stars object (<span class="in">`date`</span> here).</span>
<span id="cb153-672"><a href="#cb153-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-673"><a href="#cb153-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stars-stars-facet}</span></span>
<span id="cb153-674"><a href="#cb153-674" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-675"><a href="#cb153-675" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stars(data = tmax_Jan_09) +</span></span>
<span id="cb153-676"><a href="#cb153-676" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ date) +</span></span>
<span id="cb153-677"><a href="#cb153-677" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-678"><a href="#cb153-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-679"><a href="#cb153-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-680"><a href="#cb153-680" aria-hidden="true" tabindex="-1"></a><span class="fu">### adding `geom_sf()` layers</span></span>
<span id="cb153-681"><a href="#cb153-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-682"><a href="#cb153-682" aria-hidden="true" tabindex="-1"></a>You can easily add <span class="in">`geom_sf()`</span> layers to a map created with <span class="in">`geom_spatraster()`</span> and <span class="in">`geom_stars()`</span>. Let's crop the tmax data to Kansas and create a map of tmax values displayed on top of the Kansas county borders.</span>
<span id="cb153-683"><a href="#cb153-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-684"><a href="#cb153-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-sf, results = "hide"}</span></span>
<span id="cb153-685"><a href="#cb153-685" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: false</span></span>
<span id="cb153-686"><a href="#cb153-686" aria-hidden="true" tabindex="-1"></a><span class="in">#--- crop to KS ---#</span></span>
<span id="cb153-687"><a href="#cb153-687" aria-hidden="true" tabindex="-1"></a><span class="in">KS_tmax_Jan_09_stars &lt;- </span></span>
<span id="cb153-688"><a href="#cb153-688" aria-hidden="true" tabindex="-1"></a><span class="in">  tmax_Jan_09 %&gt;%</span></span>
<span id="cb153-689"><a href="#cb153-689" aria-hidden="true" tabindex="-1"></a><span class="in">  sf::st_crop(KS_county)</span></span>
<span id="cb153-690"><a href="#cb153-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-691"><a href="#cb153-691" aria-hidden="true" tabindex="-1"></a><span class="in">KS_tmax_Jan_09_sr &lt;- </span></span>
<span id="cb153-692"><a href="#cb153-692" aria-hidden="true" tabindex="-1"></a><span class="in">as(KS_tmax_Jan_09_stars, "SpatRaster")</span></span>
<span id="cb153-693"><a href="#cb153-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-694"><a href="#cb153-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-695"><a href="#cb153-695" aria-hidden="true" tabindex="-1"></a>Mixing either <span class="in">`geom_spatraster()`</span> or <span class="in">`geom_stars()`</span> layers with <span class="in">`geom_sf()`</span> layers is not any different from mixing different non-spatial <span class="in">`geom_*()`</span>s under the <span class="in">`ggplot2`</span> framework. You can easily see in the example below that mixes <span class="in">`geom_stars()`</span> and <span class="in">`geom_sf()`</span> layers:</span>
<span id="cb153-696"><a href="#cb153-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-697"><a href="#cb153-697" aria-hidden="true" tabindex="-1"></a>**with `geom_stars()`**</span>
<span id="cb153-698"><a href="#cb153-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-699"><a href="#cb153-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stars-sf}</span></span>
<span id="cb153-700"><a href="#cb153-700" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-701"><a href="#cb153-701" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stars(data = KS_tmax_Jan_09_stars) +</span></span>
<span id="cb153-702"><a href="#cb153-702" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county, fill = NA) +</span></span>
<span id="cb153-703"><a href="#cb153-703" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~date) +</span></span>
<span id="cb153-704"><a href="#cb153-704" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-705"><a href="#cb153-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-706"><a href="#cb153-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-707"><a href="#cb153-707" aria-hidden="true" tabindex="-1"></a>**with `geom_spatraster()`**</span>
<span id="cb153-708"><a href="#cb153-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-709"><a href="#cb153-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r spatraster-sf}</span></span>
<span id="cb153-710"><a href="#cb153-710" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-711"><a href="#cb153-711" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_spatraster(data = KS_tmax_Jan_09_sr) +</span></span>
<span id="cb153-712"><a href="#cb153-712" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county, fill = NA) +</span></span>
<span id="cb153-713"><a href="#cb153-713" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ lyr) +</span></span>
<span id="cb153-714"><a href="#cb153-714" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-715"><a href="#cb153-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-716"><a href="#cb153-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-717"><a href="#cb153-717" aria-hidden="true" tabindex="-1"></a>One caveat with <span class="in">`geom_stars()`</span> is that vector and raster datasets need to have the same GRS/CRS. The code below transform the CRS of <span class="in">`KS_county`</span> from NAD83 GRS to WGS 84 / UTM zone 14N before plotting and see what happens.</span>
<span id="cb153-718"><a href="#cb153-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-719"><a href="#cb153-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stars-sf-cs}</span></span>
<span id="cb153-720"><a href="#cb153-720" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-721"><a href="#cb153-721" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stars(data = KS_tmax_Jan_09_stars) +</span></span>
<span id="cb153-722"><a href="#cb153-722" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614), fill = NA) +</span></span>
<span id="cb153-723"><a href="#cb153-723" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~date) +</span></span>
<span id="cb153-724"><a href="#cb153-724" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-725"><a href="#cb153-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-726"><a href="#cb153-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-727"><a href="#cb153-727" aria-hidden="true" tabindex="-1"></a>This is not the case for <span class="in">`geom_spatraster()`</span>.</span>
<span id="cb153-728"><a href="#cb153-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-729"><a href="#cb153-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r spatraster-sf-cs}</span></span>
<span id="cb153-730"><a href="#cb153-730" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-731"><a href="#cb153-731" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_spatraster(data = KS_tmax_Jan_09_sr) +</span></span>
<span id="cb153-732"><a href="#cb153-732" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614), fill = NA) +</span></span>
<span id="cb153-733"><a href="#cb153-733" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ lyr) +</span></span>
<span id="cb153-734"><a href="#cb153-734" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-735"><a href="#cb153-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-736"><a href="#cb153-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-737"><a href="#cb153-737" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-738"><a href="#cb153-738" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-739"><a href="#cb153-739" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Color scales</span></span>
<span id="cb153-740"><a href="#cb153-740" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-741"><a href="#cb153-741" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-742"><a href="#cb153-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-743"><a href="#cb153-743" aria-hidden="true" tabindex="-1"></a><span class="fu">## Color scale {#sec-color-scale}</span></span>
<span id="cb153-744"><a href="#cb153-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-745"><a href="#cb153-745" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- https://www.datanovia.com/en/blog/top-r-color-palettes-to-know-for-great-data-visualization/ --&gt;</span></span>
<span id="cb153-746"><a href="#cb153-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-747"><a href="#cb153-747" aria-hidden="true" tabindex="-1"></a>A color scale defines how variable values are mapped to colors in a figure. For example, in the illustration below, the color scale for fill maps the values of the cells to a gradient, with dark blue representing low values and light blue indicating high values of <span class="in">`tmax`</span>.</span>
<span id="cb153-748"><a href="#cb153-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-749"><a href="#cb153-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-long-sf-color-def}</span></span>
<span id="cb153-750"><a href="#cb153-750" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale &lt;-</span></span>
<span id="cb153-751"><a href="#cb153-751" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb153-752"><a href="#cb153-752" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_spatraster(data = tmax_Jan_09_sr) +</span></span>
<span id="cb153-753"><a href="#cb153-753" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ lyr) +</span></span>
<span id="cb153-754"><a href="#cb153-754" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-755"><a href="#cb153-755" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-756"><a href="#cb153-756" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "bottom"</span></span>
<span id="cb153-757"><a href="#cb153-757" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-758"><a href="#cb153-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-759"><a href="#cb153-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-760"><a href="#cb153-760" aria-hidden="true" tabindex="-1"></a>Often, it's aesthetically desirable to customize the default color scale in <span class="in">`ggplot2`</span>. For instance, when visualizing temperature values, you might prefer a gradient that ranges from blue for lower temperatures to red for higher ones.</span>
<span id="cb153-761"><a href="#cb153-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-762"><a href="#cb153-762" aria-hidden="true" tabindex="-1"></a>You can control the color scale using <span class="in">`scale_*()`</span> functions. The specific <span class="in">`scale_*()`</span> function you need depends on the type of aesthetic (fill or color) and whether the variable is continuous or discrete. Using an incorrect <span class="in">`scale_*()`</span> function will result in an error.</span>
<span id="cb153-763"><a href="#cb153-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-764"><a href="#cb153-764" aria-hidden="true" tabindex="-1"></a><span class="fu">### Viridis color maps</span></span>
<span id="cb153-765"><a href="#cb153-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-766"><a href="#cb153-766" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ggplot2`</span> package provides <span class="in">`scale_A_viridis_B()`</span> functions for applying the Viridis color map, where <span class="in">`A`</span> refers to the type of aesthetic attribute (fill, color), and <span class="in">`B`</span> refers to the type of variable. For example, <span class="in">`scale_fill_viridis_c()`</span> is used for fill aesthetics applied to a continuous variable.</span>
<span id="cb153-767"><a href="#cb153-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-768"><a href="#cb153-768" aria-hidden="true" tabindex="-1"></a>The Viridis color map offers five different palettes, which can be selected using the <span class="in">`option`</span> argument (@fig-viridis-ex is a visualization of all five palettes).</span>
<span id="cb153-769"><a href="#cb153-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-770"><a href="#cb153-770" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb153-771"><a href="#cb153-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height = 12}</span></span>
<span id="cb153-772"><a href="#cb153-772" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb153-773"><a href="#cb153-773" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-viridis-ex</span></span>
<span id="cb153-774"><a href="#cb153-774" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Five Viridis options"</span></span>
<span id="cb153-775"><a href="#cb153-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-776"><a href="#cb153-776" aria-hidden="true" tabindex="-1"></a><span class="in">data("geyser", package = "MASS")</span></span>
<span id="cb153-777"><a href="#cb153-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-778"><a href="#cb153-778" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(geyser, aes(x = duration, y = waiting)) +</span></span>
<span id="cb153-779"><a href="#cb153-779" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0.5, 6) +</span></span>
<span id="cb153-780"><a href="#cb153-780" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(40, 110) +</span></span>
<span id="cb153-781"><a href="#cb153-781" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_density2d(aes(fill = ..level..), geom = "polygon") +</span></span>
<span id="cb153-782"><a href="#cb153-782" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb153-783"><a href="#cb153-783" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.grid = element_blank()) -&gt; gg</span></span>
<span id="cb153-784"><a href="#cb153-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-785"><a href="#cb153-785" aria-hidden="true" tabindex="-1"></a><span class="in">(gg + scale_fill_viridis_c(option = "A") + labs(x = "magma", y = NULL)) /</span></span>
<span id="cb153-786"><a href="#cb153-786" aria-hidden="true" tabindex="-1"></a><span class="in">  (gg + scale_fill_viridis_c(option = "B") + labs(x = "inferno", y = NULL)) /</span></span>
<span id="cb153-787"><a href="#cb153-787" aria-hidden="true" tabindex="-1"></a><span class="in">  (gg + scale_fill_viridis_c(option = "C") + labs(x = "plasma", y = NULL)) /</span></span>
<span id="cb153-788"><a href="#cb153-788" aria-hidden="true" tabindex="-1"></a><span class="in">  (gg + scale_fill_viridis_c(option = "D") + labs(x = "viridis", y = NULL)) /</span></span>
<span id="cb153-789"><a href="#cb153-789" aria-hidden="true" tabindex="-1"></a><span class="in">  (gg + scale_fill_viridis_c(option = "E") + labs(x = "cividis", y = NULL))</span></span>
<span id="cb153-790"><a href="#cb153-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-791"><a href="#cb153-791" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-792"><a href="#cb153-792" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--end of column-margin--&gt;</span></span>
<span id="cb153-793"><a href="#cb153-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-794"><a href="#cb153-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-795"><a href="#cb153-795" aria-hidden="true" tabindex="-1"></a>Let's see what the PRISM tmax maps look like using Option <span class="in">`A`</span> and <span class="in">`D`</span> (default). Since the aesthetics type is <span class="in">`fill`</span> and <span class="in">`tmax`</span> is continuous, <span class="in">`scale_fill_viridis_c()`</span> is the appropriate one here.</span>
<span id="cb153-796"><a href="#cb153-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-797"><a href="#cb153-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-viridis-A}</span></span>
<span id="cb153-798"><a href="#cb153-798" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + scale_fill_viridis_c(option = "A")</span></span>
<span id="cb153-799"><a href="#cb153-799" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-800"><a href="#cb153-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-801"><a href="#cb153-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-viridis-D}</span></span>
<span id="cb153-802"><a href="#cb153-802" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + scale_fill_viridis_c(option = "D")</span></span>
<span id="cb153-803"><a href="#cb153-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-804"><a href="#cb153-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-805"><a href="#cb153-805" aria-hidden="true" tabindex="-1"></a>You can reverse the order of the color by adding <span class="in">`direction = -1`</span>.</span>
<span id="cb153-806"><a href="#cb153-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-807"><a href="#cb153-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-viridis-D-direc}</span></span>
<span id="cb153-808"><a href="#cb153-808" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + scale_fill_viridis_c(option = "D", direction = -1)</span></span>
<span id="cb153-809"><a href="#cb153-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-810"><a href="#cb153-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-811"><a href="#cb153-811" aria-hidden="true" tabindex="-1"></a>Let's now work on aesthetics mapping based on a discrete variable. The code below groups <span class="in">`af_used`</span> into five groups of ranges.</span>
<span id="cb153-812"><a href="#cb153-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-813"><a href="#cb153-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-viridis-D-discrete}</span></span>
<span id="cb153-814"><a href="#cb153-814" aria-hidden="true" tabindex="-1"></a><span class="in">#--- convert af_used to a discrete variable ---#</span></span>
<span id="cb153-815"><a href="#cb153-815" aria-hidden="true" tabindex="-1"></a><span class="in">gw_Stevens &lt;- dplyr::mutate(gw_Stevens, af_used_cat = cut_number(af_used, n = 5))</span></span>
<span id="cb153-816"><a href="#cb153-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-817"><a href="#cb153-817" aria-hidden="true" tabindex="-1"></a><span class="in">#--- take a look ---#</span></span>
<span id="cb153-818"><a href="#cb153-818" aria-hidden="true" tabindex="-1"></a><span class="in">head(gw_Stevens)</span></span>
<span id="cb153-819"><a href="#cb153-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-820"><a href="#cb153-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-821"><a href="#cb153-821" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = F}</span></span>
<span id="cb153-822"><a href="#cb153-822" aria-hidden="true" tabindex="-1"></a><span class="in"># saveRDS(gw_Stevens, "Data/gw_Stevens.rds")</span></span>
<span id="cb153-823"><a href="#cb153-823" aria-hidden="true" tabindex="-1"></a><span class="in">gw_Stevens &lt;- readRDS("Data/gw_Stevens.rds")</span></span>
<span id="cb153-824"><a href="#cb153-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-825"><a href="#cb153-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-826"><a href="#cb153-826" aria-hidden="true" tabindex="-1"></a>Since we would like to control <span class="in">`color`</span> aesthetics based on a discrete variable, we should be using <span class="in">`scale_color_viridis_d()`</span>.</span>
<span id="cb153-827"><a href="#cb153-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-828"><a href="#cb153-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r viridis-color, cache = F}</span></span>
<span id="cb153-829"><a href="#cb153-829" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-830"><a href="#cb153-830" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(aes(color = af_used_cat), size = 2) +</span></span>
<span id="cb153-831"><a href="#cb153-831" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "C")</span></span>
<span id="cb153-832"><a href="#cb153-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-833"><a href="#cb153-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-834"><a href="#cb153-834" aria-hidden="true" tabindex="-1"></a><span class="fu">### `RColorBrewer`: `scale_*_distiller()` and `scale_*_brewer()`</span></span>
<span id="cb153-835"><a href="#cb153-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-836"><a href="#cb153-836" aria-hidden="true" tabindex="-1"></a>The <span class="in">`RColorBrewer`</span> package provides a set of color scales that are useful. Here is the list of color scales you can use.</span>
<span id="cb153-837"><a href="#cb153-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-838"><a href="#cb153-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-disp, fig.height = 8}</span></span>
<span id="cb153-839"><a href="#cb153-839" aria-hidden="true" tabindex="-1"></a><span class="in">#--- load RColorBrewer ---#</span></span>
<span id="cb153-840"><a href="#cb153-840" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb153-841"><a href="#cb153-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-842"><a href="#cb153-842" aria-hidden="true" tabindex="-1"></a><span class="in">#--- disply all the color schemes from the package ---#</span></span>
<span id="cb153-843"><a href="#cb153-843" aria-hidden="true" tabindex="-1"></a><span class="in">display.brewer.all()</span></span>
<span id="cb153-844"><a href="#cb153-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-845"><a href="#cb153-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-846"><a href="#cb153-846" aria-hidden="true" tabindex="-1"></a>The first set of color palettes are **sequential** palettes and are suitable for a variable that has ordinal meaning: temperature, precipitation, etc. The second set of palettes are **qualitative** palettes and suitable for qualitative or categorical data. Finally, the third set of palettes are **diverging** palettes and can be suitable for variables that take both negative and positive values like changes in groundwater level.</span>
<span id="cb153-847"><a href="#cb153-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-848"><a href="#cb153-848" aria-hidden="true" tabindex="-1"></a>Two types of <span class="in">`scale`</span> functions can be used to use these palettes:</span>
<span id="cb153-849"><a href="#cb153-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-850"><a href="#cb153-850" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`scale_*_distiller()`</span> for a continuous variable</span>
<span id="cb153-851"><a href="#cb153-851" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`scale_*_brewer()`</span> for a discrete variable</span>
<span id="cb153-852"><a href="#cb153-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-853"><a href="#cb153-853" aria-hidden="true" tabindex="-1"></a>To use a specific color palette, you can simply add <span class="in">`palette = "palette name"`</span> inside <span class="in">`scale_fill_distiller()`</span>. The codes below applies "Spectral" as an example.</span>
<span id="cb153-854"><a href="#cb153-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-855"><a href="#cb153-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-spectral}</span></span>
<span id="cb153-856"><a href="#cb153-856" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + </span></span>
<span id="cb153-857"><a href="#cb153-857" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-858"><a href="#cb153-858" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_distiller(palette = "Spectral")</span></span>
<span id="cb153-859"><a href="#cb153-859" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-860"><a href="#cb153-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-861"><a href="#cb153-861" aria-hidden="true" tabindex="-1"></a>You can reverse the color order by adding <span class="in">`trans = "reverse"`</span> option.</span>
<span id="cb153-862"><a href="#cb153-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-863"><a href="#cb153-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-spectral-reverse}</span></span>
<span id="cb153-864"><a href="#cb153-864" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + </span></span>
<span id="cb153-865"><a href="#cb153-865" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-866"><a href="#cb153-866" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_distiller(palette = "Spectral", trans = "reverse")</span></span>
<span id="cb153-867"><a href="#cb153-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-868"><a href="#cb153-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-869"><a href="#cb153-869" aria-hidden="true" tabindex="-1"></a>If you are specifying the <span class="in">`color`</span> aesthetics based on a continuous variable, then you use <span class="in">`scale_color_distiller()`</span>.</span>
<span id="cb153-870"><a href="#cb153-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-871"><a href="#cb153-871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-spectral-reverse-color}</span></span>
<span id="cb153-872"><a href="#cb153-872" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-873"><a href="#cb153-873" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(aes(color = af_used), size = 2) +</span></span>
<span id="cb153-874"><a href="#cb153-874" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_distiller(palette = "Spectral")</span></span>
<span id="cb153-875"><a href="#cb153-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-876"><a href="#cb153-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-877"><a href="#cb153-877" aria-hidden="true" tabindex="-1"></a>Now, suppose the variable of interest comes with categories of ranges of values. The code below groups <span class="in">`af_used`</span> into five ranges using <span class="in">`ggplo2::cut_number()`</span>.</span>
<span id="cb153-878"><a href="#cb153-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-879"><a href="#cb153-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-spectral-reverse-color-disc, eval = F}</span></span>
<span id="cb153-880"><a href="#cb153-880" aria-hidden="true" tabindex="-1"></a><span class="in">gw_Stevens &lt;- dplyr::mutate(gw_Stevens, af_used_cat = cut_number(af_used, n = 5))</span></span>
<span id="cb153-881"><a href="#cb153-881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-882"><a href="#cb153-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-883"><a href="#cb153-883" aria-hidden="true" tabindex="-1"></a>Since <span class="in">`af_used_cat`</span> is a discrete variable, you can use <span class="in">`scale_color_brewer()`</span> instead.</span>
<span id="cb153-884"><a href="#cb153-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-885"><a href="#cb153-885" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brewer-spectral-brewer}</span></span>
<span id="cb153-886"><a href="#cb153-886" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-887"><a href="#cb153-887" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(aes(color = af_used_cat), size = 2) +</span></span>
<span id="cb153-888"><a href="#cb153-888" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Spectral")</span></span>
<span id="cb153-889"><a href="#cb153-889" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-890"><a href="#cb153-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-891"><a href="#cb153-891" aria-hidden="true" tabindex="-1"></a><span class="fu">### `colorspace` package</span></span>
<span id="cb153-892"><a href="#cb153-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-893"><a href="#cb153-893" aria-hidden="true" tabindex="-1"></a>If you are not satisfied with the <span class="in">`viridis`</span> color map or the <span class="in">`ColorBrewer`</span> palette options, you might want to try the <span class="in">`colorspace`</span> package.</span>
<span id="cb153-894"><a href="#cb153-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-895"><a href="#cb153-895" aria-hidden="true" tabindex="-1"></a>Here is the palettes the <span class="in">`colorspace`</span> package offers.</span>
<span id="cb153-896"><a href="#cb153-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-897"><a href="#cb153-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r palettes-colorspace}</span></span>
<span id="cb153-898"><a href="#cb153-898" aria-hidden="true" tabindex="-1"></a><span class="in">#--- plot the palettes ---#</span></span>
<span id="cb153-899"><a href="#cb153-899" aria-hidden="true" tabindex="-1"></a><span class="in">colorspace::hcl_palettes(plot = TRUE)</span></span>
<span id="cb153-900"><a href="#cb153-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-901"><a href="#cb153-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-902"><a href="#cb153-902" aria-hidden="true" tabindex="-1"></a>The packages offers its own <span class="in">`scale_*()`</span> functions that follows the following naming convention:</span>
<span id="cb153-903"><a href="#cb153-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-904"><a href="#cb153-904" aria-hidden="true" tabindex="-1"></a><span class="in">`scale_aesthetic_datatype_colorscale`</span> where</span>
<span id="cb153-905"><a href="#cb153-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-906"><a href="#cb153-906" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>aesthetic: <span class="in">`fill`</span> or <span class="in">`color`</span></span>
<span id="cb153-907"><a href="#cb153-907" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>datatype: <span class="in">`continuous`</span> or <span class="in">`discrete`</span></span>
<span id="cb153-908"><a href="#cb153-908" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>colorscale: <span class="in">`qualitative`</span>, <span class="in">`sequential`</span>, <span class="in">`diverging`</span>, <span class="in">`divergingx`</span></span>
<span id="cb153-909"><a href="#cb153-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-910"><a href="#cb153-910" aria-hidden="true" tabindex="-1"></a>For example, to add a sequential color scale to the following map, we would use <span class="in">`scale_fill_continuous_sequential()`</span> and then pick a palette from the set of  sequential palettes shown above. The code below uses the Viridis palette with the reverse option:</span>
<span id="cb153-911"><a href="#cb153-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-912"><a href="#cb153-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r base-map-viridis, eval = F}</span></span>
<span id="cb153-913"><a href="#cb153-913" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-914"><a href="#cb153-914" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_by_county, aes(fill = af_used)) +</span></span>
<span id="cb153-915"><a href="#cb153-915" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(. ~ year) +</span></span>
<span id="cb153-916"><a href="#cb153-916" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_continuous_sequential(palette = "Viridis", trans = "reverse")</span></span>
<span id="cb153-917"><a href="#cb153-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-918"><a href="#cb153-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-919"><a href="#cb153-919" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-920"><a href="#cb153-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-921"><a href="#cb153-921" aria-hidden="true" tabindex="-1"></a>If you still cannot find a palette that satisfies your need (or obsession at this point), then you can easily make your own. The package offers <span class="in">`hclwizard()`</span>, which starts shiny-based web application to let you design your own color palette.</span>
<span id="cb153-922"><a href="#cb153-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-923"><a href="#cb153-923" aria-hidden="true" tabindex="-1"></a>After running this,</span>
<span id="cb153-924"><a href="#cb153-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-925"><a href="#cb153-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-926"><a href="#cb153-926" aria-hidden="true" tabindex="-1"></a><span class="in">hclwizard()</span></span>
<span id="cb153-927"><a href="#cb153-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-928"><a href="#cb153-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-929"><a href="#cb153-929" aria-hidden="true" tabindex="-1"></a>you should see a web application pop up that looks like this.</span>
<span id="cb153-930"><a href="#cb153-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-933"><a href="#cb153-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-934"><a href="#cb153-934" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"assets/hclwizard.png"</span>)</span>
<span id="cb153-935"><a href="#cb153-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-936"><a href="#cb153-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-937"><a href="#cb153-937" aria-hidden="true" tabindex="-1"></a>After you find a color scale you would like to use, you can go to the **Export**tab, select the **R** tab, and then copy the code that appear in the highlighted area.</span>
<span id="cb153-938"><a href="#cb153-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-941"><a href="#cb153-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-942"><a href="#cb153-942" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"assets/hclwizard_pick_theme.png"</span>)</span>
<span id="cb153-943"><a href="#cb153-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-944"><a href="#cb153-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-945"><a href="#cb153-945" aria-hidden="true" tabindex="-1"></a>You could register the color palette by completing the <span class="in">`register =`</span> option in the copied code if you think you will use it other times. Otherwise, you can delete the option.</span>
<span id="cb153-946"><a href="#cb153-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-947"><a href="#cb153-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r seq-hcl}</span></span>
<span id="cb153-948"><a href="#cb153-948" aria-hidden="true" tabindex="-1"></a><span class="in">col_palette &lt;- colorspace::sequential_hcl(n = 7, h = c(36, 200), c = c(60, NA, 0), l = c(25, 95), power = c(0.7, 1.3))</span></span>
<span id="cb153-949"><a href="#cb153-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-950"><a href="#cb153-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-951"><a href="#cb153-951" aria-hidden="true" tabindex="-1"></a>We then use the code as follows:</span>
<span id="cb153-952"><a href="#cb153-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-953"><a href="#cb153-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r use-col-scale}</span></span>
<span id="cb153-954"><a href="#cb153-954" aria-hidden="true" tabindex="-1"></a><span class="in">g_col_scale + </span></span>
<span id="cb153-955"><a href="#cb153-955" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-956"><a href="#cb153-956" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colors = col_palette)</span></span>
<span id="cb153-957"><a href="#cb153-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-958"><a href="#cb153-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-959"><a href="#cb153-959" aria-hidden="true" tabindex="-1"></a>Note that you are now using <span class="in">`scale_*_gradientn()`</span> with this approach.</span>
<span id="cb153-960"><a href="#cb153-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-961"><a href="#cb153-961" aria-hidden="true" tabindex="-1"></a>For a discrete variable, you can use <span class="in">`scale_*_manual()`</span>:</span>
<span id="cb153-962"><a href="#cb153-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-963"><a href="#cb153-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error = TRUE}</span></span>
<span id="cb153-964"><a href="#cb153-964" aria-hidden="true" tabindex="-1"></a><span class="in">col_discrete &lt;- colorspace::sequential_hcl(n = 5, h = c(240, 130), c = c(30, NA, 33), l = c(25, 95), power = c(1, NA), rev = TRUE)</span></span>
<span id="cb153-965"><a href="#cb153-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-966"><a href="#cb153-966" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-967"><a href="#cb153-967" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_Stevens, aes(color = af_used_cat), size = 2) +</span></span>
<span id="cb153-968"><a href="#cb153-968" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = col_discrete)</span></span>
<span id="cb153-969"><a href="#cb153-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-970"><a href="#cb153-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-971"><a href="#cb153-971" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-972"><a href="#cb153-972" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-973"><a href="#cb153-973" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Arranging maps</span></span>
<span id="cb153-974"><a href="#cb153-974" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-975"><a href="#cb153-975" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-976"><a href="#cb153-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-977"><a href="#cb153-977" aria-hidden="true" tabindex="-1"></a><span class="fu">## Arranging maps</span></span>
<span id="cb153-978"><a href="#cb153-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-979"><a href="#cb153-979" aria-hidden="true" tabindex="-1"></a><span class="in">`patchwork`</span> combines <span class="in">`ggplot`</span> objects (maps) using simple operators: <span class="in">`+`</span>, <span class="in">`/`</span>, and <span class="in">`|`</span>. Let's first create maps of tmax and precipitation separately.</span>
<span id="cb153-980"><a href="#cb153-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-981"><a href="#cb153-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex}</span></span>
<span id="cb153-982"><a href="#cb153-982" aria-hidden="true" tabindex="-1"></a><span class="in">#--- tmax ---#</span></span>
<span id="cb153-983"><a href="#cb153-983" aria-hidden="true" tabindex="-1"></a><span class="in">tmax_20000101 &lt;- terra::rast("Data/PRISM/PRISM_tmax_stable_4kmD2_20000101_bil/PRISM_tmax_stable_4kmD2_20000101_bil.bil")</span></span>
<span id="cb153-984"><a href="#cb153-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-985"><a href="#cb153-985" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-986"><a href="#cb153-986" aria-hidden="true" tabindex="-1"></a><span class="in">  g_tmax &lt;- </span></span>
<span id="cb153-987"><a href="#cb153-987" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-988"><a href="#cb153-988" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_spatraster(data = tmax_20000101) +</span></span>
<span id="cb153-989"><a href="#cb153-989" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_viridis_c() +</span></span>
<span id="cb153-990"><a href="#cb153-990" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void() +</span></span>
<span id="cb153-991"><a href="#cb153-991" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "bottom")</span></span>
<span id="cb153-992"><a href="#cb153-992" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-993"><a href="#cb153-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-994"><a href="#cb153-994" aria-hidden="true" tabindex="-1"></a><span class="in">#--- ppt ---#</span></span>
<span id="cb153-995"><a href="#cb153-995" aria-hidden="true" tabindex="-1"></a><span class="in">ppt_20000101 &lt;- terra::rast("Data/PRISM/PRISM_ppt_stable_4kmD2_20000101_bil/PRISM_ppt_stable_4kmD2_20000101_bil.bil")</span></span>
<span id="cb153-996"><a href="#cb153-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-997"><a href="#cb153-997" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-998"><a href="#cb153-998" aria-hidden="true" tabindex="-1"></a><span class="in">  g_ppt &lt;- </span></span>
<span id="cb153-999"><a href="#cb153-999" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-1000"><a href="#cb153-1000" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_spatraster(data = ppt_20000101) +</span></span>
<span id="cb153-1001"><a href="#cb153-1001" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_viridis_c() +</span></span>
<span id="cb153-1002"><a href="#cb153-1002" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void() +</span></span>
<span id="cb153-1003"><a href="#cb153-1003" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "bottom")</span></span>
<span id="cb153-1004"><a href="#cb153-1004" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1005"><a href="#cb153-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1006"><a href="#cb153-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1007"><a href="#cb153-1007" aria-hidden="true" tabindex="-1"></a>It is best to just look at examples to get the sense of how <span class="in">`patchwork`</span> works. A fuller treatment of <span class="in">`patchwork`</span> is found <span class="co">[</span><span class="ot">here</span><span class="co">](https://patchwork.data-imaginist.com/index.html)</span>.</span>
<span id="cb153-1008"><a href="#cb153-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1009"><a href="#cb153-1009" aria-hidden="true" tabindex="-1"></a>**Example 1**</span>
<span id="cb153-1010"><a href="#cb153-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1011"><a href="#cb153-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex-1}</span></span>
<span id="cb153-1012"><a href="#cb153-1012" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax + g_ppt</span></span>
<span id="cb153-1013"><a href="#cb153-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1014"><a href="#cb153-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1015"><a href="#cb153-1015" aria-hidden="true" tabindex="-1"></a>**Example 2**</span>
<span id="cb153-1016"><a href="#cb153-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1017"><a href="#cb153-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex-2}</span></span>
<span id="cb153-1018"><a href="#cb153-1018" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax / g_ppt / g_tmax</span></span>
<span id="cb153-1019"><a href="#cb153-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1020"><a href="#cb153-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1021"><a href="#cb153-1021" aria-hidden="true" tabindex="-1"></a>**Example 3**</span>
<span id="cb153-1022"><a href="#cb153-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1023"><a href="#cb153-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex-3}</span></span>
<span id="cb153-1024"><a href="#cb153-1024" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax + g_ppt + plot_layout(nrow = 2)</span></span>
<span id="cb153-1025"><a href="#cb153-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1026"><a href="#cb153-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1027"><a href="#cb153-1027" aria-hidden="true" tabindex="-1"></a>**Example 4**</span>
<span id="cb153-1028"><a href="#cb153-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1029"><a href="#cb153-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex-4}</span></span>
<span id="cb153-1030"><a href="#cb153-1030" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax + g_ppt + g_tmax + g_ppt + plot_layout(nrow = 3, byrow = FALSE)</span></span>
<span id="cb153-1031"><a href="#cb153-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1032"><a href="#cb153-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1033"><a href="#cb153-1033" aria-hidden="true" tabindex="-1"></a>**Example 5**</span>
<span id="cb153-1034"><a href="#cb153-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1035"><a href="#cb153-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pw-ex-5}</span></span>
<span id="cb153-1036"><a href="#cb153-1036" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax | (g_ppt / g_tmax)</span></span>
<span id="cb153-1037"><a href="#cb153-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1038"><a href="#cb153-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1039"><a href="#cb153-1039" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-1040"><a href="#cb153-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1041"><a href="#cb153-1041" aria-hidden="true" tabindex="-1"></a>Sometimes figures are placed too close to each other. In such a case, you can pad a figure at the time of generating individual figures by adding the <span class="in">`plot.margin`</span> option to <span class="in">`theme()`</span>. For example, the following code creates space at the bottom of <span class="in">`g_tmax`</span> (5 cm), and vertically stack <span class="in">`g_tmax`</span> and <span class="in">`g_ppt`</span>.</span>
<span id="cb153-1042"><a href="#cb153-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1043"><a href="#cb153-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pad-one}</span></span>
<span id="cb153-1044"><a href="#cb153-1044" aria-hidden="true" tabindex="-1"></a><span class="in">#--- space at the bottom ---#</span></span>
<span id="cb153-1045"><a href="#cb153-1045" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax &lt;- </span></span>
<span id="cb153-1046"><a href="#cb153-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  g_tmax + </span></span>
<span id="cb153-1047"><a href="#cb153-1047" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.margin = unit(c(0, 0, 5, 0), "cm"))</span></span>
<span id="cb153-1048"><a href="#cb153-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1049"><a href="#cb153-1049" aria-hidden="true" tabindex="-1"></a><span class="in">#--- vertically stack ---#</span></span>
<span id="cb153-1050"><a href="#cb153-1050" aria-hidden="true" tabindex="-1"></a><span class="in">g_tmax / g_ppt</span></span>
<span id="cb153-1051"><a href="#cb153-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1052"><a href="#cb153-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1053"><a href="#cb153-1053" aria-hidden="true" tabindex="-1"></a>In <span class="in">`plot.margin = unit(c(a, b, c, d), "cm")`</span>, here is which margin <span class="in">`a`</span>, <span class="in">`b`</span>, <span class="in">`c`</span>, and <span class="in">`d`</span> refers to.</span>
<span id="cb153-1054"><a href="#cb153-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1055"><a href="#cb153-1055" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`a`</span>: top</span>
<span id="cb153-1056"><a href="#cb153-1056" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`b`</span>: right</span>
<span id="cb153-1057"><a href="#cb153-1057" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`c`</span>: bottom</span>
<span id="cb153-1058"><a href="#cb153-1058" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`d`</span>: left</span>
<span id="cb153-1059"><a href="#cb153-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1060"><a href="#cb153-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inset Maps: Displaying a Map Within a Map</span></span>
<span id="cb153-1061"><a href="#cb153-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1064"><a href="#cb153-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1065"><a href="#cb153-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false </span></span>
<span id="cb153-1066"><a href="#cb153-1066" aria-hidden="true" tabindex="-1"></a>three_counties <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(KS_county, NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cheyenne"</span>, <span class="st">"Sherman"</span>, <span class="st">"Wallace"</span>))</span>
<span id="cb153-1067"><a href="#cb153-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1068"><a href="#cb153-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1069"><a href="#cb153-1069" aria-hidden="true" tabindex="-1"></a>Sometimes, it is useful to present a map that covers a larger geographical range than the area of interest in the same map. This provides a better sense of the geographic extent and location of the area of interest relative to the larger geographic extent that the readers are more familiar with. For example, suppose your work is restricted to three counties in Kansas: Cheyenne, Sherman, and Wallace (@fig-three-counties-map presents their locations in Kansas)</span>
<span id="cb153-1070"><a href="#cb153-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1071"><a href="#cb153-1071" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb153-1072"><a href="#cb153-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb153-1073"><a href="#cb153-1073" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-three-counties-map</span></span>
<span id="cb153-1074"><a href="#cb153-1074" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Cheyenne, Sherman, and Wallace Counties of Kansas"</span></span>
<span id="cb153-1075"><a href="#cb153-1075" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb153-1076"><a href="#cb153-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1077"><a href="#cb153-1077" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1078"><a href="#cb153-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  g_three_counties &lt;-</span></span>
<span id="cb153-1079"><a href="#cb153-1079" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-1080"><a href="#cb153-1080" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = KS_county, fill = NA) +</span></span>
<span id="cb153-1081"><a href="#cb153-1081" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = three_counties, fill = "red", alpha = 0.3) +</span></span>
<span id="cb153-1082"><a href="#cb153-1082" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf_text(data = three_counties, aes(label = NAME)) +</span></span>
<span id="cb153-1083"><a href="#cb153-1083" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void()</span></span>
<span id="cb153-1084"><a href="#cb153-1084" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1085"><a href="#cb153-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1086"><a href="#cb153-1086" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-1087"><a href="#cb153-1087" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--end of column-margin--&gt;</span></span>
<span id="cb153-1088"><a href="#cb153-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1091"><a href="#cb153-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1092"><a href="#cb153-1092" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1093"><a href="#cb153-1093" aria-hidden="true" tabindex="-1"></a>three_counties <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(KS_county, NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cheyenne"</span>, <span class="st">"Sherman"</span>, <span class="st">"Wallace"</span>))</span>
<span id="cb153-1094"><a href="#cb153-1094" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1095"><a href="#cb153-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1096"><a href="#cb153-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1097"><a href="#cb153-1097" aria-hidden="true" tabindex="-1"></a>For those unfamiliar with Kansas, it can be helpful to show its location on the same map (or even where Kansas is within the U.S.). </span>
<span id="cb153-1098"><a href="#cb153-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1099"><a href="#cb153-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using the `ggmapinset` package</span></span>
<span id="cb153-1100"><a href="#cb153-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1101"><a href="#cb153-1101" aria-hidden="true" tabindex="-1"></a>The goal here is to create a map like @fig-inset-ggmapinset.</span>
<span id="cb153-1102"><a href="#cb153-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1103"><a href="#cb153-1103" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb153-1106"><a href="#cb153-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1107"><a href="#cb153-1107" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-inset-ggmapinset</span></span>
<span id="cb153-1108"><a href="#cb153-1108" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Inset map created with ggmapinset"</span></span>
<span id="cb153-1109"><a href="#cb153-1109" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb153-1110"><a href="#cb153-1110" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb153-1111"><a href="#cb153-1111" aria-hidden="true" tabindex="-1"></a>g_three_counties <span class="ot">&lt;-</span></span>
<span id="cb153-1112"><a href="#cb153-1112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb153-1113"><a href="#cb153-1113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> KS_county, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb153-1114"><a href="#cb153-1114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> three_counties, <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb153-1115"><a href="#cb153-1115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span>
<span id="cb153-1116"><a href="#cb153-1116" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1117"><a href="#cb153-1117" aria-hidden="true" tabindex="-1"></a>g_three_counties <span class="sc">+</span></span>
<span id="cb153-1118"><a href="#cb153-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_inset</span>(<span class="at">data =</span> three_counties, <span class="at">map_base =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb153-1119"><a href="#cb153-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text_inset</span>(<span class="at">data =</span> three_counties, <span class="fu">aes</span>(<span class="at">label =</span> NAME)) <span class="sc">+</span></span>
<span id="cb153-1120"><a href="#cb153-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_inset_frame</span>() <span class="sc">+</span></span>
<span id="cb153-1121"><a href="#cb153-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf_inset</span>(<span class="at">inset =</span> </span>
<span id="cb153-1122"><a href="#cb153-1122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">configure_inset</span>(</span>
<span id="cb153-1123"><a href="#cb153-1123" aria-hidden="true" tabindex="-1"></a>      <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span id="cb153-1124"><a href="#cb153-1124" aria-hidden="true" tabindex="-1"></a>      <span class="at">centre =</span> sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_union</span>(three_counties)),</span>
<span id="cb153-1125"><a href="#cb153-1125" aria-hidden="true" tabindex="-1"></a>      <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span id="cb153-1126"><a href="#cb153-1126" aria-hidden="true" tabindex="-1"></a>      <span class="at">translation =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">0</span>),</span>
<span id="cb153-1127"><a href="#cb153-1127" aria-hidden="true" tabindex="-1"></a>      <span class="co">#--- radius of 80 km ---#</span></span>
<span id="cb153-1128"><a href="#cb153-1128" aria-hidden="true" tabindex="-1"></a>      <span class="at">radius =</span> <span class="dv">80</span>,</span>
<span id="cb153-1129"><a href="#cb153-1129" aria-hidden="true" tabindex="-1"></a>      <span class="co">#--- scale up by 2 ---#</span></span>
<span id="cb153-1130"><a href="#cb153-1130" aria-hidden="true" tabindex="-1"></a>      <span class="at">scale =</span> <span class="dv">6</span>,</span>
<span id="cb153-1131"><a href="#cb153-1131" aria-hidden="true" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">"km"</span></span>
<span id="cb153-1132"><a href="#cb153-1132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb153-1133"><a href="#cb153-1133" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-1134"><a href="#cb153-1134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1135"><a href="#cb153-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1136"><a href="#cb153-1136" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-1137"><a href="#cb153-1137" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--end of column-margin--&gt;</span></span>
<span id="cb153-1138"><a href="#cb153-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1139"><a href="#cb153-1139" aria-hidden="true" tabindex="-1"></a>The first step of making an inset map using <span class="in">`ggmapinset`</span> is to create the base map layer (Kansas county borders), a part of which is going to be expanded as an inset later. </span>
<span id="cb153-1140"><a href="#cb153-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1141"><a href="#cb153-1141" aria-hidden="true" tabindex="-1"></a>As the base map, we will create a map of all the counties in Kansas with only the three counties (Perkins, Chase, and Dundy) colored red.</span>
<span id="cb153-1142"><a href="#cb153-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1145"><a href="#cb153-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1146"><a href="#cb153-1146" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1147"><a href="#cb153-1147" aria-hidden="true" tabindex="-1"></a>  g_three_counties <span class="ot">&lt;-</span></span>
<span id="cb153-1148"><a href="#cb153-1148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb153-1149"><a href="#cb153-1149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> KS_county, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb153-1150"><a href="#cb153-1150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> three_counties, <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb153-1151"><a href="#cb153-1151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span>
<span id="cb153-1152"><a href="#cb153-1152" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1153"><a href="#cb153-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1154"><a href="#cb153-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1155"><a href="#cb153-1155" aria-hidden="true" tabindex="-1"></a>We now configure the inset using <span class="in">`configure_inset()`</span>. Below is the list of parameters to specify:</span>
<span id="cb153-1156"><a href="#cb153-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1157"><a href="#cb153-1157" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`centre`</span>: The geographic coordinates of the small circle from which the enlargement begins.</span>
<span id="cb153-1158"><a href="#cb153-1158" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`translation`</span>: The amount of shift in the x and y directions from the center to position the enlarged circle.</span>
<span id="cb153-1159"><a href="#cb153-1159" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`radius`</span>: The radius of the original small circle.</span>
<span id="cb153-1160"><a href="#cb153-1160" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`scale`</span>: The factor by which the circle is enlarged.</span>
<span id="cb153-1161"><a href="#cb153-1161" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`units`</span>: The unit of measurement for the radius.</span>
<span id="cb153-1162"><a href="#cb153-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1163"><a href="#cb153-1163" aria-hidden="true" tabindex="-1"></a>It is hard to get <span class="in">`translation`</span>, <span class="in">`radius`</span>, and <span class="in">`scale`</span> right the first time. After some try and errors, you can get them right. In the code below, the center of the circle is set at the centroid of the three counties combined (<span class="in">`sf::st_centroid(sf::st_union(three_counties)`</span>). <span class="in">`translation = c(300, -250)`</span> along with <span class="in">`units = "km"`</span> means that the inset map (map inside the circle in @fig-inset-ggmapinset) is 300km east and 250km south (-250 north) to the base map. The radius of the circle is specified to be 80km with <span class="in">`radius = 80`</span>. </span>
<span id="cb153-1164"><a href="#cb153-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1167"><a href="#cb153-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1168"><a href="#cb153-1168" aria-hidden="true" tabindex="-1"></a>inset_config <span class="ot">&lt;-</span> </span>
<span id="cb153-1169"><a href="#cb153-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">configure_inset</span>(</span>
<span id="cb153-1170"><a href="#cb153-1170" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span id="cb153-1171"><a href="#cb153-1171" aria-hidden="true" tabindex="-1"></a>    <span class="at">centre =</span> sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_union</span>(three_counties)),</span>
<span id="cb153-1172"><a href="#cb153-1172" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span id="cb153-1173"><a href="#cb153-1173" aria-hidden="true" tabindex="-1"></a>    <span class="at">translation =</span> <span class="fu">c</span>(<span class="dv">300</span>, <span class="sc">-</span><span class="dv">250</span>),</span>
<span id="cb153-1174"><a href="#cb153-1174" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- radius of 80 km ---#</span></span>
<span id="cb153-1175"><a href="#cb153-1175" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">80</span>,</span>
<span id="cb153-1176"><a href="#cb153-1176" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- scale up by 2 ---#</span></span>
<span id="cb153-1177"><a href="#cb153-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">2</span>,</span>
<span id="cb153-1178"><a href="#cb153-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">"km"</span></span>
<span id="cb153-1179"><a href="#cb153-1179" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-1180"><a href="#cb153-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1181"><a href="#cb153-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1182"><a href="#cb153-1182" aria-hidden="true" tabindex="-1"></a>With the inset configuration ready, we can now add the inset. For this, use the following functions:</span>
<span id="cb153-1183"><a href="#cb153-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1184"><a href="#cb153-1184" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`geom_sf_inset()`</span> and/or <span class="in">`geom_sf_text_inset()`</span> to create the layers that will appear in the inset (the circle).</span>
<span id="cb153-1185"><a href="#cb153-1185" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`geom_inset_frame()`</span> to add the frame, which includes the small circle, the large circle, and connecting lines.</span>
<span id="cb153-1186"><a href="#cb153-1186" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`coord_sf_inset(inset = inset_config)`</span> to apply the configuration you set up earlier.</span>
<span id="cb153-1187"><a href="#cb153-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1190"><a href="#cb153-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1191"><a href="#cb153-1191" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1192"><a href="#cb153-1192" aria-hidden="true" tabindex="-1"></a>g_three_counties <span class="sc">+</span></span>
<span id="cb153-1193"><a href="#cb153-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_inset</span>(<span class="at">data =</span> three_counties, <span class="at">map_base =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb153-1194"><a href="#cb153-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text_inset</span>(<span class="at">data =</span> three_counties, <span class="fu">aes</span>(<span class="at">label =</span> NAME)) <span class="sc">+</span></span>
<span id="cb153-1195"><a href="#cb153-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_inset_frame</span>() <span class="sc">+</span></span>
<span id="cb153-1196"><a href="#cb153-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf_inset</span>(<span class="at">inset =</span> inset_config)</span>
<span id="cb153-1197"><a href="#cb153-1197" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1198"><a href="#cb153-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1199"><a href="#cb153-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1200"><a href="#cb153-1200" aria-hidden="true" tabindex="-1"></a>Well, this is not quite right. Let's re-configure the inset parameters like below:</span>
<span id="cb153-1201"><a href="#cb153-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1204"><a href="#cb153-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1205"><a href="#cb153-1205" aria-hidden="true" tabindex="-1"></a>inset_config <span class="ot">&lt;-</span> </span>
<span id="cb153-1206"><a href="#cb153-1206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">configure_inset</span>(</span>
<span id="cb153-1207"><a href="#cb153-1207" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- centroid of the three counties as the center ---#</span></span>
<span id="cb153-1208"><a href="#cb153-1208" aria-hidden="true" tabindex="-1"></a>    <span class="at">centre =</span> sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_union</span>(three_counties)),</span>
<span id="cb153-1209"><a href="#cb153-1209" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- move 300 east and 250 south ---#</span></span>
<span id="cb153-1210"><a href="#cb153-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">translation =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">0</span>),</span>
<span id="cb153-1211"><a href="#cb153-1211" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- radius of 80 km ---#</span></span>
<span id="cb153-1212"><a href="#cb153-1212" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">80</span>,</span>
<span id="cb153-1213"><a href="#cb153-1213" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- scale up by 2 ---#</span></span>
<span id="cb153-1214"><a href="#cb153-1214" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">6</span>,</span>
<span id="cb153-1215"><a href="#cb153-1215" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">"km"</span></span>
<span id="cb153-1216"><a href="#cb153-1216" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-1217"><a href="#cb153-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1218"><a href="#cb153-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1221"><a href="#cb153-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1222"><a href="#cb153-1222" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1223"><a href="#cb153-1223" aria-hidden="true" tabindex="-1"></a>g_three_counties <span class="sc">+</span></span>
<span id="cb153-1224"><a href="#cb153-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_inset</span>(<span class="at">data =</span> three_counties, <span class="at">map_base =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb153-1225"><a href="#cb153-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text_inset</span>(<span class="at">data =</span> three_counties, <span class="fu">aes</span>(<span class="at">label =</span> NAME)) <span class="sc">+</span></span>
<span id="cb153-1226"><a href="#cb153-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_inset_frame</span>() <span class="sc">+</span></span>
<span id="cb153-1227"><a href="#cb153-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf_inset</span>(<span class="at">inset =</span> inset_config)</span>
<span id="cb153-1228"><a href="#cb153-1228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1229"><a href="#cb153-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1230"><a href="#cb153-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1231"><a href="#cb153-1231" aria-hidden="true" tabindex="-1"></a>Here, <span class="in">`scale`</span> is set to a higher number at 6 so that the inset map is much bigger relative to the base map. <span class="in">`translation`</span> was also altered significantly so that the inset map does not overlap with the base map after scaling up the inset map.</span>
<span id="cb153-1232"><a href="#cb153-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1233"><a href="#cb153-1233" aria-hidden="true" tabindex="-1"></a>:::{.callout-note title="Note on <span class="in">`map_base`</span>"}</span>
<span id="cb153-1234"><a href="#cb153-1234" aria-hidden="true" tabindex="-1"></a>By default, <span class="in">`geom_sf_inset()`</span> creates two copies of the map layer specified by <span class="in">`geom_sf_inset()`</span> and/or <span class="in">`geom_sf_text_inset()`</span>: one for the base map and the other for the inset map. <span class="in">`map_base`</span> option determines whether you create the copy for the base map or not.</span>
<span id="cb153-1235"><a href="#cb153-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1236"><a href="#cb153-1236" aria-hidden="true" tabindex="-1"></a>In the code below, <span class="in">`map_base = "none"`</span> is not specified unlike the map created just above, meaning that <span class="in">`geom_sf_inset(data = three_counties, fill = "black")`</span> will be applied for both the base and inset maps. Consequently, you see that the default fill color of "gray" is used for both the inset and base maps, overwriting the aesthetics for the three counties in the base map. </span>
<span id="cb153-1237"><a href="#cb153-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1240"><a href="#cb153-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb153-1241"><a href="#cb153-1241" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb153-1242"><a href="#cb153-1242" aria-hidden="true" tabindex="-1"></a>g_three_counties <span class="sc">+</span></span>
<span id="cb153-1243"><a href="#cb153-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_inset</span>(<span class="at">data =</span> three_counties) <span class="sc">+</span></span>
<span id="cb153-1244"><a href="#cb153-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text_inset</span>(<span class="at">data =</span> three_counties, <span class="fu">aes</span>(<span class="at">label =</span> NAME)) <span class="sc">+</span></span>
<span id="cb153-1245"><a href="#cb153-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_inset_frame</span>() <span class="sc">+</span></span>
<span id="cb153-1246"><a href="#cb153-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf_inset</span>(<span class="at">inset =</span> inset_config)</span>
<span id="cb153-1247"><a href="#cb153-1247" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-1248"><a href="#cb153-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1249"><a href="#cb153-1249" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-1250"><a href="#cb153-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1251"><a href="#cb153-1251" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb153-1252"><a href="#cb153-1252" aria-hidden="true" tabindex="-1"></a>Visit the <span class="co">[</span><span class="ot">`ggmapinset` website</span><span class="co">](https://cidm-ph.github.io/ggmapinset/index.html)</span> for more examples and other functionalities beyond what is presented here, including multiple insets. </span>
<span id="cb153-1253"><a href="#cb153-1253" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb153-1254"><a href="#cb153-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1255"><a href="#cb153-1255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using `ggplotGrob()` and `annotation_custom()`</span></span>
<span id="cb153-1256"><a href="#cb153-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1257"><a href="#cb153-1257" aria-hidden="true" tabindex="-1"></a>You can also use <span class="in">`ggplotGrob()`</span> and <span class="in">`annotation_custom()`</span> to create an inset map. The steps to achieve this are as follows:</span>
<span id="cb153-1258"><a href="#cb153-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1259"><a href="#cb153-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>create a map of the area of interest and turn it into a <span class="in">`grob`</span> object using <span class="in">`ggplotGrob()`</span></span>
<span id="cb153-1260"><a href="#cb153-1260" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>create a map of the region that includes the area of interest and turn it into a <span class="in">`grob`</span> object using <span class="in">`ggplotGrob()`</span></span>
<span id="cb153-1261"><a href="#cb153-1261" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>combine the two using <span class="in">`annotation_custom()`</span></span>
<span id="cb153-1262"><a href="#cb153-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1263"><a href="#cb153-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r grob-start}</span></span>
<span id="cb153-1264"><a href="#cb153-1264" aria-hidden="true" tabindex="-1"></a><span class="in">#--- convert the ggplot into a grob ---#</span></span>
<span id="cb153-1265"><a href="#cb153-1265" aria-hidden="true" tabindex="-1"></a><span class="in">grob_aoi &lt;- ggplotGrob(g_three_counties)</span></span>
<span id="cb153-1266"><a href="#cb153-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1267"><a href="#cb153-1267" aria-hidden="true" tabindex="-1"></a><span class="in">#--- check the class ---#</span></span>
<span id="cb153-1268"><a href="#cb153-1268" aria-hidden="true" tabindex="-1"></a><span class="in">class(grob_aoi)</span></span>
<span id="cb153-1269"><a href="#cb153-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1270"><a href="#cb153-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1271"><a href="#cb153-1271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ks-region-map}</span></span>
<span id="cb153-1272"><a href="#cb153-1272" aria-hidden="true" tabindex="-1"></a><span class="in">#--- create a map of Kansas ---#</span></span>
<span id="cb153-1273"><a href="#cb153-1273" aria-hidden="true" tabindex="-1"></a><span class="in">g_region &lt;- </span></span>
<span id="cb153-1274"><a href="#cb153-1274" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb153-1275"><a href="#cb153-1275" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = KS_county) +</span></span>
<span id="cb153-1276"><a href="#cb153-1276" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = three_counties, fill = "blue", color = "red", alpha = 0.5) +</span></span>
<span id="cb153-1277"><a href="#cb153-1277" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-1278"><a href="#cb153-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1279"><a href="#cb153-1279" aria-hidden="true" tabindex="-1"></a><span class="in">#--- convert to a grob ---#</span></span>
<span id="cb153-1280"><a href="#cb153-1280" aria-hidden="true" tabindex="-1"></a><span class="in">grob_region &lt;- ggplotGrob(g_region)</span></span>
<span id="cb153-1281"><a href="#cb153-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1282"><a href="#cb153-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1283"><a href="#cb153-1283" aria-hidden="true" tabindex="-1"></a>Now that we have two maps, we can now put them on the same map using <span class="in">`annotation_custom()`</span>. The first task is to initiate a <span class="in">`ggplot`</span> with <span class="in">`coord_equal()`</span> as follows:</span>
<span id="cb153-1284"><a href="#cb153-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1285"><a href="#cb153-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inset-map}</span></span>
<span id="cb153-1286"><a href="#cb153-1286" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1287"><a href="#cb153-1287" aria-hidden="true" tabindex="-1"></a><span class="in">  g_inset &lt;- </span></span>
<span id="cb153-1288"><a href="#cb153-1288" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-1289"><a href="#cb153-1289" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_equal(xlim = c(0, 1), ylim = c(0, 1), expand = FALSE)</span></span>
<span id="cb153-1290"><a href="#cb153-1290" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1291"><a href="#cb153-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1292"><a href="#cb153-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1293"><a href="#cb153-1293" aria-hidden="true" tabindex="-1"></a>You now have a blank canvas to put the images on. Let's add a layer to the canvas using <span class="in">`annotation_custom()`</span> in which you provide the <span class="in">`grob`</span> object (a map) and specify the range of the canvas the map occupies. Since the extent of x and y are set to <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span> above with <span class="in">`coord_equal(xlim = c(0, 1), ylim = c(0, 1), expand = FALSE)`</span>, the following code put the <span class="in">`grob_aoi`</span> to cover the entire y range and up to 0.8 of x from 0.</span>
<span id="cb153-1294"><a href="#cb153-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1295"><a href="#cb153-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inset-annotation-1}</span></span>
<span id="cb153-1296"><a href="#cb153-1296" aria-hidden="true" tabindex="-1"></a><span class="in">g_inset +</span></span>
<span id="cb153-1297"><a href="#cb153-1297" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(grob_aoi,</span></span>
<span id="cb153-1298"><a href="#cb153-1298" aria-hidden="true" tabindex="-1"></a><span class="in">    xmin = 0, xmax = 0.8, ymin = 0,</span></span>
<span id="cb153-1299"><a href="#cb153-1299" aria-hidden="true" tabindex="-1"></a><span class="in">    ymax = 1</span></span>
<span id="cb153-1300"><a href="#cb153-1300" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1301"><a href="#cb153-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1302"><a href="#cb153-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1303"><a href="#cb153-1303" aria-hidden="true" tabindex="-1"></a>Similarly, we can add <span class="in">`grob_region`</span> using <span class="in">`annotation_custom()`</span>. Let's put it at the right lower corner of the map.</span>
<span id="cb153-1304"><a href="#cb153-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1305"><a href="#cb153-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inset-annotation-2}</span></span>
<span id="cb153-1306"><a href="#cb153-1306" aria-hidden="true" tabindex="-1"></a><span class="in">g_inset +</span></span>
<span id="cb153-1307"><a href="#cb153-1307" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(grob_aoi,</span></span>
<span id="cb153-1308"><a href="#cb153-1308" aria-hidden="true" tabindex="-1"></a><span class="in">    xmin = 0, xmax = 0.8, ymin = 0,</span></span>
<span id="cb153-1309"><a href="#cb153-1309" aria-hidden="true" tabindex="-1"></a><span class="in">    ymax = 1</span></span>
<span id="cb153-1310"><a href="#cb153-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1311"><a href="#cb153-1311" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(grob_region,</span></span>
<span id="cb153-1312"><a href="#cb153-1312" aria-hidden="true" tabindex="-1"></a><span class="in">    xmin = 0.6, xmax = 1, ymin = 0,</span></span>
<span id="cb153-1313"><a href="#cb153-1313" aria-hidden="true" tabindex="-1"></a><span class="in">    ymax = 0.3</span></span>
<span id="cb153-1314"><a href="#cb153-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1315"><a href="#cb153-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1316"><a href="#cb153-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1317"><a href="#cb153-1317" aria-hidden="true" tabindex="-1"></a>Note that the resulting map still has the default theme because it does not inherit the theme of maps added by <span class="in">`annotation_custom()`</span>. So, you can add <span class="in">`theme_void()`</span> to the map to make the border disappear.</span>
<span id="cb153-1318"><a href="#cb153-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1319"><a href="#cb153-1319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-void-custom}</span></span>
<span id="cb153-1320"><a href="#cb153-1320" aria-hidden="true" tabindex="-1"></a><span class="in">g_inset +</span></span>
<span id="cb153-1321"><a href="#cb153-1321" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(grob_aoi,</span></span>
<span id="cb153-1322"><a href="#cb153-1322" aria-hidden="true" tabindex="-1"></a><span class="in">    xmin = 0, xmax = 0.8, ymin = 0,</span></span>
<span id="cb153-1323"><a href="#cb153-1323" aria-hidden="true" tabindex="-1"></a><span class="in">    ymax = 1</span></span>
<span id="cb153-1324"><a href="#cb153-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1325"><a href="#cb153-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(grob_region,</span></span>
<span id="cb153-1326"><a href="#cb153-1326" aria-hidden="true" tabindex="-1"></a><span class="in">    xmin = 0.6, xmax = 1, ymin = 0,</span></span>
<span id="cb153-1327"><a href="#cb153-1327" aria-hidden="true" tabindex="-1"></a><span class="in">    ymax = 0.3</span></span>
<span id="cb153-1328"><a href="#cb153-1328" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1329"><a href="#cb153-1329" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb153-1330"><a href="#cb153-1330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1331"><a href="#cb153-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1332"><a href="#cb153-1332" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-1333"><a href="#cb153-1333" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-1334"><a href="#cb153-1334" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Fine-tune maps for publication</span></span>
<span id="cb153-1335"><a href="#cb153-1335" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-1336"><a href="#cb153-1336" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-1337"><a href="#cb153-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1338"><a href="#cb153-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fine-tuning maps for publication {#sec-fine-tune}</span></span>
<span id="cb153-1339"><a href="#cb153-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1340"><a href="#cb153-1340" aria-hidden="true" tabindex="-1"></a>This section offers several tips to enhance the appearance of your maps, making them suitable for publication in professional reports. Academic journals often have their own guidelines for figures, and reviewers or supervisors may have specific preferences for how maps should look. Regardless of the requirements, you will need to adapt your maps accordingly. It is worth noting that these techniques are not exclusive to maps—they apply to any type of figure. However, we will focus on specific components of a figure that are commonly modified when creating maps. In particular, we will cover how to use pre-made <span class="in">`ggplot2`</span> themes and how to adjust legends and facet strips.</span>
<span id="cb153-1341"><a href="#cb153-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1342"><a href="#cb153-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r total-gw-county}</span></span>
<span id="cb153-1343"><a href="#cb153-1343" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1344"><a href="#cb153-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  gw_by_county &lt;- </span></span>
<span id="cb153-1345"><a href="#cb153-1345" aria-hidden="true" tabindex="-1"></a><span class="in">    sf::st_join(KS_county, gw_KS_sf) %&gt;%</span></span>
<span id="cb153-1346"><a href="#cb153-1346" aria-hidden="true" tabindex="-1"></a><span class="in">    data.table() %&gt;%</span></span>
<span id="cb153-1347"><a href="#cb153-1347" aria-hidden="true" tabindex="-1"></a><span class="in">    .[, .(af_used = sum(af_used, na.rm = TRUE)), by = .(COUNTYFP, year)] %&gt;%</span></span>
<span id="cb153-1348"><a href="#cb153-1348" aria-hidden="true" tabindex="-1"></a><span class="in">    left_join(KS_county, ., by = c("COUNTYFP")) %&gt;%</span></span>
<span id="cb153-1349"><a href="#cb153-1349" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(!is.na(year))</span></span>
<span id="cb153-1350"><a href="#cb153-1350" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1351"><a href="#cb153-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1352"><a href="#cb153-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1353"><a href="#cb153-1353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r base-map-fine}</span></span>
<span id="cb153-1354"><a href="#cb153-1354" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1355"><a href="#cb153-1355" aria-hidden="true" tabindex="-1"></a><span class="in">  g_base &lt;- ggplot() +</span></span>
<span id="cb153-1356"><a href="#cb153-1356" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = gw_by_county, aes(fill = af_used)) +</span></span>
<span id="cb153-1357"><a href="#cb153-1357" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(. ~ year)</span></span>
<span id="cb153-1358"><a href="#cb153-1358" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1359"><a href="#cb153-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1360"><a href="#cb153-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1361"><a href="#cb153-1361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting the theme {#sec-theme}</span></span>
<span id="cb153-1362"><a href="#cb153-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1363"><a href="#cb153-1363" aria-hidden="true" tabindex="-1"></a>Right now, the map shows geographic coordinates, gray background, and grid lines. They are not very aesthetically appealing. Adding the pre-defined theme by <span class="in">`theme_*()`</span> can alter the theme of a map very quickly. One of the themes suitable for maps is <span class="in">`theme_void()`</span>.</span>
<span id="cb153-1364"><a href="#cb153-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1365"><a href="#cb153-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-void}</span></span>
<span id="cb153-1366"><a href="#cb153-1366" aria-hidden="true" tabindex="-1"></a><span class="in">g_base + theme_void()</span></span>
<span id="cb153-1367"><a href="#cb153-1367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1368"><a href="#cb153-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1369"><a href="#cb153-1369" aria-hidden="true" tabindex="-1"></a>As you can see, all the axes information (<span class="in">`axis.title`</span>, <span class="in">`axis.ticks`</span>, <span class="in">`axis.text`</span>,) and panel information (<span class="in">`panel.background`</span>, <span class="in">`panel.border`</span>, <span class="in">`panel.grid`</span>) are gone among other parts of the figure. You can confirm this by evaluating <span class="in">`theme_void()`</span>.</span>
<span id="cb153-1370"><a href="#cb153-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1371"><a href="#cb153-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inside-void}</span></span>
<span id="cb153-1372"><a href="#cb153-1372" aria-hidden="true" tabindex="-1"></a><span class="in">theme_void()</span></span>
<span id="cb153-1373"><a href="#cb153-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1374"><a href="#cb153-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1375"><a href="#cb153-1375" aria-hidden="true" tabindex="-1"></a>Applying the theme to a map obviates the need to suppress parts of a figure individually. You can suppress parts of the figure individually using <span class="in">`theme()`</span>. For example, the following code gets rid of <span class="in">`axis.text`</span>.</span>
<span id="cb153-1376"><a href="#cb153-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1377"><a href="#cb153-1377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r theme-remove-at}</span></span>
<span id="cb153-1378"><a href="#cb153-1378" aria-hidden="true" tabindex="-1"></a><span class="in">g_base + theme(axis.text = element_blank())</span></span>
<span id="cb153-1379"><a href="#cb153-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1380"><a href="#cb153-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1381"><a href="#cb153-1381" aria-hidden="true" tabindex="-1"></a>So, if <span class="in">`theme_void()`</span> is overdoing things, you can build your own theme specifically for maps. For example, this is the theme I used for maps in @sec-demo.</span>
<span id="cb153-1382"><a href="#cb153-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1383"><a href="#cb153-1383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r set-theme}</span></span>
<span id="cb153-1384"><a href="#cb153-1384" aria-hidden="true" tabindex="-1"></a><span class="in">theme_for_map &lt;-</span></span>
<span id="cb153-1385"><a href="#cb153-1385" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1386"><a href="#cb153-1386" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.ticks = element_blank(),</span></span>
<span id="cb153-1387"><a href="#cb153-1387" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.text = element_blank(),</span></span>
<span id="cb153-1388"><a href="#cb153-1388" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.line = element_blank(),</span></span>
<span id="cb153-1389"><a href="#cb153-1389" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.border = element_blank(),</span></span>
<span id="cb153-1390"><a href="#cb153-1390" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.grid = element_line(color = "transparent"),</span></span>
<span id="cb153-1391"><a href="#cb153-1391" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.background = element_blank(),</span></span>
<span id="cb153-1392"><a href="#cb153-1392" aria-hidden="true" tabindex="-1"></a><span class="in">    plot.background = element_rect(fill = "transparent", color = "transparent")</span></span>
<span id="cb153-1393"><a href="#cb153-1393" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1394"><a href="#cb153-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1395"><a href="#cb153-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1396"><a href="#cb153-1396" aria-hidden="true" tabindex="-1"></a>Applying the theme to the map:</span>
<span id="cb153-1397"><a href="#cb153-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1398"><a href="#cb153-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r apply-theme}</span></span>
<span id="cb153-1399"><a href="#cb153-1399" aria-hidden="true" tabindex="-1"></a><span class="in">g_base + theme_for_map</span></span>
<span id="cb153-1400"><a href="#cb153-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1401"><a href="#cb153-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1402"><a href="#cb153-1402" aria-hidden="true" tabindex="-1"></a>This is very similar to <span class="in">`theme_void()`</span> except that <span class="in">`strip.background`</span> is not lost.</span>
<span id="cb153-1403"><a href="#cb153-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1404"><a href="#cb153-1404" aria-hidden="true" tabindex="-1"></a>You can use <span class="in">`theme_void()`</span> as a starting point and override components of it like this.</span>
<span id="cb153-1405"><a href="#cb153-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1406"><a href="#cb153-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r void-correct-theme}</span></span>
<span id="cb153-1407"><a href="#cb153-1407" aria-hidden="true" tabindex="-1"></a><span class="in">#--- bring back a color to strip.background  ---#</span></span>
<span id="cb153-1408"><a href="#cb153-1408" aria-hidden="true" tabindex="-1"></a><span class="in">theme_for_map_2 &lt;- theme_void() + theme(strip.background = element_rect(fill = "gray"))</span></span>
<span id="cb153-1409"><a href="#cb153-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1410"><a href="#cb153-1410" aria-hidden="true" tabindex="-1"></a><span class="in">#--- apply the new theme ---#</span></span>
<span id="cb153-1411"><a href="#cb153-1411" aria-hidden="true" tabindex="-1"></a><span class="in">g_base + theme_for_map_2</span></span>
<span id="cb153-1412"><a href="#cb153-1412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1413"><a href="#cb153-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1414"><a href="#cb153-1414" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-1415"><a href="#cb153-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1416"><a href="#cb153-1416" aria-hidden="true" tabindex="-1"></a><span class="in">`theme_bw()`</span> is also a good theme for maps.</span>
<span id="cb153-1417"><a href="#cb153-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1418"><a href="#cb153-1418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r theme-bw}</span></span>
<span id="cb153-1419"><a href="#cb153-1419" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-1420"><a href="#cb153-1420" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_by_county, aes(fill = af_used)) +</span></span>
<span id="cb153-1421"><a href="#cb153-1421" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year ~ .) +</span></span>
<span id="cb153-1422"><a href="#cb153-1422" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw()</span></span>
<span id="cb153-1423"><a href="#cb153-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1424"><a href="#cb153-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1425"><a href="#cb153-1425" aria-hidden="true" tabindex="-1"></a>If you do not like the gray grid lines, you can remove them like this.</span>
<span id="cb153-1426"><a href="#cb153-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1427"><a href="#cb153-1427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-grid-lines}</span></span>
<span id="cb153-1428"><a href="#cb153-1428" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-1429"><a href="#cb153-1429" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_by_county, aes(fill = af_used)) +</span></span>
<span id="cb153-1430"><a href="#cb153-1430" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year ~ .) +</span></span>
<span id="cb153-1431"><a href="#cb153-1431" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb153-1432"><a href="#cb153-1432" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1433"><a href="#cb153-1433" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.grid = element_line(color = "transparent")</span></span>
<span id="cb153-1434"><a href="#cb153-1434" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1435"><a href="#cb153-1435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1436"><a href="#cb153-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1437"><a href="#cb153-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1438"><a href="#cb153-1438" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-1439"><a href="#cb153-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1440"><a href="#cb153-1440" aria-hidden="true" tabindex="-1"></a>Not all themes are suitable for maps. For example, <span class="in">`theme_classic()`</span> is not a very good option as you can see below:</span>
<span id="cb153-1441"><a href="#cb153-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1442"><a href="#cb153-1442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r theme-classic}</span></span>
<span id="cb153-1443"><a href="#cb153-1443" aria-hidden="true" tabindex="-1"></a><span class="in">g_base + theme_classic()</span></span>
<span id="cb153-1444"><a href="#cb153-1444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1445"><a href="#cb153-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1446"><a href="#cb153-1446" aria-hidden="true" tabindex="-1"></a>If you are not satisfied with <span class="in">`theme_void()`</span> and not willing to make up your own theme, then you may want to take a look at other pre-made themes that are available from <span class="in">`ggplot2`</span> (see <span class="co">[</span><span class="ot">here</span><span class="co">](https://ggplot2.tidyverse.org/reference/ggtheme.html)</span>) and <span class="in">`ggthemes`</span> (see <span class="co">[</span><span class="ot">here</span><span class="co">](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/)</span>). Note that some themes are more invasive than <span class="in">`theme_void()`</span>, altering the default color scale.</span>
<span id="cb153-1447"><a href="#cb153-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1448"><a href="#cb153-1448" aria-hidden="true" tabindex="-1"></a><span class="fu">### Legend</span></span>
<span id="cb153-1449"><a href="#cb153-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1450"><a href="#cb153-1450" aria-hidden="true" tabindex="-1"></a>Legends can be modified using <span class="in">`legend.*()`</span> options for <span class="in">`theme()`</span> and <span class="in">`guide_*()`</span>. It is impossible to discuss every single one of all the options for these functions. So, this section focuses on the most common and useful (that I consider) modifications you can make to legends.</span>
<span id="cb153-1451"><a href="#cb153-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1452"><a href="#cb153-1452" aria-hidden="true" tabindex="-1"></a>A legend consists of three elements: legend title, legend key (e.g., color bar), and legend label (or legend text). For example, in the figure below, <span class="in">`af_used`</span> is the legend title, the color bar is the legend key, and the numbers below the color bar are legend labels. Knowing the name of these elements helps because the name of the options contains the name of the specific part of the legend.</span>
<span id="cb153-1453"><a href="#cb153-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1454"><a href="#cb153-1454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-start}</span></span>
<span id="cb153-1455"><a href="#cb153-1455" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1456"><a href="#cb153-1456" aria-hidden="true" tabindex="-1"></a><span class="in">  g_legend &lt;- </span></span>
<span id="cb153-1457"><a href="#cb153-1457" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-1458"><a href="#cb153-1458" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = gw_by_county, aes(fill = af_used)) +</span></span>
<span id="cb153-1459"><a href="#cb153-1459" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(. ~ year) +</span></span>
<span id="cb153-1460"><a href="#cb153-1460" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void()</span></span>
<span id="cb153-1461"><a href="#cb153-1461" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1462"><a href="#cb153-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1463"><a href="#cb153-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1464"><a href="#cb153-1464" aria-hidden="true" tabindex="-1"></a>Let's first change the color scale to Viridis using <span class="in">`scale_fill_viridis_c()`</span> (see @sec-color-scale for picking a color scale).</span>
<span id="cb153-1465"><a href="#cb153-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1466"><a href="#cb153-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-viridis}</span></span>
<span id="cb153-1467"><a href="#cb153-1467" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1468"><a href="#cb153-1468" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c()</span></span>
<span id="cb153-1469"><a href="#cb153-1469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1470"><a href="#cb153-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1471"><a href="#cb153-1471" aria-hidden="true" tabindex="-1"></a>Right now, the legend title is <span class="in">`af_used`</span>, which does not tell the readers what it means. In general, you can change the title of a legend by using the <span class="in">`name`</span> option inside the <span class="in">`scale`</span> function for the legend (here, <span class="in">`scale_fill_viridis_c()`</span>). So, this one works:</span>
<span id="cb153-1472"><a href="#cb153-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1473"><a href="#cb153-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1474"><a href="#cb153-1474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-title}</span></span>
<span id="cb153-1475"><a href="#cb153-1475" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1476"><a href="#cb153-1476" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c(name = "Groundwater pumping (acre-feet)")</span></span>
<span id="cb153-1477"><a href="#cb153-1477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1478"><a href="#cb153-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1479"><a href="#cb153-1479" aria-hidden="true" tabindex="-1"></a>Alternatively, you can use <span class="in">`labs()`</span> function.^<span class="co">[</span><span class="ot">`labs()` can also be used to specify the x- and y-axis titles.</span><span class="co">]</span>. Since the legend is for the <span class="in">`fill`</span> aesthetic attribute, you should add <span class="in">`fill = "legend title"`</span> as follows:</span>
<span id="cb153-1480"><a href="#cb153-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1481"><a href="#cb153-1481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-fill}</span></span>
<span id="cb153-1482"><a href="#cb153-1482" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1483"><a href="#cb153-1483" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c() +</span></span>
<span id="cb153-1484"><a href="#cb153-1484" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Groundwater pumping (acre-feet)")</span></span>
<span id="cb153-1485"><a href="#cb153-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1486"><a href="#cb153-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1487"><a href="#cb153-1487" aria-hidden="true" tabindex="-1"></a>Since the legend title is long, the legend is taking up about the half of the space of the entire figure. So, let's put the legend below the maps (bottom of the figure) by adding <span class="in">`theme(legend.position = "bottom")`</span>.</span>
<span id="cb153-1488"><a href="#cb153-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1489"><a href="#cb153-1489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-bottom}</span></span>
<span id="cb153-1490"><a href="#cb153-1490" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1491"><a href="#cb153-1491" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c() +</span></span>
<span id="cb153-1492"><a href="#cb153-1492" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1493"><a href="#cb153-1493" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb153-1494"><a href="#cb153-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1495"><a href="#cb153-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1496"><a href="#cb153-1496" aria-hidden="true" tabindex="-1"></a>It would be aesthetically better to have the legend title on top of the color bar. This can be done by using the <span class="in">`guides()`</span> function. Since we would like to alter the aesthetics of the legend for <span class="in">`fill`</span> involving a color bar, we use <span class="in">`fill = guide_colorbar()`</span>. To place the legend title on top, you add <span class="in">`title.position="top"`</span> inside the <span class="in">`guide_colorbar()`</span> function as follows:</span>
<span id="cb153-1497"><a href="#cb153-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1498"><a href="#cb153-1498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-bar-top}</span></span>
<span id="cb153-1499"><a href="#cb153-1499" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1500"><a href="#cb153-1500" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c() +</span></span>
<span id="cb153-1501"><a href="#cb153-1501" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1502"><a href="#cb153-1502" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom") +</span></span>
<span id="cb153-1503"><a href="#cb153-1503" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_colorbar(title.position = "top"))</span></span>
<span id="cb153-1504"><a href="#cb153-1504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1505"><a href="#cb153-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1506"><a href="#cb153-1506" aria-hidden="true" tabindex="-1"></a>This looks better. But, the legend labels are too close to each other so it is hard to read them because the color bar is too short. Let's elongate the color bar so that we have enough space between legend labels using <span class="in">`legend.key.width = `</span> option for <span class="in">`theme()`</span>. Let's also make the legend thinner using <span class="in">`legend.key.height = `</span> option.</span>
<span id="cb153-1507"><a href="#cb153-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1508"><a href="#cb153-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-key}</span></span>
<span id="cb153-1509"><a href="#cb153-1509" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1510"><a href="#cb153-1510" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c() +</span></span>
<span id="cb153-1511"><a href="#cb153-1511" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1512"><a href="#cb153-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1513"><a href="#cb153-1513" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "bottom",</span></span>
<span id="cb153-1514"><a href="#cb153-1514" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- NEW LINES HERE!! ---#</span></span>
<span id="cb153-1515"><a href="#cb153-1515" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.height = unit(0.5, "cm"),</span></span>
<span id="cb153-1516"><a href="#cb153-1516" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.width = unit(2, "cm")</span></span>
<span id="cb153-1517"><a href="#cb153-1517" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1518"><a href="#cb153-1518" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_colorbar(title.position = "top"))</span></span>
<span id="cb153-1519"><a href="#cb153-1519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1520"><a href="#cb153-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1521"><a href="#cb153-1521" aria-hidden="true" tabindex="-1"></a>If the journal you are submitting an article to is requesting a specific font family for the texts in the figure, you can use <span class="in">`legend.text = element_text()`</span> and <span class="in">`legend.title = element_text()`</span> inside <span class="in">`theme()`</span> for the legend labels and legend title, respectively. The following code uses the font family of "Times" and font size of 12 for both the labels and the title.</span>
<span id="cb153-1522"><a href="#cb153-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1523"><a href="#cb153-1523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-text-font}</span></span>
<span id="cb153-1524"><a href="#cb153-1524" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend +</span></span>
<span id="cb153-1525"><a href="#cb153-1525" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c() +</span></span>
<span id="cb153-1526"><a href="#cb153-1526" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1527"><a href="#cb153-1527" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1528"><a href="#cb153-1528" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "bottom",</span></span>
<span id="cb153-1529"><a href="#cb153-1529" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.height = unit(0.5, "cm"),</span></span>
<span id="cb153-1530"><a href="#cb153-1530" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.width = unit(2, "cm"),</span></span>
<span id="cb153-1531"><a href="#cb153-1531" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.text = element_text(size = 12, family = "Times"),</span></span>
<span id="cb153-1532"><a href="#cb153-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.title = element_text(size = 12, family = "Times")</span></span>
<span id="cb153-1533"><a href="#cb153-1533" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- NEW LINES HERE!! ---#</span></span>
<span id="cb153-1534"><a href="#cb153-1534" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1535"><a href="#cb153-1535" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_colorbar(title.position = "top"))</span></span>
<span id="cb153-1536"><a href="#cb153-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1537"><a href="#cb153-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1538"><a href="#cb153-1538" aria-hidden="true" tabindex="-1"></a>For the other options to control the legend with a color bar, see <span class="co">[</span><span class="ot">here</span><span class="co">](https://ggplot2.tidyverse.org/reference/guide_colorbar.html)</span>.</span>
<span id="cb153-1539"><a href="#cb153-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1540"><a href="#cb153-1540" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb153-1541"><a href="#cb153-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1542"><a href="#cb153-1542" aria-hidden="true" tabindex="-1"></a>When the legend is made for discrete values, you can use <span class="in">`guide_legend()`</span>. Let's use the following map as a starting point.</span>
<span id="cb153-1543"><a href="#cb153-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1544"><a href="#cb153-1544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r make-gw_stevens, eval = F}</span></span>
<span id="cb153-1545"><a href="#cb153-1545" aria-hidden="true" tabindex="-1"></a><span class="in">#--- convert af_used to a discrete variable ---#</span></span>
<span id="cb153-1546"><a href="#cb153-1546" aria-hidden="true" tabindex="-1"></a><span class="in">gw_Stevens &lt;- dplyr::mutate(gw_Stevens, af_used_cat = cut_number(af_used, n = 5))</span></span>
<span id="cb153-1547"><a href="#cb153-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1548"><a href="#cb153-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1549"><a href="#cb153-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tmax-viridis-D-discrete-guide}</span></span>
<span id="cb153-1550"><a href="#cb153-1550" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1551"><a href="#cb153-1551" aria-hidden="true" tabindex="-1"></a><span class="in">  g_legend_2 &lt;-</span></span>
<span id="cb153-1552"><a href="#cb153-1552" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = gw_Stevens) +</span></span>
<span id="cb153-1553"><a href="#cb153-1553" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(aes(color = af_used_cat), size = 2) +</span></span>
<span id="cb153-1554"><a href="#cb153-1554" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_color_viridis(discrete = TRUE, option = "C") +</span></span>
<span id="cb153-1555"><a href="#cb153-1555" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(color = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1556"><a href="#cb153-1556" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void() +</span></span>
<span id="cb153-1557"><a href="#cb153-1557" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "bottom")</span></span>
<span id="cb153-1558"><a href="#cb153-1558" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1559"><a href="#cb153-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1560"><a href="#cb153-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1561"><a href="#cb153-1561" aria-hidden="true" tabindex="-1"></a>The legend is too long, so first put the legend title on top of the legend labels using the code below:</span>
<span id="cb153-1562"><a href="#cb153-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1563"><a href="#cb153-1563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-title-top-again}</span></span>
<span id="cb153-1564"><a href="#cb153-1564" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend_2 +</span></span>
<span id="cb153-1565"><a href="#cb153-1565" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(</span></span>
<span id="cb153-1566"><a href="#cb153-1566" aria-hidden="true" tabindex="-1"></a><span class="in">    color = guide_legend(title.position = "top")</span></span>
<span id="cb153-1567"><a href="#cb153-1567" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1568"><a href="#cb153-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1569"><a href="#cb153-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1570"><a href="#cb153-1570" aria-hidden="true" tabindex="-1"></a>Since the legend is for the <span class="in">`color`</span> aesthetic attribute, <span class="in">`color = guide_legend()`</span> was used. The legend labels are still a bit too long, so let's arrange them in two rows using the <span class="in">`nrow = `</span> option.</span>
<span id="cb153-1571"><a href="#cb153-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1572"><a href="#cb153-1572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lg-title-row}</span></span>
<span id="cb153-1573"><a href="#cb153-1573" aria-hidden="true" tabindex="-1"></a><span class="in">g_legend_2 +</span></span>
<span id="cb153-1574"><a href="#cb153-1574" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(</span></span>
<span id="cb153-1575"><a href="#cb153-1575" aria-hidden="true" tabindex="-1"></a><span class="in">    color = guide_legend(title.position = "top", nrow = 2)</span></span>
<span id="cb153-1576"><a href="#cb153-1576" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1577"><a href="#cb153-1577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1578"><a href="#cb153-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1579"><a href="#cb153-1579" aria-hidden="true" tabindex="-1"></a>For the other options for <span class="in">`guide_legend()`</span>, see <span class="co">[</span><span class="ot">here</span><span class="co">](https://ggplot2.tidyverse.org/reference/guide_legend.html)</span>.</span>
<span id="cb153-1580"><a href="#cb153-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1581"><a href="#cb153-1581" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb153-1582"><a href="#cb153-1582" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-1583"><a href="#cb153-1583" aria-hidden="true" tabindex="-1"></a><span class="co">#' # Saving a `ggplot` object as an image</span></span>
<span id="cb153-1584"><a href="#cb153-1584" aria-hidden="true" tabindex="-1"></a><span class="co">#/*=================================================*/</span></span>
<span id="cb153-1585"><a href="#cb153-1585" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb153-1586"><a href="#cb153-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1587"><a href="#cb153-1587" aria-hidden="true" tabindex="-1"></a><span class="fu">### Facet strips</span></span>
<span id="cb153-1588"><a href="#cb153-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1589"><a href="#cb153-1589" aria-hidden="true" tabindex="-1"></a>Facet strips refer to the area of boxed where the values of faceting variables are printed. In the figure below, it's gray strips on top of the maps. You can change how they look using <span class="in">`strip.*`</span> options in <span class="in">`theme()`</span> and also partially inside <span class="in">`facet_wrap()`</span> and <span class="in">`facet_grid()`</span>. Here is the list of available options:</span>
<span id="cb153-1590"><a href="#cb153-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1591"><a href="#cb153-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`strip.background`</span>, <span class="in">`strip.background.x`</span>, <span class="in">`strip.background.y`</span></span>
<span id="cb153-1592"><a href="#cb153-1592" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`strip.placement`</span></span>
<span id="cb153-1593"><a href="#cb153-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`strip.text`</span>, <span class="in">`strip.text.x`</span>, <span class="in">`strip.text.y`</span></span>
<span id="cb153-1594"><a href="#cb153-1594" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`strip.switch.pad.grid`</span></span>
<span id="cb153-1595"><a href="#cb153-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span><span class="in">`strip.switch.pad.wrap`</span></span>
<span id="cb153-1596"><a href="#cb153-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1597"><a href="#cb153-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1598"><a href="#cb153-1598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-wrap}</span></span>
<span id="cb153-1599"><a href="#cb153-1599" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb153-1600"><a href="#cb153-1600" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-1601"><a href="#cb153-1601" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-1602"><a href="#cb153-1602" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-1603"><a href="#cb153-1603" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-1604"><a href="#cb153-1604" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-1605"><a href="#cb153-1605" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap((af_used &gt; 500) ~ year) +</span></span>
<span id="cb153-1606"><a href="#cb153-1606" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-1607"><a href="#cb153-1607" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_c() +</span></span>
<span id="cb153-1608"><a href="#cb153-1608" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb153-1609"><a href="#cb153-1609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1610"><a href="#cb153-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1611"><a href="#cb153-1611" aria-hidden="true" tabindex="-1"></a>To make texts in the strips more descriptive of what they actually mean you can make variable that have texts you want to show on the map as their values.</span>
<span id="cb153-1612"><a href="#cb153-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1613"><a href="#cb153-1613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = F}</span></span>
<span id="cb153-1614"><a href="#cb153-1614" aria-hidden="true" tabindex="-1"></a><span class="in"># gw_KS_sf &lt;-</span></span>
<span id="cb153-1615"><a href="#cb153-1615" aria-hidden="true" tabindex="-1"></a><span class="in">#   gw_KS_sf %&gt;%</span></span>
<span id="cb153-1616"><a href="#cb153-1616" aria-hidden="true" tabindex="-1"></a><span class="in">#   mutate(</span></span>
<span id="cb153-1617"><a href="#cb153-1617" aria-hidden="true" tabindex="-1"></a><span class="in">#     high_low = ifelse(af_used &gt; 500, "High water use", "Low water use"),</span></span>
<span id="cb153-1618"><a href="#cb153-1618" aria-hidden="true" tabindex="-1"></a><span class="in">#     year_txt = paste("Year: ", year)</span></span>
<span id="cb153-1619"><a href="#cb153-1619" aria-hidden="true" tabindex="-1"></a><span class="in">#   )</span></span>
<span id="cb153-1620"><a href="#cb153-1620" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb153-1621"><a href="#cb153-1621" aria-hidden="true" tabindex="-1"></a><span class="in"># saveRDS(gw_KS_sf, "Data/gw_KS_sf_with_text.rds")</span></span>
<span id="cb153-1622"><a href="#cb153-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1623"><a href="#cb153-1623" aria-hidden="true" tabindex="-1"></a><span class="in">gw_KS_sf &lt;- readRDS("Data/gw_KS_sf_with_text.rds")</span></span>
<span id="cb153-1624"><a href="#cb153-1624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1625"><a href="#cb153-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1626"><a href="#cb153-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-text-change-echo, eval = F}</span></span>
<span id="cb153-1627"><a href="#cb153-1627" aria-hidden="true" tabindex="-1"></a><span class="in">gw_KS_sf &lt;-</span></span>
<span id="cb153-1628"><a href="#cb153-1628" aria-hidden="true" tabindex="-1"></a><span class="in">  gw_KS_sf %&gt;%</span></span>
<span id="cb153-1629"><a href="#cb153-1629" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb153-1630"><a href="#cb153-1630" aria-hidden="true" tabindex="-1"></a><span class="in">    high_low = ifelse(af_used &gt; 500, "High water use", "Low water use"),</span></span>
<span id="cb153-1631"><a href="#cb153-1631" aria-hidden="true" tabindex="-1"></a><span class="in">    year_txt = paste("Year: ", year)</span></span>
<span id="cb153-1632"><a href="#cb153-1632" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1633"><a href="#cb153-1633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1634"><a href="#cb153-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1635"><a href="#cb153-1635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-text-change-show}</span></span>
<span id="cb153-1636"><a href="#cb153-1636" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1637"><a href="#cb153-1637" aria-hidden="true" tabindex="-1"></a><span class="in">  g_facet &lt;-</span></span>
<span id="cb153-1638"><a href="#cb153-1638" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb153-1639"><a href="#cb153-1639" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- KS county boundary ---#</span></span>
<span id="cb153-1640"><a href="#cb153-1640" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-1641"><a href="#cb153-1641" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- wells ---#</span></span>
<span id="cb153-1642"><a href="#cb153-1642" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-1643"><a href="#cb153-1643" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- facet by year (side by side) ---#</span></span>
<span id="cb153-1644"><a href="#cb153-1644" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(high_low ~ year_txt) +</span></span>
<span id="cb153-1645"><a href="#cb153-1645" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void() +</span></span>
<span id="cb153-1646"><a href="#cb153-1646" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_color_viridis_c() +</span></span>
<span id="cb153-1647"><a href="#cb153-1647" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "bottom")</span></span>
<span id="cb153-1648"><a href="#cb153-1648" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1649"><a href="#cb153-1649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1650"><a href="#cb153-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1651"><a href="#cb153-1651" aria-hidden="true" tabindex="-1"></a>You probably noticed that the high water use cases are now appear on top. This is because the panels of figures are arranged in a way that the strip texts are alphabetically ordered. <span class="in">`High water use`</span> precedes <span class="in">`Low water use`</span>. Sometimes, this is not desirable. To force a specific order, you can turn the faceting variable (here <span class="in">`high_low`</span>) into a <span class="in">`factor`</span> with the order of its values defined using <span class="in">`levels =`</span>. The following code converts <span class="in">`high_low`</span> into a factor where "Low water use" is the first level and "High water use" is the second level.</span>
<span id="cb153-1652"><a href="#cb153-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1653"><a href="#cb153-1653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = F}</span></span>
<span id="cb153-1654"><a href="#cb153-1654" aria-hidden="true" tabindex="-1"></a><span class="in"># gw_KS_sf &lt;- </span></span>
<span id="cb153-1655"><a href="#cb153-1655" aria-hidden="true" tabindex="-1"></a><span class="in">#   mutate(</span></span>
<span id="cb153-1656"><a href="#cb153-1656" aria-hidden="true" tabindex="-1"></a><span class="in">#     gw_KS_sf, </span></span>
<span id="cb153-1657"><a href="#cb153-1657" aria-hidden="true" tabindex="-1"></a><span class="in">#     high_low = factor(</span></span>
<span id="cb153-1658"><a href="#cb153-1658" aria-hidden="true" tabindex="-1"></a><span class="in">#       high_low, </span></span>
<span id="cb153-1659"><a href="#cb153-1659" aria-hidden="true" tabindex="-1"></a><span class="in">#       levels = c("Low water use", "High water use")</span></span>
<span id="cb153-1660"><a href="#cb153-1660" aria-hidden="true" tabindex="-1"></a><span class="in">#     )</span></span>
<span id="cb153-1661"><a href="#cb153-1661" aria-hidden="true" tabindex="-1"></a><span class="in">#   )</span></span>
<span id="cb153-1662"><a href="#cb153-1662" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb153-1663"><a href="#cb153-1663" aria-hidden="true" tabindex="-1"></a><span class="in"># saveRDS(gw_KS_sf, "Data/gw_KS_sf_factor.rds")</span></span>
<span id="cb153-1664"><a href="#cb153-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1665"><a href="#cb153-1665" aria-hidden="true" tabindex="-1"></a><span class="in">gw_KS_sf &lt;- readRDS("Data/gw_KS_sf_factor.rds")</span></span>
<span id="cb153-1666"><a href="#cb153-1666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1667"><a href="#cb153-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1668"><a href="#cb153-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r factor-levels-order, eval = F}</span></span>
<span id="cb153-1669"><a href="#cb153-1669" aria-hidden="true" tabindex="-1"></a><span class="in">gw_KS_sf &lt;-</span></span>
<span id="cb153-1670"><a href="#cb153-1670" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb153-1671"><a href="#cb153-1671" aria-hidden="true" tabindex="-1"></a><span class="in">    gw_KS_sf,</span></span>
<span id="cb153-1672"><a href="#cb153-1672" aria-hidden="true" tabindex="-1"></a><span class="in">    high_low = factor(</span></span>
<span id="cb153-1673"><a href="#cb153-1673" aria-hidden="true" tabindex="-1"></a><span class="in">      high_low,</span></span>
<span id="cb153-1674"><a href="#cb153-1674" aria-hidden="true" tabindex="-1"></a><span class="in">      levels = c("Low water use", "High water use")</span></span>
<span id="cb153-1675"><a href="#cb153-1675" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb153-1676"><a href="#cb153-1676" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1677"><a href="#cb153-1677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1678"><a href="#cb153-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1679"><a href="#cb153-1679" aria-hidden="true" tabindex="-1"></a>Now, "Low water use" cases appear first (on top).</span>
<span id="cb153-1680"><a href="#cb153-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1681"><a href="#cb153-1681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-order-change}</span></span>
<span id="cb153-1682"><a href="#cb153-1682" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet &lt;- </span></span>
<span id="cb153-1683"><a href="#cb153-1683" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb153-1684"><a href="#cb153-1684" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- KS county boundary ---#</span></span>
<span id="cb153-1685"><a href="#cb153-1685" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = sf::st_transform(KS_county, 32614)) +</span></span>
<span id="cb153-1686"><a href="#cb153-1686" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- wells ---#</span></span>
<span id="cb153-1687"><a href="#cb153-1687" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = gw_KS_sf, aes(color = af_used)) +</span></span>
<span id="cb153-1688"><a href="#cb153-1688" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- facet by year (side by side) ---#</span></span>
<span id="cb153-1689"><a href="#cb153-1689" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(high_low ~ year_txt) +</span></span>
<span id="cb153-1690"><a href="#cb153-1690" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb153-1691"><a href="#cb153-1691" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_c() +</span></span>
<span id="cb153-1692"><a href="#cb153-1692" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb153-1693"><a href="#cb153-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1694"><a href="#cb153-1694" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet</span></span>
<span id="cb153-1695"><a href="#cb153-1695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1696"><a href="#cb153-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1697"><a href="#cb153-1697" aria-hidden="true" tabindex="-1"></a>You can control how strip texts and strip boxes appear using <span class="in">`strip.text`</span> and <span class="in">`strip.background`</span> options. Here is an example:</span>
<span id="cb153-1698"><a href="#cb153-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1699"><a href="#cb153-1699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-strip-background}</span></span>
<span id="cb153-1700"><a href="#cb153-1700" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet + </span></span>
<span id="cb153-1701"><a href="#cb153-1701" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1702"><a href="#cb153-1702" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.x = element_text(size = 12, family = "Times", color = "blue"),</span></span>
<span id="cb153-1703"><a href="#cb153-1703" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.background = element_rect(fill = "red", color = "black")</span></span>
<span id="cb153-1704"><a href="#cb153-1704" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1705"><a href="#cb153-1705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1706"><a href="#cb153-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1707"><a href="#cb153-1707" aria-hidden="true" tabindex="-1"></a>Instead of having descriptions of cases on top of the figures, you could have one of the descriptions on the right side of the figures using <span class="in">`facet_grid()`</span>.</span>
<span id="cb153-1708"><a href="#cb153-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1709"><a href="#cb153-1709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-right}</span></span>
<span id="cb153-1710"><a href="#cb153-1710" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1711"><a href="#cb153-1711" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_wrap(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1712"><a href="#cb153-1712" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(high_low ~ year_txt)</span></span>
<span id="cb153-1713"><a href="#cb153-1713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1714"><a href="#cb153-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1715"><a href="#cb153-1715" aria-hidden="true" tabindex="-1"></a>Now case descriptions for <span class="in">`high_low`</span> are too long and it is squeezing the space for maps. Let's flip <span class="in">`high_low`</span> and <span class="in">`year`</span>.</span>
<span id="cb153-1716"><a href="#cb153-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1717"><a href="#cb153-1717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r facet-right-left}</span></span>
<span id="cb153-1718"><a href="#cb153-1718" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1719"><a href="#cb153-1719" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1720"><a href="#cb153-1720" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low)</span></span>
<span id="cb153-1721"><a href="#cb153-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1722"><a href="#cb153-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1723"><a href="#cb153-1723" aria-hidden="true" tabindex="-1"></a>This is slightly better than before, but not much. Let's rotate strip texts for <span class="in">`year`</span> using the <span class="in">`angle = `</span> option.</span>
<span id="cb153-1724"><a href="#cb153-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1725"><a href="#cb153-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r angle}</span></span>
<span id="cb153-1726"><a href="#cb153-1726" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1727"><a href="#cb153-1727" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1728"><a href="#cb153-1728" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low) +</span></span>
<span id="cb153-1729"><a href="#cb153-1729" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1730"><a href="#cb153-1730" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.y = element_text(angle = -90)</span></span>
<span id="cb153-1731"><a href="#cb153-1731" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1732"><a href="#cb153-1732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1733"><a href="#cb153-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1734"><a href="#cb153-1734" aria-hidden="true" tabindex="-1"></a>Since we only want to change the angle of strip texts for the second faceting variable, we need to work on <span class="in">`strip.text.y`</span> (if you want to work on the first one, you use <span class="in">`strip.text.x`</span>.).</span>
<span id="cb153-1735"><a href="#cb153-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1736"><a href="#cb153-1736" aria-hidden="true" tabindex="-1"></a>Let's change the size of the strip texts to 12 and use <span class="in">`Times`</span> font family.</span>
<span id="cb153-1737"><a href="#cb153-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1738"><a href="#cb153-1738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r font-times}</span></span>
<span id="cb153-1739"><a href="#cb153-1739" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1740"><a href="#cb153-1740" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1741"><a href="#cb153-1741" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low) +</span></span>
<span id="cb153-1742"><a href="#cb153-1742" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1743"><a href="#cb153-1743" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.y = element_text(angle = -90, size = 12, family = "Times"),</span></span>
<span id="cb153-1744"><a href="#cb153-1744" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- moves up the strip texts ---#</span></span>
<span id="cb153-1745"><a href="#cb153-1745" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.x = element_text(size = 12, family = "Times")</span></span>
<span id="cb153-1746"><a href="#cb153-1746" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1747"><a href="#cb153-1747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1748"><a href="#cb153-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1749"><a href="#cb153-1749" aria-hidden="true" tabindex="-1"></a>The strip texts for <span class="in">`high_low`</span> are too close to maps that letter "g" in "High" is truncated. Let's move them up.</span>
<span id="cb153-1750"><a href="#cb153-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1751"><a href="#cb153-1751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r move-g}</span></span>
<span id="cb153-1752"><a href="#cb153-1752" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1753"><a href="#cb153-1753" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1754"><a href="#cb153-1754" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low) +</span></span>
<span id="cb153-1755"><a href="#cb153-1755" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1756"><a href="#cb153-1756" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.y = element_text(angle = -90, size = 12, family = "Times"),</span></span>
<span id="cb153-1757"><a href="#cb153-1757" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- moves up the strip texts ---#</span></span>
<span id="cb153-1758"><a href="#cb153-1758" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.x = element_text(vjust = 2, size = 12, family = "Times")</span></span>
<span id="cb153-1759"><a href="#cb153-1759" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1760"><a href="#cb153-1760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1761"><a href="#cb153-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1762"><a href="#cb153-1762" aria-hidden="true" tabindex="-1"></a>Now the upper part of the letters is truncated. We could just put more margin below the texts using the <span class="in">`margin = margin(top, right, bottom, left, unit in text)`</span> option.</span>
<span id="cb153-1763"><a href="#cb153-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1764"><a href="#cb153-1764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r more-margin}</span></span>
<span id="cb153-1765"><a href="#cb153-1765" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1766"><a href="#cb153-1766" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1767"><a href="#cb153-1767" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low) +</span></span>
<span id="cb153-1768"><a href="#cb153-1768" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1769"><a href="#cb153-1769" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.y = element_text(angle = -90, size = 12, family = "Times"),</span></span>
<span id="cb153-1770"><a href="#cb153-1770" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.x = element_text(margin = margin(0, 0, 0.2, 0, "cm"), size = 12, family = "Times")</span></span>
<span id="cb153-1771"><a href="#cb153-1771" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1772"><a href="#cb153-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1773"><a href="#cb153-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1774"><a href="#cb153-1774" aria-hidden="true" tabindex="-1"></a>For completeness, let's make the legend look better as well (this is discussed in @sec-theme).</span>
<span id="cb153-1775"><a href="#cb153-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1776"><a href="#cb153-1776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r make-legend-look-better}</span></span>
<span id="cb153-1777"><a href="#cb153-1777" aria-hidden="true" tabindex="-1"></a><span class="in">g_facet +</span></span>
<span id="cb153-1778"><a href="#cb153-1778" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- this overrides facet_grid(high_low ~ year_txt) ---#</span></span>
<span id="cb153-1779"><a href="#cb153-1779" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(year_txt ~ high_low) +</span></span>
<span id="cb153-1780"><a href="#cb153-1780" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1781"><a href="#cb153-1781" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.y = element_text(angle = -90, size = 12, family = "Times"),</span></span>
<span id="cb153-1782"><a href="#cb153-1782" aria-hidden="true" tabindex="-1"></a><span class="in">    strip.text.x = element_text(margin = margin(0, 0, 0.2, 0, "cm"), size = 12, family = "Times")</span></span>
<span id="cb153-1783"><a href="#cb153-1783" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1784"><a href="#cb153-1784" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom") +</span></span>
<span id="cb153-1785"><a href="#cb153-1785" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(color = "Groundwater pumping (acre-feet)") +</span></span>
<span id="cb153-1786"><a href="#cb153-1786" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb153-1787"><a href="#cb153-1787" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "bottom",</span></span>
<span id="cb153-1788"><a href="#cb153-1788" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.height = unit(0.5, "cm"),</span></span>
<span id="cb153-1789"><a href="#cb153-1789" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.key.width = unit(2, "cm"),</span></span>
<span id="cb153-1790"><a href="#cb153-1790" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.text = element_text(size = 12, family = "Times"),</span></span>
<span id="cb153-1791"><a href="#cb153-1791" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.title = element_text(size = 12, family = "Times")</span></span>
<span id="cb153-1792"><a href="#cb153-1792" aria-hidden="true" tabindex="-1"></a><span class="in">    #--- NEW LINES HERE!! ---#</span></span>
<span id="cb153-1793"><a href="#cb153-1793" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1794"><a href="#cb153-1794" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_colorbar(title.position = "top"))</span></span>
<span id="cb153-1795"><a href="#cb153-1795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1796"><a href="#cb153-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1797"><a href="#cb153-1797" aria-hidden="true" tabindex="-1"></a>Alright, setting aside the problem of whether the information provided in the maps is meaningful or not, the maps look great at least.</span>
<span id="cb153-1798"><a href="#cb153-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1799"><a href="#cb153-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">### North arrow and scale bar</span></span>
<span id="cb153-1800"><a href="#cb153-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1801"><a href="#cb153-1801" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ggspatial`</span> package lets you put a north arrow and scale bar on a map using <span class="in">`annotation_scale()`</span> and <span class="in">`annotation_north_arrow()`</span>.</span>
<span id="cb153-1802"><a href="#cb153-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1803"><a href="#cb153-1803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nc-read-map}</span></span>
<span id="cb153-1804"><a href="#cb153-1804" aria-hidden="true" tabindex="-1"></a><span class="in">#--- get North Carolina county borders ---#</span></span>
<span id="cb153-1805"><a href="#cb153-1805" aria-hidden="true" tabindex="-1"></a><span class="in">nc &lt;- st_read(system.file("shape/nc.shp", package = "sf"))</span></span>
<span id="cb153-1806"><a href="#cb153-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1807"><a href="#cb153-1807" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1808"><a href="#cb153-1808" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- create a simple map ---#</span></span>
<span id="cb153-1809"><a href="#cb153-1809" aria-hidden="true" tabindex="-1"></a><span class="in">  g_nc &lt;- ggplot(nc) +</span></span>
<span id="cb153-1810"><a href="#cb153-1810" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf() +</span></span>
<span id="cb153-1811"><a href="#cb153-1811" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void()</span></span>
<span id="cb153-1812"><a href="#cb153-1812" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1813"><a href="#cb153-1813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1814"><a href="#cb153-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1815"><a href="#cb153-1815" aria-hidden="true" tabindex="-1"></a>Here is an example code that adds a scale bar:</span>
<span id="cb153-1816"><a href="#cb153-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1817"><a href="#cb153-1817" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-1818"><a href="#cb153-1818" aria-hidden="true" tabindex="-1"></a><span class="in">#--- load ggspatial ---#</span></span>
<span id="cb153-1819"><a href="#cb153-1819" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggspatial)</span></span>
<span id="cb153-1820"><a href="#cb153-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1821"><a href="#cb153-1821" aria-hidden="true" tabindex="-1"></a><span class="in">#--- add scale bar ---#</span></span>
<span id="cb153-1822"><a href="#cb153-1822" aria-hidden="true" tabindex="-1"></a><span class="in">g_nc +</span></span>
<span id="cb153-1823"><a href="#cb153-1823" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(</span></span>
<span id="cb153-1824"><a href="#cb153-1824" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "bl",</span></span>
<span id="cb153-1825"><a href="#cb153-1825" aria-hidden="true" tabindex="-1"></a><span class="in">    width_hint = 0.2</span></span>
<span id="cb153-1826"><a href="#cb153-1826" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1827"><a href="#cb153-1827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1828"><a href="#cb153-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1829"><a href="#cb153-1829" aria-hidden="true" tabindex="-1"></a><span class="in">`location`</span> determines where the scale bar is. The first letter is either <span class="in">`t`</span> (top) or <span class="in">`b`</span> (bottom), and the second letter is either <span class="in">`l (left)`</span> or <span class="in">`r`</span> (right). <span class="in">`width_hint`</span> is the length of the scale bar relative to the plot. The distance number (200 km) was generated automatically according to the length of the bar.</span>
<span id="cb153-1830"><a href="#cb153-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1831"><a href="#cb153-1831" aria-hidden="true" tabindex="-1"></a>You can add pads from the plot border to fine tune the location of the scale bar:</span>
<span id="cb153-1832"><a href="#cb153-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1833"><a href="#cb153-1833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-pads}</span></span>
<span id="cb153-1834"><a href="#cb153-1834" aria-hidden="true" tabindex="-1"></a><span class="in">g_nc +</span></span>
<span id="cb153-1835"><a href="#cb153-1835" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(</span></span>
<span id="cb153-1836"><a href="#cb153-1836" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "bl",</span></span>
<span id="cb153-1837"><a href="#cb153-1837" aria-hidden="true" tabindex="-1"></a><span class="in">    width_hint = 0.2,</span></span>
<span id="cb153-1838"><a href="#cb153-1838" aria-hidden="true" tabindex="-1"></a><span class="in">    pad_x = unit(3, "cm"),</span></span>
<span id="cb153-1839"><a href="#cb153-1839" aria-hidden="true" tabindex="-1"></a><span class="in">    pad_y = unit(2, "cm")</span></span>
<span id="cb153-1840"><a href="#cb153-1840" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1841"><a href="#cb153-1841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1842"><a href="#cb153-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1843"><a href="#cb153-1843" aria-hidden="true" tabindex="-1"></a>A positive number means that the scale bar will be placed further away from closest border of the plot.</span>
<span id="cb153-1844"><a href="#cb153-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1845"><a href="#cb153-1845" aria-hidden="true" tabindex="-1"></a>You can add a north arrow using <span class="in">`annotation_north_arrow()`</span>. Accepted arguments are similar to those for <span class="in">`annotation_scale()`</span>.</span>
<span id="cb153-1846"><a href="#cb153-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1847"><a href="#cb153-1847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-north-arrow}</span></span>
<span id="cb153-1848"><a href="#cb153-1848" aria-hidden="true" tabindex="-1"></a><span class="in">g_nc +</span></span>
<span id="cb153-1849"><a href="#cb153-1849" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(</span></span>
<span id="cb153-1850"><a href="#cb153-1850" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "bl",</span></span>
<span id="cb153-1851"><a href="#cb153-1851" aria-hidden="true" tabindex="-1"></a><span class="in">    width_hint = 0.2,</span></span>
<span id="cb153-1852"><a href="#cb153-1852" aria-hidden="true" tabindex="-1"></a><span class="in">    pad_x = unit(3, "cm")</span></span>
<span id="cb153-1853"><a href="#cb153-1853" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb153-1854"><a href="#cb153-1854" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- add north arrow ---#</span></span>
<span id="cb153-1855"><a href="#cb153-1855" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_north_arrow(</span></span>
<span id="cb153-1856"><a href="#cb153-1856" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "tl",</span></span>
<span id="cb153-1857"><a href="#cb153-1857" aria-hidden="true" tabindex="-1"></a><span class="in">    pad_x = unit(0.5, "in"),</span></span>
<span id="cb153-1858"><a href="#cb153-1858" aria-hidden="true" tabindex="-1"></a><span class="in">    pad_y = unit(0.1, "in"),</span></span>
<span id="cb153-1859"><a href="#cb153-1859" aria-hidden="true" tabindex="-1"></a><span class="in">    style = north_arrow_fancy_orienteering</span></span>
<span id="cb153-1860"><a href="#cb153-1860" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb153-1861"><a href="#cb153-1861" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1862"><a href="#cb153-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1863"><a href="#cb153-1863" aria-hidden="true" tabindex="-1"></a>There are several <span class="in">`style`</span>s you can pick from. Run <span class="in">`?north_arrow_orienteering`</span> to see other options.</span>
<span id="cb153-1864"><a href="#cb153-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1865"><a href="#cb153-1865" aria-hidden="true" tabindex="-1"></a><span class="fu">## Saving a `ggplot` object as an image {#sec-ggsave}</span></span>
<span id="cb153-1866"><a href="#cb153-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1867"><a href="#cb153-1867" aria-hidden="true" tabindex="-1"></a>Maps created with <span class="in">`ggplot2`</span> can be saved using <span class="in">`ggsave()`</span> with the following syntax:</span>
<span id="cb153-1868"><a href="#cb153-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1869"><a href="#cb153-1869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-1870"><a href="#cb153-1870" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave(filename = file name, plot = ggplot object)</span></span>
<span id="cb153-1871"><a href="#cb153-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1872"><a href="#cb153-1872" aria-hidden="true" tabindex="-1"></a><span class="in">#--- or just this ---#</span></span>
<span id="cb153-1873"><a href="#cb153-1873" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave(file name, ggplot object)</span></span>
<span id="cb153-1874"><a href="#cb153-1874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1875"><a href="#cb153-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1876"><a href="#cb153-1876" aria-hidden="true" tabindex="-1"></a>Many different file formats are supported including pdf, svg, eps, png, jpg, tif, etc. One thing you want to keep in mind is the type of graphics:</span>
<span id="cb153-1877"><a href="#cb153-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1878"><a href="#cb153-1878" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>vector graphics (pdf, svg, eps)</span>
<span id="cb153-1879"><a href="#cb153-1879" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>raster graphics (jpg, png, tif)</span>
<span id="cb153-1880"><a href="#cb153-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1881"><a href="#cb153-1881" aria-hidden="true" tabindex="-1"></a>While vector graphics are scalable, raster graphics are not. If you enlarge raster graphics, the cells making up the figure become visible, making the figure unappealing. So, unless it is required to save figures as raster graphics, it is encouraged to save figures as vector graphics.</span>
<span id="cb153-1882"><a href="#cb153-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1883"><a href="#cb153-1883" aria-hidden="true" tabindex="-1"></a>Let's try to save the following <span class="in">`ggplot`</span> object.</span>
<span id="cb153-1884"><a href="#cb153-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1885"><a href="#cb153-1885" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb153-1886"><a href="#cb153-1886" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-make-g-nc-to-save</span></span>
<span id="cb153-1887"><a href="#cb153-1887" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Map to save"</span></span>
<span id="cb153-1888"><a href="#cb153-1888" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb153-1889"><a href="#cb153-1889" aria-hidden="true" tabindex="-1"></a><span class="in">#| output-location: column</span></span>
<span id="cb153-1890"><a href="#cb153-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1891"><a href="#cb153-1891" aria-hidden="true" tabindex="-1"></a><span class="in">#--- get North Carolina county borders ---#</span></span>
<span id="cb153-1892"><a href="#cb153-1892" aria-hidden="true" tabindex="-1"></a><span class="in">nc &lt;- st_read(system.file("shape/nc.shp", package = "sf"))</span></span>
<span id="cb153-1893"><a href="#cb153-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1894"><a href="#cb153-1894" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb153-1895"><a href="#cb153-1895" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- create a map ---#</span></span>
<span id="cb153-1896"><a href="#cb153-1896" aria-hidden="true" tabindex="-1"></a><span class="in">  g_nc &lt;- </span></span>
<span id="cb153-1897"><a href="#cb153-1897" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(nc) +</span></span>
<span id="cb153-1898"><a href="#cb153-1898" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_sf()</span></span>
<span id="cb153-1899"><a href="#cb153-1899" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb153-1900"><a href="#cb153-1900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1901"><a href="#cb153-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1902"><a href="#cb153-1902" aria-hidden="true" tabindex="-1"></a><span class="in">`ggsave()`</span> automatically detects the file format from the file name. For example, the following code saves <span class="in">`g_nc`</span> as nc.pdf. <span class="in">`ggsave()`</span> knows the <span class="in">`ggplot`</span> object was intended to be saved as a pdf file from the extension of the specified file name.</span>
<span id="cb153-1903"><a href="#cb153-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1904"><a href="#cb153-1904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-1905"><a href="#cb153-1905" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc.pdf", g_nc)</span></span>
<span id="cb153-1906"><a href="#cb153-1906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1907"><a href="#cb153-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1908"><a href="#cb153-1908" aria-hidden="true" tabindex="-1"></a>Similarly,</span>
<span id="cb153-1909"><a href="#cb153-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1910"><a href="#cb153-1910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-1911"><a href="#cb153-1911" aria-hidden="true" tabindex="-1"></a><span class="in">#--- save as an eps file ---#</span></span>
<span id="cb153-1912"><a href="#cb153-1912" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc.eps", g_nc)</span></span>
<span id="cb153-1913"><a href="#cb153-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1914"><a href="#cb153-1914" aria-hidden="true" tabindex="-1"></a><span class="in">#--- save as an eps file ---#</span></span>
<span id="cb153-1915"><a href="#cb153-1915" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc.svg", g_nc)</span></span>
<span id="cb153-1916"><a href="#cb153-1916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1917"><a href="#cb153-1917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1918"><a href="#cb153-1918" aria-hidden="true" tabindex="-1"></a>You can change the output size with <span class="in">`height`</span> and <span class="in">`width`</span> options. For example, the following code creates a pdf file of <span class="in">`height = 5`</span> inches and <span class="in">`width = 7`</span> inches.</span>
<span id="cb153-1919"><a href="#cb153-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1920"><a href="#cb153-1920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = F}</span></span>
<span id="cb153-1921"><a href="#cb153-1921" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc.pdf", g_nc, height = 5, width = 7)</span></span>
<span id="cb153-1922"><a href="#cb153-1922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb153-1923"><a href="#cb153-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1924"><a href="#cb153-1924" aria-hidden="true" tabindex="-1"></a>You change the unit with the <span class="in">`units`</span> option. By default, <span class="in">`in`</span> (inches) is used.</span>
<span id="cb153-1925"><a href="#cb153-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1926"><a href="#cb153-1926" aria-hidden="true" tabindex="-1"></a>You can control the resolution of the output image by specifying DPI (dots per inch) using the <span class="in">`dpi`</span> option. The default DPI value is 300, but you can specify any value suitable for the output image, including "retina" (320) or "screen" (72). 600 or higher is recommended when a high resolution output is required.</span>
<span id="cb153-1927"><a href="#cb153-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1928"><a href="#cb153-1928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb153-1929"><a href="#cb153-1929" aria-hidden="true" tabindex="-1"></a><span class="in">#--- dpi = 320 ---#</span></span>
<span id="cb153-1930"><a href="#cb153-1930" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc_dpi_320.png", g_nc, height = 5, width = 7, dpi = 320)</span></span>
<span id="cb153-1931"><a href="#cb153-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-1932"><a href="#cb153-1932" aria-hidden="true" tabindex="-1"></a><span class="in">#--- dpi = 72 ---#</span></span>
<span id="cb153-1933"><a href="#cb153-1933" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("nc_dpi_screen.png", g_nc, height = 5, width = 7, dpi = "screen")</span></span>
<span id="cb153-1934"><a href="#cb153-1934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/tmieno2/R-as-GIS-for-Economists/edit/master/chapters/07-CreateMaps-ggplot.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>